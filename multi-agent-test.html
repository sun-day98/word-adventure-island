<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤šä»£ç†ç³»ç»Ÿæµ‹è¯•å¹³å°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .control-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .status-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .test-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
            resize: vertical;
            min-height: 100px;
            margin-bottom: 15px;
        }

        .test-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #ff6b9d, #fd79a8);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .workflow-status {
            margin-bottom: 20px;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-indicator.idle { background: #6c757d; }
        .status-indicator.running { background: #28a745; animation: pulse 1.5s infinite; }
        .status-indicator.completed { background: #007bff; }
        .status-indicator.failed { background: #dc3545; }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .agent-status-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .agent-status-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            border-left: 4px solid #ddd;
        }

        .agent-status-card.active {
            border-left-color: #28a745;
            background: linear-gradient(135deg, #d4edda, #f0fff4);
        }

        .agent-status-card.completed {
            border-left-color: #007bff;
            background: linear-gradient(135deg, #d1ecf1, #f0f8ff);
        }

        .agent-status-card.failed {
            border-left-color: #dc3545;
            background: linear-gradient(135deg, #f8d7da, #fff5f5);
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .results-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .result-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }

        .result-header {
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .result-timestamp {
            color: #7f8c8d;
            font-size: 0.8rem;
        }

        .result-content {
            color: #495057;
            line-height: 1.6;
        }

        .test-logs {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            max-height: 400px;
            overflow-y: auto;
        }

        .log-entry {
            padding: 8px;
            margin-bottom: 5px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .log-entry.info {
            background: #e6f3ff;
            color: #0066cc;
        }

        .log-entry.success {
            background: #e6ffe6;
            color: #006600;
        }

        .log-entry.warning {
            background: #fff3cd;
            color: #856404;
        }

        .log-entry.error {
            background: #ffe6e6;
            color: #cc0000;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .metric-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
        }

        .metric-label {
            color: #7f8c8d;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .test-scenarios {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .scenario-button {
            display: block;
            width: 100%;
            text-align: left;
            padding: 15px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border: 2px solid transparent;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .scenario-button:hover {
            border-color: #667eea;
            background: linear-gradient(135deg, #f0f8ff, #ffffff);
        }

        .scenario-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .scenario-description {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .agent-status-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>ğŸ¤– å¤šä»£ç†ç³»ç»Ÿæµ‹è¯•å¹³å°</h1>
            <p>æµ‹è¯•å’Œç›‘æ§å¤šä»£ç†æ¶æ„ç³»ç»Ÿçš„å®Œæ•´å·¥ä½œæµç¨‹</p>
        </header>

        <div class="main-content">
            <!-- æ§åˆ¶é¢æ¿ -->
            <section class="control-panel">
                <h2>ğŸ›ï¸ æµ‹è¯•æ§åˆ¶</h2>
                
                <div class="test-input-group">
                    <label for="testQuery">æµ‹è¯•æŸ¥è¯¢ï¼š</label>
                    <textarea id="testQuery" class="test-input" placeholder="è¾“å…¥æµ‹è¯•æŸ¥è¯¢...">åˆ†æå½“å‰äººå·¥æ™ºèƒ½æŠ€æœ¯çš„å‘å±•è¶‹åŠ¿ï¼ŒåŒ…æ‹¬ä¸»è¦æŠ€æœ¯çªç ´ã€åº”ç”¨é¢†åŸŸã€é¢ä¸´çš„æŒ‘æˆ˜ä»¥åŠæœªæ¥å‘å±•æ–¹å‘ã€‚</textarea>
                </div>

                <div class="control-buttons">
                    <button class="btn btn-primary" onclick="runMultiAgentTest()">ğŸš€ è¿è¡Œå®Œæ•´æµ‹è¯•</button>
                    <button class="btn btn-secondary" onclick="runAgentTest('planning')">ğŸ“‹ æµ‹è¯•è§„åˆ’ä»£ç†</button>
                    <button class="btn btn-secondary" onclick="runAgentTest('execution')">âš™ï¸ æµ‹è¯•æ‰§è¡Œä»£ç†</button>
                    <button class="btn btn-secondary" onclick="runAgentTest('validation')">âœ… æµ‹è¯•éªŒè¯ä»£ç†</button>
                    <button class="btn btn-secondary" onclick="runAgentTest('response')">ğŸ¤ æµ‹è¯•å›ç­”ä»£ç†</button>
                </div>

                <div class="control-buttons">
                    <button class="btn btn-success" onclick="runHealthCheck()">ğŸ¥ å¥åº·æ£€æŸ¥</button>
                    <button class="btn btn-warning" onclick="getPerformanceMetrics()">ğŸ“Š æ€§èƒ½æŒ‡æ ‡</button>
                    <button class="btn btn-secondary" onclick="clearResults()">ğŸ—‘ï¸ æ¸…ç©ºç»“æœ</button>
                    <button class="btn btn-secondary" onclick="exportResults()">ğŸ“¥ å¯¼å‡ºæ•°æ®</button>
                </div>
            </section>

            <!-- çŠ¶æ€é¢æ¿ -->
            <section class="status-panel">
                <h2>ğŸ“Š ç³»ç»ŸçŠ¶æ€</h2>
                
                <div class="workflow-status">
                    <h3>å·¥ä½œæµçŠ¶æ€</h3>
                    <p>
                        <span class="status-indicator idle" id="workflowStatus"></span>
                        <span id="workflowStatusText">ç©ºé—²</span>
                    </p>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressBar" style="width: 0%">0%</div>
                    </div>
                </div>

                <div class="agent-status-grid">
                    <div class="agent-status-card" id="agent-planning">
                        <div class="agent-name">ğŸ“‹ è§„åˆ’ä»£ç†</div>
                        <div class="agent-status">å¾…å‘½ä¸­...</div>
                    </div>
                    <div class="agent-status-card" id="agent-execution">
                        <div class="agent-name">âš™ï¸ æ‰§è¡Œä»£ç†</div>
                        <div class="agent-status">å¾…å‘½ä¸­...</div>
                    </div>
                    <div class="agent-status-card" id="agent-validation">
                        <div class="agent-name">âœ… éªŒè¯ä»£ç†</div>
                        <div class="agent-status">å¾…å‘½ä¸­...</div>
                    </div>
                    <div class="agent-status-card" id="agent-response">
                        <div class="agent-name">ğŸ¤ å›ç­”ä»£ç†</div>
                        <div class="agent-status">å¾…å‘½ä¸­...</div>
                    </div>
                </div>

                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value" id="totalTests">0</div>
                        <div class="metric-label">æ€»æµ‹è¯•æ•°</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="successRate">0%</div>
                        <div class="metric-label">æˆåŠŸç‡</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="avgResponseTime">0s</div>
                        <div class="metric-label">å¹³å‡å“åº”æ—¶é—´</div>
                    </div>
                </div>
            </section>
        </div>

        <!-- æµ‹è¯•åœºæ™¯ -->
        <section class="test-scenarios">
            <h2>ğŸ§ª é¢„è®¾æµ‹è¯•åœºæ™¯</h2>
            
            <button class="scenario-button" onclick="loadScenario('simple')">
                <div class="scenario-title">ğŸ” ç®€å•æŸ¥è¯¢æµ‹è¯•</div>
                <div class="scenario-description">æµ‹è¯•åŸºç¡€çš„æŸ¥è¯¢åˆ†æå’Œå“åº”èƒ½åŠ›</div>
            </button>
            
            <button class="scenario-button" onclick="loadScenario('complex')">
                <div class="scenario-title">ğŸ”¬ å¤æ‚åˆ†ææµ‹è¯•</div>
                <div class="scenario-description">æµ‹è¯•å¤æ‚æŸ¥è¯¢çš„æ·±åº¦åˆ†æå’Œå¤šæºæ•°æ®æ•´åˆ</div>
            </button>
            
            <button class="scenario-button" onclick="loadScenario('practical')">
                <div class="scenario-title">ğŸ› ï¸ å®è·µæŒ‡å¯¼æµ‹è¯•</div>
                <div class="scenario-description">æµ‹è¯•æ­¥éª¤åŒ–æŒ‡å¯¼å’Œæ“ä½œæµç¨‹ç”Ÿæˆ</div>
            </button>
            
            <button class="scenario-button" onclick="loadScenario('comparison')">
                <div class="scenario-title">âš–ï¸ å¯¹æ¯”åˆ†ææµ‹è¯•</div>
                <div class="scenario-description">æµ‹è¯•å¤šé€‰é¡¹å¯¹æ¯”å’Œæ¨èèƒ½åŠ›</div>
            </button>
            
            <button class="scenario-button" onclick="loadScenario('error')">
                <div class="scenario-title">âŒ é”™è¯¯å¤„ç†æµ‹è¯•</div>
                <div class="scenario-description">æµ‹è¯•ç³»ç»Ÿé”™è¯¯å¤„ç†å’Œæ¢å¤èƒ½åŠ›</div>
            </button>
        </section>

        <!-- ç»“æœé¢æ¿ -->
        <section class="results-panel">
            <h2>ğŸ“‹ æµ‹è¯•ç»“æœ</h2>
            <div id="resultsContainer">
                <div class="result-item">
                    <div class="result-header">
                        <span>ç³»ç»Ÿæ¶ˆæ¯</span>
                        <span class="result-timestamp">2024-12-11 10:00:00</span>
                    </div>
                    <div class="result-content">
                        å¤šä»£ç†ç³»ç»Ÿå·²å°±ç»ªï¼Œç­‰å¾…æµ‹è¯•å¼€å§‹...
                    </div>
                </div>
            </div>
        </section>

        <!-- æ—¥å¿—é¢æ¿ -->
        <section class="test-logs">
            <h2>ğŸ“œ æµ‹è¯•æ—¥å¿—</h2>
            <div id="logsContainer">
                <div class="log-entry info">ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ</div>
                <div class="log-entry success">æ‰€æœ‰ä»£ç†åŠ è½½æˆåŠŸ</div>
                <div class="log-entry info">ç­‰å¾…æµ‹è¯•è¾“å…¥...</div>
            </div>
        </section>
    </div>

    <!-- åŠ è½½æ‰€æœ‰ä»£ç†è„šæœ¬ -->
    <script src="agent-planning.js"></script>
    <script src="agent-execution.js"></script>
    <script src="agent-validation.js"></script>
    <script src="agent-response.js"></script>
    <script src="multi-agent-coordinator.js"></script>

    <script>
        // å…¨å±€å˜é‡
        let coordinator;
        let testMetrics = {
            totalTests: 0,
            successfulTests: 0,
            failedTests: 0,
            totalResponseTime: 0,
            currentTestStartTime: null
        };

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializeSystem();
        });

        /**
         * åˆå§‹åŒ–ç³»ç»Ÿ
         */
        function initializeSystem() {
            try {
                // åˆ›å»ºä»£ç†å®ä¾‹
                const agents = {
                    planning: new PlanningAgent(),
                    execution: new ExecutionAgent(),
                    validation: new ValidationAgent(),
                    response: new ResponseAgent()
                };

                // åˆ›å»ºåè°ƒå™¨
                coordinator = new MultiAgentCoordinator();
                coordinator.initializeAgents(agents);

                // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                setupEventListeners();

                addLog('ç³»ç»Ÿåˆå§‹åŒ–æˆåŠŸ', 'success');
                updateMetrics();
                
            } catch (error) {
                addLog('ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥: ' + error.message, 'error');
            }
        }

        /**
         * è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
         */
        function setupEventListeners() {
            // å·¥ä½œæµå¼€å§‹äº‹ä»¶
            coordinator.addEventListener('onWorkflowStart', function(data) {
                addLog(`å·¥ä½œæµå¼€å§‹: ${data.workflowId}`, 'info');
                updateWorkflowStatus('running', 'å·¥ä½œæµæ‰§è¡Œä¸­...');
                updateProgress(0);
            });

            // ä»£ç†å®Œæˆäº‹ä»¶
            coordinator.addEventListener('onAgentComplete', function(data) {
                addLog(`ä»£ç† ${data.agent} å®Œæˆä»»åŠ¡`, 'success');
                updateAgentStatus(data.agent, 'completed', 'ä»»åŠ¡å®Œæˆ');
            });

            // é”™è¯¯äº‹ä»¶
            coordinator.addEventListener('onError', function(data) {
                addLog(`é”™è¯¯: ${data.agent} - ${data.error}`, 'error');
                if (data.agent) {
                    updateAgentStatus(data.agent, 'failed', data.error);
                }
            });

            // å·¥ä½œæµå®Œæˆäº‹ä»¶
            coordinator.addEventListener('onWorkflowComplete', function(data) {
                addLog(`å·¥ä½œæµå®Œæˆ: ${data.workflowId}`, 'success');
                updateWorkflowStatus('completed', 'å·¥ä½œæµå®Œæˆ');
                updateProgress(100);
                
                // æ›´æ–°æµ‹è¯•æŒ‡æ ‡
                const responseTime = Date.now() - testMetrics.currentTestStartTime;
                updateTestMetrics(true, responseTime);
                
                // æ˜¾ç¤ºç»“æœ
                displayTestResult(data.result);
            });
        }

        /**
         * è¿è¡Œå¤šä»£ç†æµ‹è¯•
         */
        async function runMultiAgentTest() {
            const query = document.getElementById('testQuery').value.trim();
            if (!query) {
                addLog('è¯·è¾“å…¥æµ‹è¯•æŸ¥è¯¢', 'warning');
                return;
            }

            addLog(`å¼€å§‹å®Œæ•´æµ‹è¯•: ${query.substring(0, 50)}...`, 'info');
            testMetrics.currentTestStartTime = Date.now();
            testMetrics.totalTests++;

            try {
                // é‡ç½®æ‰€æœ‰ä»£ç†çŠ¶æ€
                resetAgentStatuses();
                
                // è¿è¡Œå·¥ä½œæµ
                const result = await coordinator.startWorkflow(query);
                
                if (result.success) {
                    addLog('æµ‹è¯•å®Œæˆ', 'success');
                } else {
                    addLog('æµ‹è¯•å¤±è´¥: ' + result.error, 'error');
                    updateTestMetrics(false, Date.now() - testMetrics.currentTestStartTime);
                }
                
            } catch (error) {
                addLog('æµ‹è¯•å¼‚å¸¸: ' + error.message, 'error');
                updateTestMetrics(false, Date.now() - testMetrics.currentTestStartTime);
            }
        }

        /**
         * è¿è¡Œå•ä¸ªä»£ç†æµ‹è¯•
         */
        async function runAgentTest(agentType) {
            addLog(`å¼€å§‹æµ‹è¯• ${agentType} ä»£ç†...`, 'info');
            updateAgentStatus(agentType, 'active', 'æµ‹è¯•ä¸­...');

            try {
                const query = document.getElementById('testQuery').value.trim() || 'æµ‹è¯•æŸ¥è¯¢';
                let result;

                switch (agentType) {
                    case 'planning':
                        result = await coordinator.agents.planning.analyzeQuery(query);
                        break;
                    case 'execution':
                        // éœ€è¦å…ˆæœ‰ä»»åŠ¡è®¡åˆ’
                        const taskPlan = await coordinator.agents.planning.createTaskPlan({ query });
                        result = await coordinator.agents.execution.executeTaskPlan(taskPlan);
                        break;
                    case 'validation':
                        // ç®€åŒ–çš„éªŒè¯æµ‹è¯•
                        result = { message: 'éªŒè¯ä»£ç†æµ‹è¯•å®Œæˆ' };
                        break;
                    case 'response':
                        // ç®€åŒ–çš„å“åº”æµ‹è¯•
                        result = { message: 'å“åº”ä»£ç†æµ‹è¯•å®Œæˆ' };
                        break;
                }

                addLog(`${agentType} ä»£ç†æµ‹è¯•å®Œæˆ`, 'success');
                updateAgentStatus(agentType, 'completed', 'æµ‹è¯•å®Œæˆ');
                
                // æ˜¾ç¤ºç»“æœ
                addResult(`${agentType} ä»£ç†æµ‹è¯•ç»“æœ`, JSON.stringify(result, null, 2));
                
            } catch (error) {
                addLog(`${agentType} ä»£ç†æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                updateAgentStatus(agentType, 'failed', error.message);
            }
        }

        /**
         * è¿è¡Œå¥åº·æ£€æŸ¥
         */
        function runHealthCheck() {
            addLog('å¼€å§‹å¥åº·æ£€æŸ¥...', 'info');
            
            try {
                const health = coordinator.healthCheck();
                addLog(`å¥åº·æ£€æŸ¥å®Œæˆ: ${health.status}`, 'success');
                
                // è¯¦ç»†å¥åº·ä¿¡æ¯
                for (const [agent, status] of Object.entries(health.agents)) {
                    addLog(`  ${agent}: ${status.status}`, status.status === 'available' ? 'success' : 'error');
                }
                
                for (const [system, status] of Object.entries(health.systems)) {
                    addLog(`  ${system}: ${status}`, status === 'healthy' ? 'success' : 'warning');
                }
                
                addResult('å¥åº·æ£€æŸ¥ç»“æœ', JSON.stringify(health, null, 2));
                
            } catch (error) {
                addLog('å¥åº·æ£€æŸ¥å¤±è´¥: ' + error.message, 'error');
            }
        }

        /**
         * è·å–æ€§èƒ½æŒ‡æ ‡
         */
        function getPerformanceMetrics() {
            addLog('è·å–æ€§èƒ½æŒ‡æ ‡...', 'info');
            
            try {
                const metrics = coordinator.getPerformanceMetrics();
                addLog('æ€§èƒ½æŒ‡æ ‡è·å–æˆåŠŸ', 'success');
                
                addResult('æ€§èƒ½æŒ‡æ ‡', JSON.stringify(metrics, null, 2));
                
                // æ›´æ–°æ˜¾ç¤º
                document.getElementById('avgResponseTime').textContent = 
                    (metrics.averageWorkflowTime / 1000).toFixed(1) + 's';
                
            } catch (error) {
                addLog('æ€§èƒ½æŒ‡æ ‡è·å–å¤±è´¥: ' + error.message, 'error');
            }
        }

        /**
         * åŠ è½½æµ‹è¯•åœºæ™¯
         */
        function loadScenario(scenarioType) {
            const scenarios = {
                simple: {
                    query: 'ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ ï¼Ÿ',
                    description: 'ç®€å•çš„æ¦‚å¿µè§£é‡ŠæŸ¥è¯¢'
                },
                complex: {
                    query: 'åˆ†ææ·±åº¦å­¦ä¹ åœ¨åŒ»ç–—è¯Šæ–­ä¸­çš„åº”ç”¨ç°çŠ¶ã€æŠ€æœ¯æŒ‘æˆ˜å’Œæœªæ¥å‘å±•è¶‹åŠ¿ï¼ŒåŒ…æ‹¬å…·ä½“çš„æˆåŠŸæ¡ˆä¾‹ã€ä¼¦ç†è€ƒé‡å’Œç›‘ç®¡æ¡†æ¶ã€‚',
                    description: 'å¤æ‚çš„å¤šç»´åº¦åˆ†ææŸ¥è¯¢'
                },
                practical: {
                    query: 'å¦‚ä½•ä»å¤´å¼€å§‹æ„å»ºä¸€ä¸ªç®€å•çš„Webåº”ç”¨ï¼Ÿè¯·æä¾›è¯¦ç»†çš„æ­¥éª¤ã€æ‰€éœ€å·¥å…·å’Œæœ€ä½³å®è·µã€‚',
                    description: 'å®è·µæ€§æ“ä½œæŒ‡å¯¼æŸ¥è¯¢'
                },
                comparison: {
                    query: 'æ¯”è¾ƒReactã€Vueå’ŒAngularä¸‰å¤§å‰ç«¯æ¡†æ¶çš„ä¼˜ç¼ºç‚¹ã€é€‚ç”¨åœºæ™¯å’Œå­¦ä¹ æ›²çº¿ã€‚',
                    description: 'å¤šé€‰é¡¹å¯¹æ¯”åˆ†ææŸ¥è¯¢'
                },
                error: {
                    query: '',
                    description: 'é”™è¯¯å¤„ç†æµ‹è¯•ï¼ˆç©ºæŸ¥è¯¢ï¼‰'
                }
            };

            const scenario = scenarios[scenarioType];
            if (scenario) {
                document.getElementById('testQuery').value = scenario.query;
                addLog(`åŠ è½½æµ‹è¯•åœºæ™¯: ${scenario.description}`, 'info');
            }
        }

        /**
         * æ¸…ç©ºç»“æœ
         */
        function clearResults() {
            document.getElementById('resultsContainer').innerHTML = '';
            document.getElementById('logsContainer').innerHTML = '';
            resetAgentStatuses();
            updateWorkflowStatus('idle', 'ç©ºé—²');
            updateProgress(0);
            addLog('ç»“æœå·²æ¸…ç©º', 'info');
        }

        /**
         * å¯¼å‡ºç»“æœ
         */
        function exportResults() {
            const data = {
                testMetrics,
                logs: Array.from(document.querySelectorAll('.log-entry')).map(log => ({
                    type: log.className.split(' ')[1],
                    content: log.textContent,
                    timestamp: new Date().toISOString()
                })),
                results: Array.from(document.querySelectorAll('.result-item')).map(result => ({
                    title: result.querySelector('.result-header span').textContent,
                    content: result.querySelector('.result-content').textContent,
                    timestamp: result.querySelector('.result-timestamp').textContent
                })),
                exportTime: new Date().toISOString()
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `multi-agent-test-results-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);

            addLog('æµ‹è¯•ç»“æœå·²å¯¼å‡º', 'success');
        }

        /**
         * æ·»åŠ æ—¥å¿—
         */
        function addLog(message, type = 'info') {
            const logsContainer = document.getElementById('logsContainer');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logsContainer.appendChild(logEntry);
            logsContainer.scrollTop = logsContainer.scrollHeight;
        }

        /**
         * æ·»åŠ ç»“æœ
         */
        function addResult(title, content) {
            const resultsContainer = document.getElementById('resultsContainer');
            const resultItem = document.createElement('div');
            resultItem.className = 'result-item';
            
            const timestamp = new Date().toLocaleString();
            resultItem.innerHTML = `
                <div class="result-header">
                    <span>${title}</span>
                    <span class="result-timestamp">${timestamp}</span>
                </div>
                <div class="result-content">
                    <pre style="white-space: pre-wrap; max-height: 300px; overflow-y: auto;">${content}</pre>
                </div>
            `;
            
            resultsContainer.appendChild(resultItem);
            resultsContainer.scrollTop = resultsContainer.scrollHeight;
        }

        /**
         * æ˜¾ç¤ºæµ‹è¯•ç»“æœ
         */
        function displayTestResult(result) {
            const finalAnswer = result.finalAnswer;
            if (finalAnswer && finalAnswer.response && finalAnswer.response.final) {
                const content = finalAnswer.response.final.sections
                    .map(section => `## ${section.title}\n${section.content}`)
                    .join('\n\n');
                
                addResult('æµ‹è¯•ç»“æœ - ç»¼åˆç­”æ¡ˆ', content);
            }
        }

        /**
         * æ›´æ–°å·¥ä½œæµçŠ¶æ€
         */
        function updateWorkflowStatus(status, text) {
            const statusIndicator = document.getElementById('workflowStatus');
            const statusText = document.getElementById('workflowStatusText');
            
            statusIndicator.className = `status-indicator ${status}`;
            statusText.textContent = text;
        }

        /**
         * æ›´æ–°ä»£ç†çŠ¶æ€
         */
        function updateAgentStatus(agent, status, message) {
            const agentCard = document.getElementById(`agent-${agent}`);
            if (!agentCard) return;

            agentCard.className = `agent-status-card ${status}`;
            const statusDiv = agentCard.querySelector('.agent-status');
            statusDiv.textContent = message;
        }

        /**
         * æ›´æ–°è¿›åº¦æ¡
         */
        function updateProgress(progress) {
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = progress + '%';
            progressBar.textContent = progress + '%';
        }

        /**
         * é‡ç½®ä»£ç†çŠ¶æ€
         */
        function resetAgentStatuses() {
            const agents = ['planning', 'execution', 'validation', 'response'];
            agents.forEach(agent => {
                updateAgentStatus(agent, 'idle', 'å¾…å‘½ä¸­...');
            });
        }

        /**
         * æ›´æ–°æµ‹è¯•æŒ‡æ ‡
         */
        function updateTestMetrics(success, responseTime) {
            if (success) {
                testMetrics.successfulTests++;
            } else {
                testMetrics.failedTests++;
            }
            
            testMetrics.totalResponseTime += responseTime;
            updateMetrics();
        }

        /**
         * æ›´æ–°æŒ‡æ ‡æ˜¾ç¤º
         */
        function updateMetrics() {
            document.getElementById('totalTests').textContent = testMetrics.totalTests;
            
            const successRate = testMetrics.totalTests > 0 ? 
                (testMetrics.successfulTests / testMetrics.totalTests * 100).toFixed(1) : 0;
            document.getElementById('successRate').textContent = successRate + '%';
            
            const avgResponseTime = testMetrics.totalTests > 0 ?
                (testMetrics.totalResponseTime / testMetrics.totalTests / 1000).toFixed(1) : 0;
            document.getElementById('avgResponseTime').textContent = avgResponseTime + 's';
        }
    </script>
</body>
</html>