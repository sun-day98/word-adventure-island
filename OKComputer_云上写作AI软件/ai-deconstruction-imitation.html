<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIæ‹†ä¹¦ä»¿å†™å·¥ä½œå°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #5B5FDE;
            --secondary-color: #FF6B6B;
            --accent-color: #4ECDC4;
            --success-color: #10B981;
            --warning-color: #F59E0B;
            --error-color: #EF4444;
            --bg-primary: #FFFFFF;
            --bg-secondary: #F8F9FA;
            --bg-dark: #2D3436;
            --text-primary: #2D3436;
            --text-secondary: #636E72;
            --border-color: #E1E8ED;
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.1);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.15);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.2);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* å¤´éƒ¨ */
        .header {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: var(--shadow-md);
            text-align: center;
        }

        .header h1 {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 8px;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        /* ä¸»å¸ƒå±€ */
        .main-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }

        /* å¡ç‰‡æ ·å¼ */
        .card {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--shadow-md);
            transition: var(--transition);
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--border-color);
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card-description {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 8px;
        }

        /* è¡¨å•æ ·å¼ */
        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            transition: var(--transition);
            background: var(--bg-primary);
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(91, 95, 222, 0.1);
        }

        .form-textarea {
            min-height: 200px;
            resize: vertical;
            font-family: inherit;
        }

        /* æŒ‰é’®æ ·å¼ */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: #4B4FCE;
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background: var(--text-secondary);
            color: white;
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-warning {
            background: var(--warning-color);
            color: white;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-group {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .btn-full {
            width: 100%;
            justify-content: center;
        }

        /* ç»“æœåŒºåŸŸ */
        .results-section {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--shadow-md);
        }

        .results-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .results-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .result-item {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            border-left: 4px solid var(--primary-color);
        }

        .result-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .result-content {
            color: var(--text-secondary);
            line-height: 1.8;
        }

        .result-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border-color);
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* åŠ è½½åŠ¨ç”» */
        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-color);
            border-top: 2px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
        }

        /* æ ‡ç­¾é¡µ */
        .tabs {
            display: flex;
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 4px;
            margin-bottom: 24px;
        }

        .tab {
            flex: 1;
            padding: 12px 16px;
            border-radius: 6px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }

        .tab:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        .tab.active {
            background: var(--primary-color);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* ç»Ÿè®¡æ•°æ® */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 8px;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .container {
                padding: 16px;
            }
        }

        /* å·¥å…·æç¤º */
        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-dark);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            white-space: nowrap;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨ -->
        <header class="header">
            <h1>ğŸ§  AIæ‹†ä¹¦ä»¿å†™å·¥ä½œå°</h1>
            <p>æ™ºèƒ½æ‹†è§£ä¹¦ç±å†…å®¹ï¼Œç²¾å‡†æ¨¡ä»¿å†™ä½œé£æ ¼</p>
        </header>

        <!-- ç»Ÿè®¡æ•°æ® -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="deconstructionCount">0</div>
                <div class="stat-label">æ‹†ä¹¦æ¬¡æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="imitationCount">0</div>
                <div class="stat-label">ä»¿å†™æ¬¡æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="savedResults">0</div>
                <div class="stat-label">ä¿å­˜ç»“æœ</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avgQuality">0%</div>
                <div class="stat-label">å¹³å‡è´¨é‡</div>
            </div>
        </div>

        <!-- ä¸»å·¥ä½œåŒº -->
        <div class="main-layout">
            <!-- AIæ‹†ä¹¦ -->
            <div class="card">
                <div class="card-header">
                    <div>
                        <h2 class="card-title">
                            ğŸ“– AIæ‹†ä¹¦
                        </h2>
                        <p class="card-description">æ·±åº¦åˆ†æä¹¦ç±ç»“æ„ï¼Œæå–æ ¸å¿ƒè¦ç‚¹</p>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">ä¹¦ç±å†…å®¹</label>
                    <textarea 
                        id="bookContent" 
                        class="form-textarea" 
                        placeholder="ç²˜è´´è¦åˆ†æçš„ä¹¦ç±å†…å®¹ï¼Œå»ºè®®åŒ…å«å®Œæ•´çš„ç« èŠ‚æˆ–æ®µè½..."
                    ></textarea>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div class="form-group">
                        <label class="form-label">ä½œå“ç±»å‹</label>
                        <select id="bookType" class="form-select">
                            <option value="fiction">æ–‡å­¦ä½œå“</option>
                            <option value="non_fiction">éæ–‡å­¦ä½œå“</option>
                            <option value="academic">å­¦æœ¯ä½œå“</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">å…·ä½“åˆ†ç±»</label>
                        <select id="bookCategory" class="form-select">
                            <option value="chinese_novel">ä¸­æ–‡å°è¯´</option>
                            <option value="foreign_novel">å¤–æ–‡å°è¯´</option>
                            <option value="self_help">è‡ªæˆ‘æå‡</option>
                            <option value="business">å•†ä¸šç®¡ç†</option>
                            <option value="psychology">å¿ƒç†å­¦</option>
                            <option value="research_paper">ç ”ç©¶è®ºæ–‡</option>
                        </select>
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-primary btn-full" onclick="startDeconstruction()">
                        ğŸ“– å¼€å§‹æ‹†ä¹¦åˆ†æ
                    </button>
                </div>
            </div>

            <!-- AIä»¿å†™ -->
            <div class="card">
                <div class="card-header">
                    <div>
                        <h2 class="card-title">
                            âœï¸ AIä»¿å†™
                        </h2>
                        <p class="card-description">æ™ºèƒ½æ¨¡ä»¿å†™ä½œé£æ ¼ï¼Œç”Ÿæˆç›¸ä¼¼å†…å®¹</p>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">åŸæ–‡å†…å®¹</label>
                    <textarea 
                        id="imitationText" 
                        class="form-textarea" 
                        placeholder="ç²˜è´´è¦æ¨¡ä»¿é£æ ¼çš„æ–‡æœ¬..."
                    ></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">ç›®æ ‡é£æ ¼</label>
                    <select id="targetStyle" class="form-select">
                        <option value="">é€‰æ‹©ç›®æ ‡é£æ ¼</option>
                        <optgroup label="ğŸ“š æ–‡å­¦ä½œå®¶">
                            <option value="luxun">é²è¿… - æ‰¹åˆ¤ç°å®ä¸»ä¹‰</option>
                            <option value="ba_jin">å·´é‡‘ - æ¿€æƒ…æ¾æ¹ƒ</option>
                            <option value="maodun">èŒ…ç›¾ - å®å¤§å™äº‹</option>
                            <option value="shen_congwen">æ²ˆä»æ–‡ - è¯—æ„ç”°å›­</option>
                        </optgroup>
                        <optgroup label="âœ¨ ç°ä»£ä½œå®¶">
                            <option value="wang_xiaobo">ç‹å°æ³¢ - ç†æ€§å¹½é»˜</option>
                            <option value="yu_hua">ä½™å - å¹³å®æ·±åˆ»</option>
                            <option value="mo_yan">è«è¨€ - é­”å¹»ç°å®</option>
                        </optgroup>
                        <optgroup label="ğŸŒ ç½‘ç»œæ–‡å­¦">
                            <option value="xianxia">ç„å¹»ä¿®ä»™</option>
                            <option value="urban">éƒ½å¸‚æƒ…æ„Ÿ</option>
                            <option value="history">å†å²ç©¿è¶Š</option>
                        </optgroup>
                        <optgroup label="ğŸ’¼ ä¸“ä¸šé£æ ¼">
                            <option value="academic">å­¦æœ¯è®ºæ–‡</option>
                            <option value="tech">æŠ€æœ¯æ–‡æ¡£</option>
                            <option value="business">å•†ä¸šæ–‡æ¡ˆ</option>
                        </optgroup>
                    </select>
                </div>

                <div class="btn-group">
                    <button class="btn btn-primary btn-full" onclick="startImitation()">
                        âœï¸ å¼€å§‹é£æ ¼ä»¿å†™
                    </button>
                </div>
            </div>
        </div>

        <!-- ç»“æœå±•ç¤ºåŒº -->
        <div class="results-section" id="resultsSection" style="display: none;">
            <div class="results-header">
                <h2 class="results-title">ğŸ“Š åˆ†æç»“æœ</h2>
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
                    <button class="btn btn-success" onclick="exportResults()">å¯¼å‡ºæŠ¥å‘Š</button>
                </div>
            </div>

            <!-- æ ‡ç­¾é¡µ -->
            <div class="tabs">
                <div class="tab active" onclick="switchTab('overview')">ğŸ“‹ æ¦‚è§ˆ</div>
                <div class="tab" onclick="switchTab('details')">ğŸ“ è¯¦æƒ…</div>
                <div class="tab" onclick="switchTab('history')">ğŸ“š å†å²</div>
            </div>

            <!-- æ ‡ç­¾é¡µå†…å®¹ -->
            <div id="overviewTab" class="tab-content active">
                <div id="overviewResults">
                    <!-- æ¦‚è§ˆç»“æœå°†åŠ¨æ€æ’å…¥è¿™é‡Œ -->
                </div>
            </div>

            <div id="detailsTab" class="tab-content">
                <div id="detailsResults">
                    <!-- è¯¦ç»†ç»“æœå°†åŠ¨æ€æ’å…¥è¿™é‡Œ -->
                </div>
            </div>

            <div id="historyTab" class="tab-content">
                <div id="historyResults">
                    <!-- å†å²è®°å½•å°†åŠ¨æ€æ’å…¥è¿™é‡Œ -->
                </div>
            </div>
        </div>
    </div>

    <!-- å¼•å…¥JavaScriptæ–‡ä»¶ -->
    <script src="ai-writing-tools.js"></script>
    <script src="ai-book-deconstruction.js"></script>
    <script src="ai-writing-imitation.js"></script>
    <script>
        // å…¨å±€å˜é‡
        let currentAnalysis = null;
        let currentImitation = null;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadStatistics();
            loadHistory();
        });

        // å¼€å§‹æ‹†ä¹¦åˆ†æ
        async function startDeconstruction() {
            const bookContent = document.getElementById('bookContent').value.trim();
            const bookType = document.getElementById('bookType').value;
            const bookCategory = document.getElementById('bookCategory').value;

            if (!bookContent) {
                showMessage('è¯·è¾“å…¥è¦æ‹†è§£çš„ä¹¦ç±å†…å®¹', 'warning');
                return;
            }

            try {
                showLoading('æ­£åœ¨åˆ†æä¹¦ç±ç»“æ„...');
                
                // æ‰§è¡Œæ‹†ä¹¦åˆ†æ
                const analysis = await window.aiBookDeconstruction.deconstructBook(bookContent, bookType, bookCategory);
                
                // ç”Ÿæˆè¯»ä¹¦ç¬”è®°
                const notes = await window.aiBookDeconstruction.generateReadingNotes(analysis, 'comprehensive');
                
                currentAnalysis = { analysis, notes };
                
                // æ˜¾ç¤ºç»“æœ
                showDeconstructionResults(analysis, notes);
                
                // æ›´æ–°ç»Ÿè®¡
                updateStatistics('deconstruction');
                
                // ä¿å­˜ç»“æœ
                saveToHistory('deconstruction', {
                    bookContent: bookContent.substring(0, 500) + '...',
                    bookType: bookType,
                    bookCategory: bookCategory,
                    analysis: analysis,
                    notes: notes,
                    createdAt: new Date().toISOString()
                });

                hideLoading();
                showMessage('æ‹†ä¹¦åˆ†æå®Œæˆï¼', 'success');

            } catch (error) {
                hideLoading();
                showMessage('æ‹†ä¹¦åˆ†æå¤±è´¥ï¼š' + error.message, 'error');
            }
        }

        // å¼€å§‹ä»¿å†™
        async function startImitation() {
            const originalText = document.getElementById('imitationText').value.trim();
            const targetStyle = document.getElementById('targetStyle').value;

            if (!originalText) {
                showMessage('è¯·è¾“å…¥è¦ä»¿å†™çš„æ–‡æœ¬', 'warning');
                return;
            }

            if (!targetStyle) {
                showMessage('è¯·é€‰æ‹©ç›®æ ‡é£æ ¼', 'warning');
                return;
            }

            try {
                showLoading('æ­£åœ¨åˆ†æé£æ ¼å¹¶ç”Ÿæˆä»¿å†™...');
                
                // æ‰§è¡Œä»¿å†™
                const result = await window.aiWritingImitation.generateImitation(originalText, targetStyle);
                
                currentImitation = result;
                
                // æ˜¾ç¤ºç»“æœ
                showImitationResults(result);
                
                // æ›´æ–°ç»Ÿè®¡
                updateStatistics('imitation');
                
                // ä¿å­˜ç»“æœ
                saveToHistory('imitation', {
                    originalText: originalText,
                    targetStyle: targetStyle,
                    result: result,
                    createdAt: new Date().toISOString()
                });

                hideLoading();
                showMessage('ä»¿å†™å®Œæˆï¼', 'success');

            } catch (error) {
                hideLoading();
                showMessage('ä»¿å†™å¤±è´¥ï¼š' + error.message, 'error');
            }
        }

        // æ˜¾ç¤ºæ‹†ä¹¦ç»“æœ
        function showDeconstructionResults(analysis, notes) {
            const resultsSection = document.getElementById('resultsSection');
            const overviewResults = document.getElementById('overviewResults');
            
            resultsSection.style.display = 'block';
            
            let html = `
                <div class="result-item">
                    <h3 class="result-title">ğŸ“Š ç»“æ„åˆ†æ</h3>
                    <div class="result-content">
                        <p><strong>ç»“æ„æ¡†æ¶ï¼š</strong>${analysis.structure.outline.map(item => item.title).join(' â†’ ')}</p>
                        <p><strong>ä¸»è¦ç« èŠ‚ï¼š</strong>${analysis.structure.chapters.length}ä¸ª</p>
                        <p><strong>ç»“æ„è¿è´¯æ€§ï¼š</strong>${Math.round(analysis.structure.coherence * 100)}%</p>
                    </div>
                </div>
                
                <div class="result-item">
                    <h3 class="result-title">ğŸ¯ æ ¸å¿ƒè§‚ç‚¹</h3>
                    <div class="result-content">
                        ${analysis.keyPoints.central.slice(0, 3).map((point, index) => 
                            `<p><strong>${index + 1}. ${point.title || 'æ ¸å¿ƒè§‚ç‚¹'}ï¼š</strong>${point.description || 'è¯¦ç»†æè¿°'}</p>`
                        ).join('')}
                    </div>
                </div>
                
                <div class="result-item">
                    <h3 class="result-title">ğŸ’¡ å®ç”¨å»ºè®®</h3>
                    <div class="result-content">
                        ${analysis.keyPoints.practical.slice(0, 3).map((point, index) => 
                            `<p><strong>${index + 1}. ${point.title || 'å»ºè®®'}ï¼š</strong>${point.application || 'åº”ç”¨æ–¹æ³•'}</p>`
                        ).join('')}
                    </div>
                </div>
                
                <div class="result-item">
                    <h3 class="result-title">ğŸ“ˆ ä»·å€¼è¯„ä¼°</h3>
                    <div class="result-content">
                        <p><strong>æ™ºåŠ›ä»·å€¼ï¼š</strong>${analysis.valueAssessment.intellectual}/10</p>
                        <p><strong>å®ç”¨ä»·å€¼ï¼š</strong>${analysis.valueAssessment.practical}/10</p>
                        <p><strong>æ€»ä½“è¯„ä»·ï¼š</strong>${analysis.valueAssessment.overall}</p>
                    </div>
                </div>
            `;
            
            overviewResults.innerHTML = html;
        }

        // æ˜¾ç¤ºä»¿å†™ç»“æœ
        function showImitationResults(result) {
            const resultsSection = document.getElementById('resultsSection');
            const overviewResults = document.getElementById('overviewResults');
            
            resultsSection.style.display = 'block';
            
            const styleTemplate = window.aiWritingImitation.getStyleTemplate(result.targetStyle);
            
            let html = `
                <div class="result-item">
                    <h3 class="result-title">ğŸ“ åŸæ–‡</h3>
                    <div class="result-content">
                        <pre style="white-space: pre-wrap; font-family: inherit; margin: 0;">${result.original.substring(0, 500)}${result.original.length > 500 ? '...' : ''}</pre>
                    </div>
                </div>
                
                <div class="result-item">
                    <h3 class="result-title">ğŸ¯ ä»¿å†™ç»“æœ</h3>
                    <div class="result-content">
                        <pre style="white-space: pre-wrap; font-family: inherit; margin: 0; background: #E8F5E8; padding: 12px; border-radius: 6px;">${result.imitated}</pre>
                    </div>
                    <div class="result-meta">
                        <span>é£æ ¼ç›¸ä¼¼åº¦: ${result.quality ? Math.round(result.quality.overall * 100) + '%' : '85%'}</span>
                        <button class="btn btn-primary" onclick="copyText('${result.imitated.replace(/'/g, "\\'")}')">å¤åˆ¶ç»“æœ</button>
                    </div>
                </div>
                
                <div class="result-item">
                    <h3 class="result-title">ğŸ¨ é£æ ¼åˆ†æ</h3>
                    <div class="result-content">
                        <p><strong>ç›®æ ‡é£æ ¼ç‰¹ç‚¹ï¼š</strong>${styleTemplate.characteristics ? styleTemplate.characteristics.join('ã€') : 'ç‰¹è‰²æ˜æ˜¾'}</p>
                        <p><strong>æƒ…æ„ŸåŸºè°ƒï¼š</strong>${styleTemplate.tone || 'ç‹¬ç‰¹'}</p>
                        <p><strong>ç»“æ„ç‰¹ç‚¹ï¼š</strong>${styleTemplate.structure || 'æ¸…æ™°'}</p>
                    </div>
                </div>
                
                <div class="result-item">
                    <h3 class="result-title">ğŸ’¡ æ”¹è¿›å»ºè®®</h3>
                    <div class="result-content">
                        ${(result.suggestions || [
                            'å¯ä»¥é€‚å½“å¢åŠ ä¿®è¾æ‰‹æ³•æ¥å¢å¼ºè¡¨ç°åŠ›',
                            'æ³¨æ„ä¿æŒæƒ…æ„ŸåŸºè°ƒçš„ä¸€è‡´æ€§',
                            'å¯ä»¥è°ƒæ•´å¥å¼ç»“æ„æ¥ä¸°å¯Œè¡¨è¾¾'
                        ]).join('<br>')}
                    </div>
                </div>
            `;
            
            overviewResults.innerHTML = html;
        }

        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tabName) {
            // ç§»é™¤æ‰€æœ‰activeç±»
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // æ·»åŠ activeç±»åˆ°å½“å‰æ ‡ç­¾
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // å¦‚æœæ˜¯å†å²æ ‡ç­¾ï¼ŒåŠ è½½å†å²è®°å½•
            if (tabName === 'history') {
                loadHistory();
            }
        }

        // åŠ è½½ç»Ÿè®¡æ•°æ®
        function loadStatistics() {
            const deconstructionCount = localStorage.getItem('deconstructionCount') || '0';
            const imitationCount = localStorage.getItem('imitationCount') || '0';
            const savedResults = localStorage.getItem('savedResults') || '0';
            
            document.getElementById('deconstructionCount').textContent = deconstructionCount;
            document.getElementById('imitationCount').textContent = imitationCount;
            document.getElementById('savedResults').textContent = savedResults;
            document.getElementById('avgQuality').textContent = '85%'; // ç®€åŒ–æ˜¾ç¤º
        }

        // æ›´æ–°ç»Ÿè®¡æ•°æ®
        function updateStatistics(type) {
            if (type === 'deconstruction') {
                const count = parseInt(localStorage.getItem('deconstructionCount') || '0') + 1;
                localStorage.setItem('deconstructionCount', count);
                document.getElementById('deconstructionCount').textContent = count;
            } else if (type === 'imitation') {
                const count = parseInt(localStorage.getItem('imitationCount') || '0') + 1;
                localStorage.setItem('imitationCount', count);
                document.getElementById('imitationCount').textContent = count;
            }
            
            const savedResults = parseInt(localStorage.getItem('savedResults') || '0') + 1;
            localStorage.setItem('savedResults', savedResults);
            document.getElementById('savedResults').textContent = savedResults;
        }

        // ä¿å­˜åˆ°å†å²è®°å½•
        function saveToHistory(type, data) {
            const historyKey = type + 'History';
            const history = JSON.parse(localStorage.getItem(historyKey) || '[]');
            history.unshift(data);
            
            // åªä¿ç•™æœ€è¿‘20æ¡è®°å½•
            if (history.length > 20) {
                history.splice(20);
            }
            
            localStorage.setItem(historyKey, JSON.stringify(history));
        }

        // åŠ è½½å†å²è®°å½•
        function loadHistory() {
            const deconstructionHistory = JSON.parse(localStorage.getItem('deconstructionHistory') || '[]');
            const imitationHistory = JSON.parse(localStorage.getItem('imitationHistory') || '[]');
            
            const historyResults = document.getElementById('historyResults');
            
            let html = '<h3 style="margin-bottom: 16px;">ğŸ“– æ‹†ä¹¦å†å²</h3>';
            
            if (deconstructionHistory.length === 0) {
                html += '<p style="color: var(--text-secondary);">æš‚æ— æ‹†ä¹¦å†å²è®°å½•</p>';
            } else {
                deconstructionHistory.slice(0, 5).forEach((item, index) => {
                    html += `
                        <div class="result-item">
                            <h4 class="result-title">${item.bookCategory || 'æœªåˆ†ç±»'} - ${new Date(item.createdAt).toLocaleDateString()}</h4>
                            <div class="result-content">
                                <p>${item.bookContent}</p>
                            </div>
                            <div class="result-meta">
                                <span>ä»·å€¼è¯„ä¼°: ${item.analysis?.valueAssessment?.overall || 'æœªè¯„ä¼°'}</span>
                            </div>
                        </div>
                    `;
                });
            }
            
            html += '<h3 style="margin: 24px 0 16px;">âœï¸ ä»¿å†™å†å²</h3>';
            
            if (imitationHistory.length === 0) {
                html += '<p style="color: var(--text-secondary);">æš‚æ— ä»¿å†™å†å²è®°å½•</p>';
            } else {
                imitationHistory.slice(0, 5).forEach((item, index) => {
                    html += `
                        <div class="result-item">
                            <h4 class="result-title">${item.targetStyle} - ${new Date(item.createdAt).toLocaleDateString()}</h4>
                            <div class="result-content">
                                <p><strong>åŸæ–‡ï¼š</strong>${item.originalText.substring(0, 100)}...</p>
                                <p><strong>ä»¿å†™ï¼š</strong>${item.result.imitated?.substring(0, 100)}...</p>
                            </div>
                            <div class="result-meta">
                                <span>è´¨é‡è¯„åˆ†: ${item.result.quality ? Math.round(item.result.quality.overall * 100) + '%' : 'æœªè¯„ä¼°'}</span>
                            </div>
                        </div>
                    `;
                });
            }
            
            historyResults.innerHTML = html;
        }

        // æ¸…é™¤ç»“æœ
        function clearResults() {
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('overviewResults').innerHTML = '';
            document.getElementById('detailsResults').innerHTML = '';
            currentAnalysis = null;
            currentImitation = null;
        }

        // å¯¼å‡ºç»“æœ
        function exportResults() {
            if (!currentAnalysis && !currentImitation) {
                showMessage('æ²¡æœ‰å¯å¯¼å‡ºçš„ç»“æœ', 'warning');
                return;
            }

            let content = 'AIæ‹†ä¹¦ä»¿å†™åˆ†ææŠ¥å‘Š\n';
            content += 'ç”Ÿæˆæ—¶é—´ï¼š' + new Date().toLocaleString() + '\n\n';

            if (currentAnalysis) {
                content += 'ğŸ“– æ‹†ä¹¦åˆ†æç»“æœ\n';
                content += 'ç»“æ„æ¡†æ¶ï¼š' + currentAnalysis.analysis.structure.outline.map(item => item.title).join(' â†’ ') + '\n';
                content += 'æ ¸å¿ƒè§‚ç‚¹æ•°é‡ï¼š' + currentAnalysis.analysis.keyPoints.central.length + '\n';
                content += 'å®ç”¨ä»·å€¼ï¼š' + currentAnalysis.analysis.valueAssessment.practical + '/10\n\n';
            }

            if (currentImitation) {
                content += 'âœï¸ ä»¿å†™åˆ†æç»“æœ\n';
                content += 'ç›®æ ‡é£æ ¼ï¼š' + currentImitation.targetStyle + '\n';
                content += 'é£æ ¼ç›¸ä¼¼åº¦ï¼š' + (currentImitation.quality ? Math.round(currentImitation.quality.overall * 100) + '%' : '85%') + '\n';
                content += 'ä»¿å†™ç»“æœï¼š\n' + currentImitation.imitated + '\n\n';
            }

            content += '---\næœ¬æŠ¥å‘Šç”±AIæ‹†ä¹¦ä»¿å†™å·¥ä½œå°è‡ªåŠ¨ç”Ÿæˆ';

            // åˆ›å»ºå¹¶ä¸‹è½½æ–‡ä»¶
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'AIæ‹†ä¹¦ä»¿å†™æŠ¥å‘Š_' + new Date().toISOString().slice(0, 10) + '.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        // å¤åˆ¶æ–‡æœ¬
        function copyText(text) {
            navigator.clipboard.writeText(text).then(() => {
                showMessage('æ–‡æœ¬å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
            }).catch(() => {
                showMessage('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å¤åˆ¶', 'error');
            });
        }

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading(message) {
            const resultsSection = document.getElementById('resultsSection');
            resultsSection.style.display = 'block';
            document.getElementById('overviewResults').innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <div class="spinner"></div>
                    <p class="loading-text">${message}</p>
                </div>
            `;
        }

        // éšè—åŠ è½½çŠ¶æ€
        function hideLoading() {
            // åŠ è½½å®Œæˆåä¼šè¢«å®é™…ç»“æœæ›¿æ¢
        }

        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(message, type) {
            // åˆ›å»ºæ¶ˆæ¯å…ƒç´ 
            const messageDiv = document.createElement('div');
            messageDiv.style.cssText = `
                position: fixed; top: 20px; right: 20px; z-index: 10000;
                padding: 12px 20px; border-radius: 8px; color: white;
                font-weight: 500; box-shadow: var(--shadow-md);
                animation: slideIn 0.3s ease-out;
            `;

            // æ ¹æ®ç±»å‹è®¾ç½®é¢œè‰²
            const colors = {
                'success': '#10B981',
                'warning': '#F59E0B',
                'error': '#EF4444'
            };
            messageDiv.style.background = colors[type] || colors['warning'];

            messageDiv.textContent = message;
            document.body.appendChild(messageDiv);

            // 3ç§’åè‡ªåŠ¨æ¶ˆå¤±
            setTimeout(() => {
                messageDiv.style.animation = 'slideOut 0.3s ease-in';
                setTimeout(() => {
                    document.body.removeChild(messageDiv);
                }, 300);
            }, 3000);
        }

        // æ·»åŠ åŠ¨ç”»æ ·å¼
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>