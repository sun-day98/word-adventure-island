<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FitLife - èº«ä½“æ•°æ®</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="page-container">
        <!-- é¡µé¢å¤´éƒ¨ -->
        <header class="page-header">
            <button class="back-btn" onclick="parent.navigateToPage('profile.html')">â† è¿”å›</button>
            <h1>èº«ä½“æ•°æ®è®°å½•</h1>
            <button class="history-btn" onclick="showHistory()">ğŸ“Š</button>
        </header>

        <!-- æ•°æ®æ¦‚è§ˆå¡ç‰‡ -->
        <section class="data-overview">
            <div class="current-data">
                <h2>å½“å‰æ•°æ®</h2>
                <div class="data-grid">
                    <div class="data-card primary">
                        <div class="data-label">ä½“é‡</div>
                        <div class="data-value">
                            <span class="value-number">68.5</span>
                            <span class="value-unit">kg</span>
                        </div>
                        <div class="data-change negative">-0.5</div>
                    </div>
                    
                    <div class="data-card secondary">
                        <div class="data-label">BMI</div>
                        <div class="data-value">
                            <span class="value-number">22.4</span>
                            <span class="value-unit"></span>
                        </div>
                        <div class="data-status normal">æ­£å¸¸</div>
                    </div>
                    
                    <div class="data-card tertiary">
                        <div class="data-label">ä½“è„‚ç‡</div>
                        <div class="data-value">
                            <span class="value-number">18.2</span>
                            <span class="value-unit">%</span>
                        </div>
                        <div class="data-change negative">-0.3</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- å¿«é€Ÿå½•å…¥ -->
        <section class="quick-record">
            <h2>å¿«é€Ÿè®°å½•</h2>
            <div class="quick-inputs">
                <div class="input-group">
                    <label for="weight-input">ä½“é‡ (kg)</label>
                    <div class="input-with-unit">
                        <input type="number" id="weight-input" value="68.5" step="0.1" min="30" max="200" class="number-input">
                        <span class="unit">kg</span>
                    </div>
                </div>
                
                <div class="input-group">
                    <label for="body-fat-input">ä½“è„‚ç‡ (%)</label>
                    <div class="input-with-unit">
                        <input type="number" id="body-fat-input" value="18.2" step="0.1" min="5" max="50" class="number-input">
                        <span class="unit">%</span>
                    </div>
                </div>
                
                <div class="input-group">
                    <label for="muscle-mass-input">è‚Œè‚‰é‡ (kg)</label>
                    <div class="input-with-unit">
                        <input type="number" id="muscle-mass-input" value="52.3" step="0.1" min="20" max="100" class="number-input">
                        <span class="unit">kg</span>
                    </div>
                </div>
            </div>
            
            <button class="record-btn" onclick="recordData()">è®°å½•ä»Šæ—¥æ•°æ®</button>
        </section>

        <!-- è¯¦ç»†æ•°æ®å½•å…¥ -->
        <section class="detailed-record">
            <h2>è¯¦ç»†æ•°æ®</h2>
            <div class="toggle-btn" onclick="toggleDetailed()">
                <span id="toggle-text">å±•å¼€è¯¦ç»†æ•°æ®</span>
                <span id="toggle-icon">â–¼</span>
            </div>
            
            <div class="detailed-form" id="detailed-form" style="display: none;">
                <div class="form-grid">
                    <div class="form-item">
                        <label for="waist">è…°å›´ (cm)</label>
                        <input type="number" id="waist" step="0.1" min="50" max="150" class="form-input" placeholder="è¯·è¾“å…¥è…°å›´">
                    </div>
                    
                    <div class="form-item">
                        <label for="chest">èƒ¸å›´ (cm)</label>
                        <input type="number" id="chest" step="0.1" min="60" max="150" class="form-input" placeholder="è¯·è¾“å…¥èƒ¸å›´">
                    </div>
                    
                    <div class="form-item">
                        <label for="arm">è‡‚å›´ (cm)</label>
                        <input type="number" id="arm" step="0.1" min="20" max="60" class="form-input" placeholder="è¯·è¾“å…¥è‡‚å›´">
                    </div>
                    
                    <div class="form-item">
                        <label for="thigh">å¤§è…¿å›´ (cm)</label>
                        <input type="number" id="thigh" step="0.1" min="30" max="80" class="form-input" placeholder="è¯·è¾“å…¥å¤§è…¿å›´">
                    </div>
                    
                    <div class="form-item">
                        <label for="hip">è‡€å›´ (cm)</label>
                        <input type="number" id="hip" step="0.1" min="60" max="150" class="form-input" placeholder="è¯·è¾“å…¥è‡€å›´">
                    </div>
                    
                    <div class="form-item">
                        <label for="calf">å°è…¿å›´ (cm)</label>
                        <input type="number" id="calf" step="0.1" min="20" max="60" class="form-input" placeholder="è¯·è¾“å…¥å°è…¿å›´">
                    </div>
                </div>
                
                <div class="body-composition">
                    <h3>èº«ä½“æˆåˆ†åˆ†æ</h3>
                    <div class="composition-grid">
                        <div class="composition-item">
                            <label for="bone-mass">éª¨é‡ (kg)</label>
                            <input type="number" id="bone-mass" step="0.01" min="1" max="10" class="form-input">
                        </div>
                        
                        <div class="composition-item">
                            <label for="water-rate">æ°´åˆ†ç‡ (%)</label>
                            <input type="number" id="water-rate" step="0.1" min="30" max="70" class="form-input">
                        </div>
                        
                        <div class="composition-item">
                            <label for="visceral-fat">å†…è„è„‚è‚ªç­‰çº§</label>
                            <input type="number" id="visceral-fat" min="1" max="30" class="form-input">
                        </div>
                        
                        <div class="composition-item">
                            <label for="basal-metabolism">åŸºç¡€ä»£è°¢ (kcal)</label>
                            <input type="number" id="basal-metabolism" min="800" max="3000" class="form-input">
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- è¶‹åŠ¿å›¾è¡¨ -->
        <section class="trend-charts">
            <h2>æ•°æ®è¶‹åŠ¿</h2>
            <div class="chart-tabs">
                <button class="tab-btn active" onclick="switchChart('weight')">ä½“é‡</button>
                <button class="tab-btn" onclick="switchChart('body-fat')">ä½“è„‚ç‡</button>
                <button class="tab-btn" onclick="switchChart('bmi')">BMI</button>
                <button class="tab-btn" onclick="switchChart('muscle')">è‚Œè‚‰é‡</button>
            </div>
            
            <div class="chart-container">
                <canvas id="trend-chart" width="300" height="200"></canvas>
            </div>
            
            <div class="chart-period">
                <button class="period-btn" onclick="changePeriod('7d')">7å¤©</button>
                <button class="period-btn active" onclick="changePeriod('30d')">30å¤©</button>
                <button class="period-btn" onclick="changePeriod('90d')">3ä¸ªæœˆ</button>
                <button class="period-btn" onclick="changePeriod('1y')">1å¹´</button>
            </div>
        </section>

        <!-- ç›®æ ‡è¿½è¸ª -->
        <section class="goal-tracking">
            <h2>ç›®æ ‡è¿½è¸ª</h2>
            <div class="goal-progress">
                <div class="goal-item">
                    <div class="goal-header">
                        <span class="goal-name">ç›®æ ‡ä½“é‡</span>
                        <span class="goal-target">65.0 kg</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 65%"></div>
                    </div>
                    <div class="goal-status">
                        <span class="current">å½“å‰: 68.5 kg</span>
                        <span class="remaining">è¿˜éœ€å‡é‡: 3.5 kg</span>
                    </div>
                </div>
                
                <div class="goal-item">
                    <div class="goal-header">
                        <span class="goal-name">ç›®æ ‡ä½“è„‚ç‡</span>
                        <span class="goal-target">15.0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 40%"></div>
                    </div>
                    <div class="goal-status">
                        <span class="current">å½“å‰: 18.2%</span>
                        <span class="remaining">è¿˜éœ€é™ä½: 3.2%</span>
                    </div>
                </div>
            </div>
            
            <button class="edit-goal-btn" onclick="editGoals()">ç¼–è¾‘ç›®æ ‡</button>
        </section>

        <!-- å†å²è®°å½• -->
        <section class="history-records">
            <h2>å†å²è®°å½•</h2>
            <div class="record-list">
                <div class="record-item">
                    <div class="record-date">
                        <div class="date">12æœˆ5æ—¥</div>
                        <div class="time">08:30</div>
                    </div>
                    <div class="record-data">
                        <div class="data-point">
                            <span class="label">ä½“é‡</span>
                            <span class="value">68.5 kg</span>
                        </div>
                        <div class="data-point">
                            <span class="label">ä½“è„‚ç‡</span>
                            <span class="value">18.2%</span>
                        </div>
                        <div class="data-point">
                            <span class="label">è‚Œè‚‰é‡</span>
                            <span class="value">52.3 kg</span>
                        </div>
                    </div>
                    <div class="record-actions">
                        <button class="action-btn" onclick="editRecord(this)">ç¼–è¾‘</button>
                        <button class="action-btn delete" onclick="deleteRecord(this)">åˆ é™¤</button>
                    </div>
                </div>
                
                <div class="record-item">
                    <div class="record-date">
                        <div class="date">12æœˆ4æ—¥</div>
                        <div class="time">07:45</div>
                    </div>
                    <div class="record-data">
                        <div class="data-point">
                            <span class="label">ä½“é‡</span>
                            <span class="value">69.0 kg</span>
                        </div>
                        <div class="data-point">
                            <span class="label">ä½“è„‚ç‡</span>
                            <span class="value">18.5%</span>
                        </div>
                        <div class="data-point">
                            <span class="label">è‚Œè‚‰é‡</span>
                            <span class="value">52.0 kg</span>
                        </div>
                    </div>
                    <div class="record-actions">
                        <button class="action-btn" onclick="editRecord(this)">ç¼–è¾‘</button>
                        <button class="action-btn delete" onclick="deleteRecord(this)">åˆ é™¤</button>
                    </div>
                </div>
                
                <div class="record-item">
                    <div class="record-date">
                        <div class="date">12æœˆ3æ—¥</div>
                        <div class="time">08:15</div>
                    </div>
                    <div class="record-data">
                        <div class="data-point">
                            <span class="label">ä½“é‡</span>
                            <span class="value">68.8 kg</span>
                        </div>
                        <div class="data-point">
                            <span class="label">ä½“è„‚ç‡</span>
                            <span class="value">18.3%</span>
                        </div>
                        <div class="data-point">
                            <span class="label">è‚Œè‚‰é‡</span>
                            <span class="value">51.8 kg</span>
                        </div>
                    </div>
                    <div class="record-actions">
                        <button class="action-btn" onclick="editRecord(this)">ç¼–è¾‘</button>
                        <button class="action-btn delete" onclick="deleteRecord(this)">åˆ é™¤</button>
                    </div>
                </div>
            </div>
            
            <button class="load-more-btn" onclick="loadMoreRecords()">åŠ è½½æ›´å¤š</button>
        </section>
    </div>

    <!-- ç›®æ ‡ç¼–è¾‘å¼¹çª— -->
    <div class="modal-overlay" id="goal-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ç¼–è¾‘ç›®æ ‡</h3>
                <button class="close-btn" onclick="closeGoalModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="target-weight">ç›®æ ‡ä½“é‡ (kg)</label>
                    <input type="number" id="target-weight" value="65.0" step="0.1" min="30" max="200">
                </div>
                <div class="form-group">
                    <label for="target-body-fat">ç›®æ ‡ä½“è„‚ç‡ (%)</label>
                    <input type="number" id="target-body-fat" value="15.0" step="0.1" min="5" max="50">
                </div>
                <div class="form-group">
                    <label for="target-date">ç›®æ ‡æ—¥æœŸ</label>
                    <input type="date" id="target-date" value="2025-03-01">
                </div>
            </div>
            <div class="modal-footer">
                <button class="secondary-btn" onclick="closeGoalModal()">å–æ¶ˆ</button>
                <button class="primary-btn" onclick="saveGoals()">ä¿å­˜ç›®æ ‡</button>
            </div>
        </div>
    </div>

    <script src="js/data-charts.js"></script>
    <script>
        let currentChartType = 'weight';
        let currentPeriod = '30d';

        function recordData() {
            const weight = document.getElementById('weight-input').value;
            const bodyFat = document.getElementById('body-fat-input').value;
            const muscleMass = document.getElementById('muscle-mass-input').value;
            
            if (!weight || !bodyFat || !muscleMass) {
                alert('è¯·å¡«å†™å®Œæ•´çš„èº«ä½“æ•°æ®');
                return;
            }
            
            // éªŒè¯æ•°æ®èŒƒå›´
            if (weight < 30 || weight > 200) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„ä½“é‡æ•°æ®');
                return;
            }
            
            if (bodyFat < 5 || bodyFat > 50) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„ä½“è„‚ç‡æ•°æ®');
                return;
            }
            
            // æ¨¡æ‹Ÿä¿å­˜æ•°æ®
            const recordData = {
                date: new Date().toISOString(),
                weight: parseFloat(weight),
                bodyFat: parseFloat(bodyFat),
                muscleMass: parseFloat(muscleMass),
                detailedData: {
                    waist: document.getElementById('waist').value,
                    chest: document.getElementById('chest').value,
                    arm: document.getElementById('arm').value,
                    thigh: document.getElementById('thigh').value,
                    hip: document.getElementById('hip').value,
                    calf: document.getElementById('calf').value,
                    boneMass: document.getElementById('bone-mass').value,
                    waterRate: document.getElementById('water-rate').value,
                    visceralFat: document.getElementById('visceral-fat').value,
                    basalMetabolism: document.getElementById('basal-metabolism').value
                }
            };
            
            console.log('ä¿å­˜èº«ä½“æ•°æ®:', recordData);
            
            // æ˜¾ç¤ºä¿å­˜æˆåŠŸæç¤º
            const recordBtn = document.querySelector('.record-btn');
            const originalText = recordBtn.textContent;
            recordBtn.textContent = 'ä¿å­˜ä¸­...';
            recordBtn.disabled = true;
            
            setTimeout(() => {
                recordBtn.textContent = 'å·²ä¿å­˜';
                setTimeout(() => {
                    recordBtn.textContent = originalText;
                    recordBtn.disabled = false;
                    
                    // æ›´æ–°å½“å‰æ•°æ®æ˜¾ç¤º
                    updateCurrentDisplay(recordData);
                }, 1000);
            }, 1000);
        }

        function updateCurrentDisplay(data) {
            // æ›´æ–°é¦–é¡µæ˜¾ç¤ºçš„æ•°æ®
            document.querySelector('.data-card.primary .value-number').textContent = data.weight;
            document.querySelector('.data-card.tertiary .value-number').textContent = data.bodyFat;
            
            // é‡æ–°è®¡ç®—BMI
            const height = 175; // å‡è®¾èº«é«˜ï¼Œå®é™…åº”è¯¥ä»ç”¨æˆ·èµ„æ–™è·å–
            const bmi = (data.weight / ((height / 100) ** 2)).toFixed(1);
            document.querySelector('.data-card.secondary .value-number').textContent = bmi;
        }

        function toggleDetailed() {
            const form = document.getElementById('detailed-form');
            const toggleText = document.getElementById('toggle-text');
            const toggleIcon = document.getElementById('toggle-icon');
            
            if (form.style.display === 'none') {
                form.style.display = 'block';
                toggleText.textContent = 'æ”¶èµ·è¯¦ç»†æ•°æ®';
                toggleIcon.textContent = 'â–²';
            } else {
                form.style.display = 'none';
                toggleText.textContent = 'å±•å¼€è¯¦ç»†æ•°æ®';
                toggleIcon.textContent = 'â–¼';
            }
        }

        function switchChart(type) {
            currentChartType = type;
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // é‡æ–°ç»˜åˆ¶å›¾è¡¨
            drawChart(type);
        }

        function changePeriod(period) {
            currentPeriod = period;
            document.querySelectorAll('.period-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // é‡æ–°ç»˜åˆ¶å›¾è¡¨
            drawChart(currentChartType);
        }

        function drawChart(type) {
            const canvas = document.getElementById('trend-chart');
            if (canvas && window.drawBodyDataChart) {
                drawBodyDataChart(canvas, type, currentPeriod);
            }
        }

        function editGoals() {
            document.getElementById('goal-modal').style.display = 'block';
        }

        function closeGoalModal() {
            document.getElementById('goal-modal').style.display = 'none';
        }

        function saveGoals() {
            const targetWeight = document.getElementById('target-weight').value;
            const targetBodyFat = document.getElementById('target-body-fat').value;
            const targetDate = document.getElementById('target-date').value;
            
            console.log('ä¿å­˜ç›®æ ‡:', {
                weight: targetWeight,
                bodyFat: targetBodyFat,
                date: targetDate
            });
            
            alert('ç›®æ ‡å·²æ›´æ–°');
            closeGoalModal();
        }

        function editRecord(btn) {
            const recordItem = btn.closest('.record-item');
            const data = recordItem.querySelector('.record-data');
            // å®ç°ç¼–è¾‘é€»è¾‘
            alert('ç¼–è¾‘è®°å½•åŠŸèƒ½');
        }

        function deleteRecord(btn) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ')) {
                const recordItem = btn.closest('.record-item');
                recordItem.remove();
            }
        }

        function loadMoreRecords() {
            // æ¨¡æ‹ŸåŠ è½½æ›´å¤šè®°å½•
            alert('åŠ è½½æ›´å¤šå†å²è®°å½•');
        }

        function showHistory() {
            // æ˜¾ç¤ºå®Œæ•´çš„å†å²è®°å½•é¡µé¢
            alert('æ˜¾ç¤ºå®Œæ•´å†å²è®°å½•');
        }

        // åˆå§‹åŒ–å›¾è¡¨
        document.addEventListener('DOMContentLoaded', function() {
            drawChart('weight');
        });

        // å®æ—¶è®¡ç®—BMI
        document.getElementById('weight-input').addEventListener('input', function() {
            const weight = parseFloat(this.value);
            const height = 175; // å‡è®¾èº«é«˜ï¼Œå®é™…åº”è¯¥ä»ç”¨æˆ·èµ„æ–™è·å–
            
            if (weight && height) {
                const bmi = (weight / ((height / 100) ** 2)).toFixed(1);
                console.log('å®æ—¶BMI:', bmi);
            }
        });
    </script>
</body>
</html>