<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <title>FitLife - è¿åŠ¨å¥èº«APP</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/ios-status-bar.css">
    
    <!-- Cordova CSSåŠ è½½ä¼˜åŒ– -->
    <style>
        /* é¢„åŠ è½½æ ·å¼ï¼Œé¿å…é—ªçƒ */
        .cordova-loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #007AFF 0%, #00C6FF 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            flex-direction: column;
        }
        
        .cordova-loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .cordova-loading-text {
            color: white;
            margin-top: 20px;
            font-size: 14px;
            font-weight: 500;
        }
        
        /* Cordovaç‰¹æœ‰æ ·å¼ */
        body.cordova-device {
            /* ç¦ç”¨é»˜è®¤çš„è§¦æ‘¸é«˜äº® */
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        body.cordova-device * {
            -webkit-tap-highlight-color: transparent;
        }
        
        .bottom-nav {
            /* Cordovaä¸­åº•éƒ¨å¯¼èˆªé€‚é… */
            padding-bottom: env(safe-area-inset-bottom);
            padding-bottom: constant(safe-area-inset-bottom);
        }
        
        .app-container {
            /* å…¨å±æ˜¾ç¤º */
            height: 100vh;
            height: 100dvh; /* åŠ¨æ€è§†å£é«˜åº¦ */
        }
        
        /* iOSåˆ˜æµ·å±é€‚é… */
        @supports (padding-top: env(safe-area-inset-top)) {
            .app-container {
                padding-top: env(safe-area-inset-top);
                padding-top: constant(safe-area-inset-top);
            }
        }
    </style>
</head>
<body>
    <!-- Cordovaå¯åŠ¨å±å ä½ -->
    <div id="cordova-loading" class="cordova-loading">
        <div class="cordova-loading-spinner"></div>
        <div class="cordova-loading-text">FitLifeå¯åŠ¨ä¸­...</div>
    </div>

    <!-- ä¸»å®¹å™¨ -->
    <div class="app-container">
        <!-- iOSçŠ¶æ€æ æ¨¡æ‹Ÿï¼ˆä»…åœ¨Webç«¯æ˜¾ç¤ºï¼‰ -->
        <div class="ios-status-bar web-only" style="display: none;">
            <div class="status-left">
                <span class="time">9:41</span>
            </div>
            <div class="status-center"></div>
            <div class="status-right">
                <span class="signal"></span>
                <span class="wifi"></span>
                <span class="battery">100%</span>
            </div>
        </div>

        <!-- iframeå®¹å™¨ï¼Œç”¨äºåŠ è½½å„ä¸ªé¡µé¢ -->
        <iframe id="page-frame" src="home.html" frameborder="0"></iframe>
        
        <!-- åº•éƒ¨å¯¼èˆªæ  -->
        <nav class="bottom-nav">
            <a href="home.html" class="nav-item active" data-page="home">
                <div class="nav-icon">ğŸ </div>
                <span>é¦–é¡µ</span>
            </a>
            <a href="courses.html" class="nav-item" data-page="courses">
                <div class="nav-icon">ğŸ’ª</div>
                <span>è¯¾ç¨‹</span>
            </a>
            <a href="diet.html" class="nav-item" data-page="diet">
                <div class="nav-icon">ğŸ¥—</div>
                <span>é¥®é£Ÿ</span>
            </a>
            <a href="profile.html" class="nav-item" data-page="profile">
                <div class="nav-icon">ğŸ‘¤</div>
                <span>æˆ‘çš„</span>
            </a>
        </nav>
    </div>

    <!-- å…¨å±€åŠ è½½æç¤º -->
    <div id="global-loading" class="loading-overlay" style="display: none;">
        <div class="loading-spinner"></div>
        <p>åŠ è½½ä¸­...</p>
    </div>

    <!-- Cordovaè„šæœ¬ -->
    <script src="cordova.js"></script>
    <script src="js/main.js"></script>
    <script src="js/form-validation.js"></script>
    <script src="js/data-charts.js"></script>
    <script src="js/mock-data.js"></script>
    
    <!-- Cordovaåˆå§‹åŒ–è„šæœ¬ -->
    <script>
        // ç­‰å¾…è®¾å¤‡å°±ç»ª
        document.addEventListener('deviceready', function() {
            console.log('Cordovaè®¾å¤‡å°±ç»ª');
            
            // è®¾ç½®è®¾å¤‡æ ‡è¯†
            document.body.classList.add('cordova-device');
            
            // éšè—çŠ¶æ€æ æ¨¡æ‹Ÿï¼ˆä½¿ç”¨åŸç”ŸçŠ¶æ€æ ï¼‰
            const statusBar = document.querySelector('.ios-status-bar.web-only');
            if (statusBar) {
                statusBar.style.display = 'none';
            }
            
            // é…ç½®çŠ¶æ€æ 
            if (window.StatusBar) {
                StatusBar.backgroundColorByHexString('#007AFF');
                StatusBar.styleLightContent();
            }
            
            // é…ç½®å±å¹•æ–¹å‘
            if (window.screen && window.screen.orientation) {
                screen.orientation.lock('portrait');
            }
            
            // é…ç½®å¯åŠ¨å±
            if (navigator.splashscreen) {
                setTimeout(function() {
                    navigator.splashscreen.hide();
                }, 2000);
            }
            
            // éšè—åŠ è½½åŠ¨ç”»
            setTimeout(function() {
                const loadingEl = document.getElementById('cordova-loading');
                if (loadingEl) {
                    loadingEl.style.opacity = '0';
                    loadingEl.style.transition = 'opacity 0.5s ease';
                    setTimeout(() => loadingEl.remove(), 500);
                }
            }, 1500);
            
            // åˆå§‹åŒ–åº”ç”¨
            if (typeof initApp === 'function') {
                initApp();
            }
            
            // æ³¨å†Œç½‘ç»œçŠ¶æ€ç›‘å¬
            if (navigator.connection) {
                document.addEventListener('online', function() {
                    console.log('ç½‘ç»œå·²è¿æ¥');
                });
                
                document.addEventListener('offline', function() {
                    console.log('ç½‘ç»œå·²æ–­å¼€');
                    showToast('ç½‘ç»œè¿æ¥å·²æ–­å¼€ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®');
                });
            }
            
        }, false);
        
        // Webç«¯åˆå§‹åŒ–ï¼ˆç”¨äºå¼€å‘æµ‹è¯•ï¼‰
        if (!window.cordova) {
            console.log('Webç«¯æ¨¡å¼');
            document.querySelector('.ios-status-bar.web-only').style.display = 'block';
            
            // éšè—åŠ è½½åŠ¨ç”»
            setTimeout(function() {
                const loadingEl = document.getElementById('cordova-loading');
                if (loadingEl) {
                    loadingEl.style.opacity = '0';
                    loadingEl.style.transition = 'opacity 0.5s ease';
                    setTimeout(() => loadingEl.remove(), 500);
                }
            }, 1000);
            
            // åˆå§‹åŒ–åº”ç”¨
            if (typeof initApp === 'function') {
                setTimeout(initApp, 100);
            }
        }
        
        // Cordovaç‰¹æœ‰åŠŸèƒ½å¢å¼º
        document.addEventListener('deviceready', function() {
            // æ·»åŠ éœ‡åŠ¨åé¦ˆ
            if (navigator.vibrate) {
                document.addEventListener('click', function(e) {
                    if (e.target.closest('.nav-item, .btn, .card')) {
                        navigator.vibrate(50); // 50msè½»å¾®éœ‡åŠ¨
                    }
                });
            }
            
            // æ·»åŠ è¿”å›é”®ç›‘å¬
            document.addEventListener('backbutton', function(e) {
                e.preventDefault();
                
                // å¦‚æœåœ¨é¦–é¡µï¼Œæ˜¾ç¤ºé€€å‡ºç¡®è®¤
                if (document.querySelector('#page-frame').contentWindow.location.pathname.endsWith('home.html')) {
                    if (window.confirm('ç¡®å®šè¦é€€å‡ºFitLifeå—ï¼Ÿ')) {
                        navigator.app.exitApp();
                    }
                } else {
                    // å¦åˆ™è¿”å›ä¸Šä¸€é¡µ
                    history.back();
                }
            });
            
            // é˜²æ­¢åŒå‡»ç¼©æ”¾
            let lastTouchEnd = 0;
            document.addEventListener('touchend', function(e) {
                const now = Date.now();
                if (now - lastTouchEnd <= 300) {
                    e.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
        });
        
        // ç½‘ç»œé”™è¯¯å¤„ç†
        window.addEventListener('error', function(e) {
            if (e.target && e.target.tagName === 'IMG') {
                console.log('å›¾ç‰‡åŠ è½½å¤±è´¥:', e.target.src);
                // è®¾ç½®é»˜è®¤å›¾ç‰‡
                e.target.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiBmaWxsPSIjRjVGNUY1Ii8+CjxwYXRoIGQ9Ik0xMiAyQzYuNDggMiAyIDYuNDggMiAxMlM2LjQ4IDIyIDEyIDIyUzIyIDE3LjUyIDIyIDEyUzE3LjUyIDIgMTIgMloiIGZpbGw9IiNDQ0MiIi8+CjxwYXRoIGQ9Ik0xMiAxNkMxNC4yMSAxNiAxNiAxNC4yMSAxNiAxMkMxNiA5Ljc5IDE0LjIxIDggMTIgOEM5Ljc5IDggOCA5Ljc5IDggMTJDOCAxNC4yMSA5Ljc5IDE2IDEyIDE2WiIgZmlsbD0iI0NDQyIi8+Cjwvc3ZnPgo=';
            }
        }, true);
    </script>
</body>
</html>