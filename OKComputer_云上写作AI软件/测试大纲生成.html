<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤§çº²ç”ŸæˆåŠŸèƒ½æµ‹è¯•</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="story-creation-agent.js"></script>
    <style>
        body { font-family: 'Noto Sans SC', sans-serif; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen py-8">
    <div class="container mx-auto px-4 max-w-4xl">
        <h1 class="text-3xl font-bold text-gray-800 mb-8 text-center">ğŸ¯ å¤§çº²ç”ŸæˆåŠŸèƒ½æµ‹è¯•</h1>
        
        <!-- æµ‹è¯•åŒºåŸŸ -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">ğŸ“ å¤§çº²ç”Ÿæˆæµ‹è¯•</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">æ•…äº‹ç±»å‹</label>
                    <select id="story-genre" class="w-full border border-gray-300 rounded-lg px-3 py-2">
                        <option value="">è¯·é€‰æ‹©ç±»å‹</option>
                        <option value="romance">è¨€æƒ…å°è¯´</option>
                        <option value="fantasy">ç„å¹»å°è¯´</option>
                        <option value="mystery">æ‚¬ç–‘æ¨ç†</option>
                        <option value="historical">å†å²å°è¯´</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">æ•…äº‹ä¸»é¢˜</label>
                    <input type="text" id="story-theme" placeholder="ä¾‹å¦‚ï¼šå†’é™©ã€çˆ±æƒ…ã€æˆé•¿" 
                           class="w-full border border-gray-300 rounded-lg px-3 py-2">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ä¸»è§’è®¾å®š</label>
                    <input type="text" id="story-protagonist" placeholder="æè¿°æ‚¨çš„ä¸»è§’" 
                           class="w-full border border-gray-300 rounded-lg px-3 py-2">
                </div>
            </div>
            
            <div class="flex space-x-4">
                <button onclick="testAIOutline()" class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                    ğŸ¤– AIç”Ÿæˆå¤§çº²
                </button>
                <button onclick="testTemplateOutline()" class="bg-green-500 text-white px-6 py-2 rounded-lg hover:bg-green-600 transition-colors">
                    ğŸ“‹ ä½¿ç”¨æ¨¡æ¿å¤§çº²
                </button>
                <button onclick="testStoryAgent()" class="bg-purple-500 text-white px-6 py-2 rounded-lg hover:bg-purple-600 transition-colors">
                    ğŸ§ª æµ‹è¯•æ•…äº‹ä»£ç†
                </button>
            </div>
        </div>
        
        <!-- ç»“æœæ˜¾ç¤ºåŒºåŸŸ -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-semibold mb-4">ğŸ“Š ç”Ÿæˆç»“æœ</h2>
            <div id="result-container" class="text-sm text-gray-700">
                <p class="text-gray-500 italic">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•...</p>
            </div>
        </div>
        
        <!-- çŠ¶æ€æ˜¾ç¤º -->
        <div id="loading-indicator" class="hidden fixed top-4 right-4 bg-blue-500 text-white px-4 py-2 rounded-lg shadow-lg">
            æ­£åœ¨å¤„ç†ä¸­...
        </div>
    </div>

    <script>
        // åˆå§‹åŒ–æ•…äº‹åˆ›ä½œä»£ç†
        let storyCreationAgent = null;
        
        try {
            if (typeof StoryCreationAgent !== 'undefined') {
                storyCreationAgent = new StoryCreationAgent();
                console.log('âœ… æ•…äº‹åˆ›ä½œä»£ç†åˆå§‹åŒ–æˆåŠŸ');
            } else {
                console.error('âŒ StoryCreationAgent æœªæ‰¾åˆ°');
            }
        } catch (error) {
            console.error('âŒ æ•…äº‹åˆ›ä½œä»£ç†åˆå§‹åŒ–å¤±è´¥:', error);
        }
        
        function showLoading(message) {
            const indicator = document.getElementById('loading-indicator');
            indicator.textContent = message;
            indicator.classList.remove('hidden');
        }
        
        function hideLoading() {
            document.getElementById('loading-indicator').classList.add('hidden');
        }
        
        function showResult(title, content) {
            const container = document.getElementById('result-container');
            container.innerHTML = `
                <div class="mb-4">
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">${title}</h3>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        ${content}
                    </div>
                </div>
            `;
        }
        
        // æµ‹è¯•AIå¤§çº²ç”Ÿæˆ
        async function testAIOutline() {
            const genre = document.getElementById('story-genre').value;
            const theme = document.getElementById('story-theme').value;
            const protagonist = document.getElementById('story-protagonist').value;
            
            if (!genre || !theme) {
                showResult('âŒ é”™è¯¯', '<p class="text-red-600">è¯·å¡«å†™æ•…äº‹ç±»å‹å’Œä¸»é¢˜</p>');
                return;
            }
            
            try {
                showLoading('ğŸ¤– AIæ­£åœ¨ç”Ÿæˆå¤§çº²...');
                
                if (!storyCreationAgent) {
                    throw new Error('æ•…äº‹åˆ›ä½œä»£ç†æœªåˆå§‹åŒ–');
                }
                
                const query = `åˆ›ä½œä¸€ä¸ª${genre}ç±»å‹çš„æ•…äº‹ï¼Œä¸»é¢˜æ˜¯${theme}${protagonist ? 'ï¼Œä¸»è§’æ˜¯' + protagonist : ''}ï¼Œè¯·ç”Ÿæˆæ•…äº‹å¤§çº²`;
                const result = await storyCreationAgent.processUserInput(query);
                
                hideLoading();
                
                if (result && result.type === 'plot_planning') {
                    let outlineHTML = '';
                    if (result.outline && result.outline.length > 0) {
                        outlineHTML = result.outline.map((item, index) => `
                            <div class="border-l-4 border-blue-500 pl-4 mb-3">
                                <h4 class="font-medium text-blue-700">${item.phase}</h4>
                                <p class="text-gray-600">${item.description}</p>
                                ${item.keyEvents ? `
                                    <p class="text-sm text-gray-500 mt-1">
                                        <strong>å…³é”®äº‹ä»¶ï¼š</strong>${item.keyEvents.join('ã€')}
                                    </p>
                                ` : ''}
                            </div>
                        `).join('');
                    } else {
                        outlineHTML = '<p class="text-gray-500">æš‚æ— å¤§çº²å†…å®¹</p>';
                    }
                    
                    showResult('ğŸ¤– AIå¤§çº²ç”Ÿæˆç»“æœ', outlineHTML);
                } else if (result && result.suggestions) {
                    const suggestionsHTML = result.suggestions.map(suggestion => `
                        <div class="border-l-4 border-green-500 pl-4 mb-2">
                            <p>â€¢ ${suggestion}</p>
                        </div>
                    `).join('');
                    
                    showResult('ğŸ¤– AIå»ºè®®ç»“æœ', suggestionsHTML);
                } else {
                    showResult('ğŸ¤– AIå“åº”', `<pre>${JSON.stringify(result, null, 2)}</pre>`);
                }
                
            } catch (error) {
                hideLoading();
                showResult('âŒ ç”Ÿæˆå¤±è´¥', `<p class="text-red-600">é”™è¯¯ï¼š${error.message}</p>`);
            }
        }
        
        // æµ‹è¯•æ¨¡æ¿å¤§çº²
        function testTemplateOutline() {
            const genre = document.getElementById('story-genre').value;
            const theme = document.getElementById('story-theme').value;
            const protagonist = document.getElementById('story-protagonist').value;
            
            if (!genre || !theme) {
                showResult('âŒ é”™è¯¯', '<p class="text-red-600">è¯·å¡«å†™æ•…äº‹ç±»å‹å’Œä¸»é¢˜</p>');
                return;
            }
            
            const templateOutline = generateDefaultOutline(genre, theme, protagonist);
            showResult('ğŸ“‹ æ¨¡æ¿å¤§çº²ç»“æœ', templateOutline);
        }
        
        // æµ‹è¯•æ•…äº‹ä»£ç†
        async function testStoryAgent() {
            if (!storyCreationAgent) {
                showResult('âŒ é”™è¯¯', '<p class="text-red-600">æ•…äº‹åˆ›ä½œä»£ç†æœªåˆå§‹åŒ–</p>');
                return;
            }
            
            try {
                showLoading('ğŸ§ª æ­£åœ¨æµ‹è¯•æ•…äº‹ä»£ç†...');
                
                const testQuery = 'æˆ‘æƒ³å†™ä¸€ä¸ªç„å¹»å°è¯´';
                const result = await storyCreationAgent.processUserInput(testQuery);
                
                hideLoading();
                showResult('ğŸ§ª æ•…äº‹ä»£ç†æµ‹è¯•', `
                    <div class="space-y-4">
                        <div>
                            <h4 class="font-medium text-gray-800">è¾“å…¥æŸ¥è¯¢ï¼š</h4>
                            <p class="text-gray-600">${testQuery}</p>
                        </div>
                        <div>
                            <h4 class="font-medium text-gray-800">AIå“åº”ï¼š</h4>
                            <pre class="bg-gray-100 p-3 rounded text-xs overflow-auto">${JSON.stringify(result, null, 2)}</pre>
                        </div>
                        <div>
                            <h4 class="font-medium text-gray-800">å“åº”ç±»å‹ï¼š</h4>
                            <p class="text-blue-600 font-medium">${result.type || 'æœªçŸ¥'}</p>
                        </div>
                    </div>
                `);
                
            } catch (error) {
                hideLoading();
                showResult('âŒ æµ‹è¯•å¤±è´¥', `<p class="text-red-600">é”™è¯¯ï¼š${error.message}</p>`);
            }
        }
        
        // ç”Ÿæˆé»˜è®¤å¤§çº²æ¨¡æ¿
        function generateDefaultOutline(genre, theme, protagonist) {
            const genreOutlines = {
                romance: {
                    title: 'è¨€æƒ…å°è¯´å¤§çº²',
                    outline: `
                        <div class="space-y-3">
                            <div class="border-l-4 border-pink-500 pl-3">
                                <h4 class="font-medium text-pink-700">ç¬¬ä¸€ç« ï¼šåˆé‡</h4>
                                <p>ä¸»è§’${protagonist || 'å¥¹'}åœ¨ä¸€ä¸ªå¶ç„¶çš„æœºä¼šä¸­é‡åˆ°äº†å‘½ä¸­æ³¨å®šçš„äººï¼Œæ•…äº‹ç”±æ­¤å±•å¼€...</p>
                            </div>
                            <div class="border-l-4 border-pink-500 pl-3">
                                <h4 class="font-medium text-pink-700">ç¬¬äºŒç« ï¼šæƒ…æ„ŸèŒèŠ½</h4>
                                <p>ä¸¤äººé€šè¿‡æ—¥å¸¸æ¥è§¦é€æ¸äº†è§£å½¼æ­¤ï¼Œ${theme}å¼€å§‹åœ¨ä¸¤äººä¹‹é—´äº§ç”Ÿå¾®å¦™çš„åŒ–å­¦ååº”...</p>
                            </div>
                            <div class="border-l-4 border-pink-500 pl-3">
                                <h4 class="font-medium text-pink-700">ç¬¬ä¸‰ç« ï¼šæ³¢æŠ˜å‡ºç°</h4>
                                <p>æ„Ÿæƒ…å‘å±•é‡åˆ°é˜»ç¢ï¼Œå¯èƒ½æ˜¯è¯¯ä¼šã€å¤–ç•Œå› ç´ æˆ–æ˜¯å†…å¿ƒçš„çŠ¹è±«...</p>
                            </div>
                            <div class="border-l-4 border-pink-500 pl-3">
                                <h4 class="font-medium text-pink-700">ç¬¬å››ç« ï¼šè§£å†³ä¸æˆé•¿</h4>
                                <p>ç»å†æ³¢æŠ˜åï¼Œä¸»è§’ä»¬å­¦ä¼šäº†æˆé•¿ï¼Œæœ€ç»ˆæ‰¾åˆ°äº†å±äºä»–ä»¬çš„å¹¸ç¦...</p>
                            </div>
                        </div>
                    `
                },
                fantasy: {
                    title: 'ç„å¹»å°è¯´å¤§çº²',
                    outline: `
                        <div class="space-y-3">
                            <div class="border-l-4 border-purple-500 pl-3">
                                <h4 class="font-medium text-purple-700">ç¬¬ä¸€ç« ï¼šå¹³å‡¡ä¸–ç•Œçš„è§‰é†’</h4>
                                <p>ä¸»è§’${protagonist || 'ä»–'}åŸæœ¬è¿‡ç€å¹³å‡¡çš„ç”Ÿæ´»ï¼Œç›´åˆ°æŸå¤©å‘ç°äº†è‡ªå·±ä¸å¹³å‡¡çš„èƒ½åŠ›...</p>
                            </div>
                            <div class="border-l-4 border-purple-500 pl-3">
                                <h4 class="font-medium text-purple-700">ç¬¬äºŒç« ï¼šè¸ä¸Šå†’é™©ä¹‹æ—…</h4>
                                <p>ä¸ºäº†æ‹¯æ•‘ä¸–ç•Œæˆ–å¯»æ‰¾çœŸç›¸ï¼Œä¸»è§’è¸ä¸Šå……æ»¡${theme}çš„å†’é™©ä¹‹è·¯...</p>
                            </div>
                            <div class="border-l-4 border-purple-500 pl-3">
                                <h4 class="font-medium text-purple-700">ç¬¬ä¸‰ç« ï¼šè¯•ç‚¼ä¸æˆé•¿</h4>
                                <p>é¢å¯¹å„ç§æŒ‘æˆ˜å’Œæ•Œäººï¼Œä¸»è§’ä¸æ–­æˆé•¿ï¼Œå­¦ä¼šæŒæ§è‡ªå·±çš„åŠ›é‡...</p>
                            </div>
                            <div class="border-l-4 border-purple-500 pl-3">
                                <h4 class="font-medium text-purple-700">ç¬¬å››ç« ï¼šæœ€ç»ˆå†³æˆ˜</h4>
                                <p>ä¸»è§’ä¸æœ€ç»ˆçš„æ•Œäººå±•å¼€å†³æˆ˜ï¼Œ${theme}è¾¾åˆ°æœ€é«˜æ½®ï¼Œä¸–ç•Œçš„å‘½è¿æ‚¬äºä¸€çº¿...</p>
                            </div>
                            <div class="border-l-4 border-purple-500 pl-3">
                                <h4 class="font-medium text-purple-700">ç¬¬äº”ç« ï¼šæ–°çš„å¼€å§‹</h4>
                                <p>æˆ˜äº‰ç»“æŸï¼Œä¸–ç•Œæ¢å¤å’Œå¹³ï¼Œä¸»è§’ä¹Ÿæ‰¾åˆ°äº†è‡ªå·±çœŸæ­£çš„ä½¿å‘½...</p>
                            </div>
                        </div>
                    `
                }
            };
            
            const selectedOutline = genreOutlines[genre] || genreOutlines.fantasy;
            return `
                <h4 class="font-semibold text-lg text-gray-800 mb-3">${selectedOutline.title}</h4>
                ${selectedOutline.outline}
                <div class="mt-4 p-3 bg-yellow-50 rounded-lg border border-yellow-200">
                    <p class="text-sm text-yellow-800">
                        <strong>åˆ›ä½œæç¤ºï¼š</strong>è¿™æ˜¯ä¸€ä¸ªåŸºç¡€å¤§çº²æ¨¡æ¿ï¼Œä½ å¯ä»¥æ ¹æ®${theme}çš„ä¸»é¢˜è‡ªç”±å‘æŒ¥ï¼Œ
                        åœ¨æ¯ä¸ªç« èŠ‚ä¸­æ·»åŠ æ›´å¤šç»†èŠ‚å’Œå¯¹è¯ï¼Œè®©æ•…äº‹æ›´åŠ ç”ŸåŠ¨æœ‰è¶£ã€‚
                    </p>
                </div>
            `;
        }
    </script>
</body>
</html>