<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIå°è¯´åˆ›ä½œç³»ç»Ÿ - å®Œæ•´ç‰ˆ</title>
    <link rel="stylesheet" href="css/styles.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .app-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .app-header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            text-align: center;
        }

        .app-header h1 {
            font-size: 2.5em;
            font-weight: 300;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            background: #f0f9ff;
            border-radius: 20px;
            font-size: 14px;
            margin-top: 15px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-dot.online {
            background: #10b981;
        }

        .status-dot.offline {
            background: #ef4444;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .main-workspace {
            display: grid;
            grid-template-columns: 250px 1fr 300px;
            gap: 20px;
            margin-bottom: 30px;
        }

        .sidebar, .main-content, .tools-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .sidebar {
            height: fit-content;
            position: sticky;
            top: 20px;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 10px;
        }

        .nav-link {
            display: block;
            padding: 12px 15px;
            border-radius: 10px;
            text-decoration: none;
            color: #666;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .nav-link:hover {
            background: #f8f9fa;
            color: #667eea;
            transform: translateX(5px);
        }

        .nav-link.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .content-section {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-header {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .section-header h2 {
            color: #333;
            font-size: 1.8em;
            font-weight: 400;
        }

        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .tool-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .tool-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.2);
            border-color: #667eea;
        }

        .tool-icon {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .tool-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .tool-desc {
            font-size: 0.9em;
            color: #666;
        }

        .outline-list {
            margin-top: 20px;
        }

        .outline-item {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
            cursor: pointer;
            transition: all 0.3s;
        }

        .outline-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .outline-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .outline-meta {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 10px;
        }

        .outline-preview {
            color: #666;
            line-height: 1.6;
        }

        .create-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
        }

        .create-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background: #fef2f2;
            border: 2px solid #fecaca;
            color: #dc2626;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .success-message {
            background: #f0fdf4;
            border: 2px solid #bbf7d0;
            color: #16a34a;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .search-box {
            position: relative;
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 12px 15px 12px 40px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
        }

        .ai-assistant-panel {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }

        .ai-message {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 3px solid #f59e0b;
        }

        .character-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .character-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            border: 2px solid #e0e0e0;
            transition: all 0.3s;
            cursor: pointer;
        }

        .character-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .character-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #f0f0f0;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .character-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .character-type {
            font-size: 0.85em;
            color: #666;
        }

        .floating-action-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3);
            transition: all 0.3s;
            z-index: 1000;
        }

        .floating-action-btn:hover {
            transform: scale(1.1);
        }

        @media (max-width: 1024px) {
            .main-workspace {
                grid-template-columns: 1fr;
            }

            .sidebar {
                position: static;
            }

            .tools-panel {
                order: -1;
            }
        }

        @media (max-width: 768px) {
            .app-container {
                padding: 10px;
            }

            .app-header h1 {
                font-size: 2em;
            }

            .tools-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <h1>ğŸ­ AIå°è¯´åˆ›ä½œç³»ç»Ÿ</h1>
            <div class="status-indicator">
                <span class="status-dot" id="serverStatus"></span>
                <span id="statusText">æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€...</span>
            </div>
        </header>

        <div class="main-workspace">
            <!-- å·¦ä¾§å¯¼èˆªæ  -->
            <aside class="sidebar">
                <nav>
                    <ul class="nav-menu">
                        <li class="nav-item">
                            <a href="#" class="nav-link active" data-section="dashboard">ğŸ  å·¥ä½œå°</a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-section="outline">ğŸ“ æƒ…èŠ‚å¤§çº²</a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-section="characters">ğŸ‘¥ è§’è‰²ç®¡ç†</a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-section="ai-tools">ğŸ¤– AIå·¥å…·ç®±</a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-section="library">ğŸ“š ç´ æåº“</a>
                        </li>
                    </ul>
                </nav>
            </aside>

            <!-- ä¸»å†…å®¹åŒºåŸŸ -->
            <main class="main-content">
                <!-- å·¥ä½œå° -->
                <section id="dashboard" class="content-section active">
                    <div class="section-header">
                        <h2>ğŸ  åˆ›ä½œå·¥ä½œå°</h2>
                    </div>
                    
                    <div class="tools-grid">
                        <div class="tool-card" onclick="navigateToSection('outline')">
                            <div class="tool-icon">ğŸ“</div>
                            <div class="tool-title">æƒ…èŠ‚å¤§çº²</div>
                            <div class="tool-desc">æ„å»ºå®Œæ•´çš„æ•…äº‹ç»“æ„</div>
                        </div>
                        <div class="tool-card" onclick="navigateToSection('characters')">
                            <div class="tool-icon">ğŸ‘¥</div>
                            <div class="tool-title">è§’è‰²è®¾è®¡</div>
                            <div class="tool-desc">åˆ›å»ºç”ŸåŠ¨çš„äººç‰©å½¢è±¡</div>
                        </div>
                        <div class="tool-card" onclick="navigateToSection('ai-tools')">
                            <div class="tool-icon">ğŸ¤–</div>
                            <div class="tool-title">AIåŠ©æ‰‹</div>
                            <div class="tool-desc">æ™ºèƒ½åˆ›ä½œè¾…åŠ©å·¥å…·</div>
                        </div>
                        <div class="tool-card" onclick="navigateToSection('library')">
                            <div class="tool-icon">ğŸ“š</div>
                            <div class="tool-title">ç´ æåº“</div>
                            <div class="tool-desc">ä¸°å¯Œçš„åˆ›ä½œç´ æ</div>
                        </div>
                    </div>

                    <div class="outline-list">
                        <h3 style="margin-bottom: 15px;">ğŸ“‹ æœ€è¿‘çš„æƒ…èŠ‚å¤§çº²</h3>
                        <div id="recentOutlines"></div>
                        <div class="loading" id="outlinesLoading">
                            <div class="spinner"></div>
                            <p>æ­£åœ¨åŠ è½½å¤§çº²...</p>
                        </div>
                    </div>
                </section>

                <!-- æƒ…èŠ‚å¤§çº² -->
                <section id="outline" class="content-section">
                    <div class="section-header">
                        <h2>ğŸ“ æƒ…èŠ‚å¤§çº²è®¾è®¡</h2>
                    </div>
                    
                    <button class="create-btn" onclick="createNewOutline()">+ åˆ›å»ºæ–°å¤§çº²</button>
                    
                    <div class="search-box">
                        <span class="search-icon">ğŸ”</span>
                        <input type="text" class="search-input" id="outlineSearch" placeholder="æœç´¢å¤§çº²..." onkeyup="searchOutlines()">
                    </div>
                    
                    <div id="outlineList"></div>
                </section>

                <!-- è§’è‰²ç®¡ç† -->
                <section id="characters" class="content-section">
                    <div class="section-header">
                        <h2>ğŸ‘¥ è§’è‰²ç®¡ç†ç³»ç»Ÿ</h2>
                    </div>
                    
                    <button class="create-btn" onclick="createNewCharacter()">+ åˆ›å»ºæ–°è§’è‰²</button>
                    
                    <div class="character-gallery" id="characterGallery"></div>
                    <div class="loading" id="charactersLoading">
                        <div class="spinner"></div>
                        <p>æ­£åœ¨åŠ è½½è§’è‰²...</p>
                    </div>
                </section>

                <!-- AIå·¥å…·ç®± -->
                <section id="ai-tools" class="content-section">
                    <div class="section-header">
                        <h2>ğŸ¤– AIåˆ›ä½œå·¥å…·ç®±</h2>
                    </div>
                    
                    <div class="tools-grid">
                        <div class="tool-card" onclick="useAISuggestion('plot_twist')">
                            <div class="tool-icon">ğŸŒ€</div>
                            <div class="tool-title">æƒ…èŠ‚è½¬æŠ˜</div>
                            <div class="tool-desc">ç”Ÿæˆæ„å¤–è½¬æŠ˜ç‚¹</div>
                        </div>
                        <div class="tool-card" onclick="useAISuggestion('character_development')">
                            <div class="tool-icon">ğŸ­</div>
                            <div class="tool-title">è§’è‰²å‘å±•</div>
                            <div class="tool-desc">æ·±åŒ–è§’è‰²å¡‘é€ </div>
                        </div>
                        <div class="tool-card" onclick="useAISuggestion('dialogue_improvement')">
                            <div class="tool-icon">ğŸ’¬</div>
                            <div class="tool-title">å¯¹è¯ä¼˜åŒ–</div>
                            <div class="tool-desc">æ”¹å–„å¯¹è¯è´¨é‡</div>
                        </div>
                        <div class="tool-card" onclick="useAISuggestion('pacing_suggestion')">
                            <div class="tool-icon">â±ï¸</div>
                            <div class="tool-title">èŠ‚å¥æ§åˆ¶</div>
                            <div class="tool-desc">è°ƒèŠ‚å™äº‹èŠ‚å¥</div>
                        </div>
                    </div>

                    <div class="ai-assistant-panel">
                        <h3>ğŸ’¡ AIå»ºè®®é¢æ¿</h3>
                        <div id="aiSuggestions"></div>
                    </div>
                </section>

                <!-- ç´ æåº“ -->
                <section id="library" class="content-section">
                    <div class="section-header">
                        <h2>ğŸ“š åˆ›ä½œç´ æåº“</h2>
                    </div>
                    
                    <div class="search-box">
                        <span class="search-icon">ğŸ”</span>
                        <input type="text" class="search-input" id="librarySearch" placeholder="æœç´¢ç´ æ..." onkeyup="searchLibrary()">
                    </div>
                    
                    <div id="libraryContent"></div>
                </section>
            </main>

            <!-- å³ä¾§å·¥å…·é¢æ¿ -->
            <aside class="tools-panel">
                <h3 style="margin-bottom: 20px;">ğŸ“Š å¿«é€Ÿç»Ÿè®¡</h3>
                <div id="quickStats"></div>
                
                <h3 style="margin-top: 30px; margin-bottom: 20px;">ğŸš€ å¿«é€Ÿæ“ä½œ</h3>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <button class="create-btn" onclick="exportAllData()">ğŸ“¤ å¯¼å‡ºæ‰€æœ‰æ•°æ®</button>
                    <button class="create-btn" onclick="showSystemInfo()">â„¹ï¸ ç³»ç»Ÿä¿¡æ¯</button>
                </div>
            </aside>
        </div>

        <!-- æµ®åŠ¨æ“ä½œæŒ‰é’® -->
        <button class="floating-action-btn" onclick="quickCreate()">+</button>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000/api';
        let currentSection = 'dashboard';
        let outlines = [];
        let characters = [];
        let templates = [];

        // åˆå§‹åŒ–åº”ç”¨
        document.addEventListener('DOMContentLoaded', function() {
            checkServerStatus();
            setupNavigation();
            loadInitialData();
            setInterval(checkServerStatus, 30000); // æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡æœåŠ¡å™¨çŠ¶æ€
        });

        // æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€
        async function checkServerStatus() {
            try {
                const response = await fetch(`${API_BASE}/outlines`);
                const statusDot = document.getElementById('serverStatus');
                const statusText = document.getElementById('statusText');
                
                if (response.ok) {
                    statusDot.className = 'status-dot online';
                    statusText.textContent = 'æœåŠ¡å™¨è¿æ¥æ­£å¸¸';
                } else {
                    throw new Error('æœåŠ¡å™¨å“åº”å¼‚å¸¸');
                }
            } catch (error) {
                const statusDot = document.getElementById('serverStatus');
                const statusText = document.getElementById('statusText');
                statusDot.className = 'status-dot offline';
                statusText.textContent = 'æœåŠ¡å™¨è¿æ¥å¤±è´¥';
                console.warn('æœåŠ¡å™¨çŠ¶æ€æ£€æŸ¥å¤±è´¥:', error);
            }
        }

        // è®¾ç½®å¯¼èˆª
        function setupNavigation() {
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const section = this.dataset.section;
                    navigateToSection(section);
                });
            });
        }

        // å¯¼èˆªåˆ°æŒ‡å®šåŒºåŸŸ
        function navigateToSection(section) {
            // æ›´æ–°å¯¼èˆªçŠ¶æ€
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            document.querySelector(`[data-section="${section}"]`).classList.add('active');

            // åˆ‡æ¢å†…å®¹åŒºåŸŸ
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(section).classList.add('active');

            currentSection = section;

            // æ ¹æ®åŒºåŸŸåŠ è½½ç›¸åº”æ•°æ®
            switch(section) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'outline':
                    loadOutlines();
                    break;
                case 'characters':
                    loadCharacters();
                    break;
                case 'ai-tools':
                    loadAITools();
                    break;
                case 'library':
                    loadLibrary();
                    break;
            }
        }

        // åŠ è½½åˆå§‹æ•°æ®
        async function loadInitialData() {
            await Promise.all([
                loadOutlinesData(),
                loadCharactersData(),
                loadTemplatesData()
            ]);
            loadDashboard();
            updateQuickStats();
        }

        // åŠ è½½å¤§çº²æ•°æ®
        async function loadOutlinesData() {
            try {
                const response = await fetch(`${API_BASE}/outlines`);
                const result = await response.json();
                if (result.success) {
                    outlines = result.data;
                }
            } catch (error) {
                console.error('åŠ è½½å¤§çº²æ•°æ®å¤±è´¥:', error);
                // ä½¿ç”¨æœ¬åœ°å­˜å‚¨ä½œä¸ºå¤‡ç”¨
                const localOutlines = localStorage.getItem('outlines');
                if (localOutlines) {
                    outlines = JSON.parse(localOutlines);
                }
            }
        }

        // åŠ è½½è§’è‰²æ•°æ®
        async function loadCharactersData() {
            try {
                const response = await fetch(`${API_BASE}/characters`);
                const result = await response.json();
                if (result.success) {
                    characters = result.data;
                }
            } catch (error) {
                console.error('åŠ è½½è§’è‰²æ•°æ®å¤±è´¥:', error);
                // ä½¿ç”¨æœ¬åœ°å­˜å‚¨ä½œä¸ºå¤‡ç”¨
                const localCharacters = localStorage.getItem('characters');
                if (localCharacters) {
                    characters = JSON.parse(localCharacters);
                }
            }
        }

        // åŠ è½½æ¨¡æ¿æ•°æ®
        async function loadTemplatesData() {
            try {
                const response = await fetch(`${API_BASE}/templates`);
                const result = await response.json();
                if (result.success) {
                    templates = result.data;
                }
            } catch (error) {
                console.error('åŠ è½½æ¨¡æ¿æ•°æ®å¤±è´¥:', error);
            }
        }

        // åŠ è½½å·¥ä½œå°
        function loadDashboard() {
            const recentOutlinesDiv = document.getElementById('recentOutlines');
            const loadingDiv = document.getElementById('outlinesLoading');
            
            if (outlines.length > 0) {
                const recentOutlines = outlines.slice(-5).reverse();
                recentOutlinesDiv.innerHTML = recentOutlines.map(outline => `
                    <div class="outline-item" onclick="openOutline('${outline.id}')">
                        <div class="outline-title">${outline.mainContent || 'æœªå‘½åå¤§çº²'}</div>
                        <div class="outline-meta">
                            åˆ›å»ºæ—¶é—´ï¼š${new Date(outline.createdAt).toLocaleDateString()}
                        </div>
                        <div class="outline-preview">
                            ${(outline.mainContent || '').substring(0, 100)}...
                        </div>
                    </div>
                `).join('');
                loadingDiv.classList.remove('show');
            } else {
                recentOutlinesDiv.innerHTML = '<p style="text-align: center; color: #999;">æš‚æ— å¤§çº²ï¼Œç‚¹å‡»ä¸Šæ–¹å·¥å…·å¼€å§‹åˆ›ä½œ</p>';
                loadingDiv.classList.remove('show');
            }
        }

        // åŠ è½½å¤§çº²åˆ—è¡¨
        function loadOutlines() {
            const outlineList = document.getElementById('outlineList');
            
            if (outlines.length > 0) {
                outlineList.innerHTML = outlines.map(outline => `
                    <div class="outline-item" onclick="openOutline('${outline.id}')">
                        <div class="outline-title">${outline.mainContent || 'æœªå‘½åå¤§çº²'}</div>
                        <div class="outline-meta">
                            æ›´æ–°æ—¶é—´ï¼š${new Date(outline.updatedAt).toLocaleDateString()}
                        </div>
                        <div class="outline-preview">
                            ${(outline.mainContent || '').substring(0, 150)}...
                        </div>
                    </div>
                `).join('');
            } else {
                outlineList.innerHTML = '<p style="text-align: center; color: #999;">æš‚æ— å¤§çº²</p>';
            }
        }

        // åŠ è½½è§’è‰²åˆ—è¡¨
        function loadCharacters() {
            const gallery = document.getElementById('characterGallery');
            const loading = document.getElementById('charactersLoading');
            
            if (characters.length > 0) {
                gallery.innerHTML = characters.map(character => `
                    <div class="character-card" onclick="viewCharacter('${character.id}')">
                        <div class="character-avatar">${getCharacterEmoji(character.type)}</div>
                        <div class="character-name">${character.name}</div>
                        <div class="character-type">${getCharacterTypeName(character.type)}</div>
                    </div>
                `).join('');
                loading.classList.remove('show');
            } else {
                gallery.innerHTML = '<p style="grid-column: 1 / -1; text-align: center; color: #999;">æš‚æ— è§’è‰²</p>';
                loading.classList.remove('show');
            }
        }

        // åŠ è½½AIå·¥å…·
        function loadAITools() {
            // AIå·¥å…·å·²åœ¨HTMLä¸­å®šä¹‰ï¼Œè¿™é‡Œå¯ä»¥åŠ è½½æ›´å¤šåŠ¨æ€å†…å®¹
            console.log('AIå·¥å…·å·²åŠ è½½');
        }

        // åŠ è½½ç´ æåº“
        function loadLibrary() {
            const libraryContent = document.getElementById('libraryContent');
            
            if (templates && templates.plotStructures) {
                let content = '<h3>ğŸ“‹ æƒ…èŠ‚ç»“æ„æ¨¡æ¿</h3>';
                content += '<div class="tools-grid">';
                
                templates.plotStructures.forEach(structure => {
                    content += `
                        <div class="tool-card" onclick="useTemplate('${structure.id}')">
                            <div class="tool-icon">ğŸ“š</div>
                            <div class="tool-title">${structure.name}</div>
                            <div class="tool-desc">${structure.description}</div>
                        </div>
                    `;
                });
                
                content += '</div>';
                libraryContent.innerHTML = content;
            } else {
                libraryContent.innerHTML = '<p style="text-align: center; color: #999;">ç´ æåº“åŠ è½½ä¸­...</p>';
            }
        }

        // åˆ›å»ºæ–°å¤§çº²
        function createNewOutline() {
            window.open('plot-outline-tool.html', '_blank');
        }

        // åˆ›å»ºæ–°è§’è‰²
        function createNewCharacter() {
            const name = prompt('è¯·è¾“å…¥è§’è‰²å§“å:');
            if (!name) return;

            const type = prompt('è¯·é€‰æ‹©è§’è‰²ç±»å‹ (hero/antagonist/supporting/mentor):') || 'supporting';
            
            const character = {
                name: name,
                type: type,
                traits: [],
                background: '',
                createdAt: new Date().toISOString()
            };

            saveCharacter(character);
        }

        // ä½¿ç”¨AIå»ºè®®
        async function useAISuggestion(type) {
            try {
                const response = await fetch(`${API_BASE}/ai/suggest`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        type: type,
                        content: '',
                        context: { currentSection }
                    })
                });
                
                const result = await response.json();
                if (result.success) {
                    const suggestionsDiv = document.getElementById('aiSuggestions');
                    const suggestionHTML = `
                        <div class="ai-message">
                            <strong>${type} å»ºè®®ï¼š</strong><br>
                            ${result.data.suggestion}
                        </div>
                    `;
                    suggestionsDiv.innerHTML = suggestionHTML + suggestionsDiv.innerHTML;
                }
            } catch (error) {
                console.error('è·å–AIå»ºè®®å¤±è´¥:', error);
                showErrorMessage('AIå»ºè®®è·å–å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
            }
        }

        // ä¿å­˜å¤§çº²
        async function saveOutline(outline) {
            try {
                const response = await fetch(`${API_BASE}/outlines`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(outline)
                });
                
                const result = await response.json();
                if (result.success) {
                    showSuccessMessage('å¤§çº²ä¿å­˜æˆåŠŸï¼');
                    outlines.push(result.data);
                    updateQuickStats();
                }
            } catch (error) {
                console.error('ä¿å­˜å¤§çº²å¤±è´¥:', error);
                showErrorMessage('å¤§çº²ä¿å­˜å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
            }
        }

        // ä¿å­˜è§’è‰²
        async function saveCharacter(character) {
            try {
                const response = await fetch(`${API_BASE}/characters`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(character)
                });
                
                const result = await response.json();
                if (result.success) {
                    showSuccessMessage('è§’è‰²åˆ›å»ºæˆåŠŸï¼');
                    characters.push(result.data);
                    updateQuickStats();
                }
            } catch (error) {
                console.error('ä¿å­˜è§’è‰²å¤±è´¥:', error);
                showErrorMessage('è§’è‰²åˆ›å»ºå¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
            }
        }

        // æœç´¢åŠŸèƒ½
        function searchOutlines() {
            const query = document.getElementById('outlineSearch').value.toLowerCase();
            if (!query) {
                loadOutlines();
                return;
            }

            const filtered = outlines.filter(outline => 
                outline.mainContent && outline.mainContent.toLowerCase().includes(query)
            );

            const outlineList = document.getElementById('outlineList');
            if (filtered.length > 0) {
                outlineList.innerHTML = filtered.map(outline => `
                    <div class="outline-item" onclick="openOutline('${outline.id}')">
                        <div class="outline-title">${outline.mainContent}</div>
                        <div class="outline-preview">${outline.mainContent.substring(0, 150)}...</div>
                    </div>
                `).join('');
            } else {
                outlineList.innerHTML = '<p style="text-align: center; color: #999;">æœªæ‰¾åˆ°åŒ¹é…çš„å¤§çº²</p>';
            }
        }

        function searchLibrary() {
            // å®ç°ç´ æåº“æœç´¢
            console.log('æœç´¢ç´ æåº“');
        }

        // è¾…åŠ©å‡½æ•°
        function getCharacterEmoji(type) {
            const emojis = {
                hero: 'ğŸ¦¸',
                antagonist: 'ğŸ˜ˆ',
                supporting: 'ğŸ‘¤',
                mentor: 'ğŸ§™â€â™‚ï¸',
                love_interest: 'ğŸ’•'
            };
            return emojis[type] || 'ğŸ‘¤';
        }

        function getCharacterTypeName(type) {
            const names = {
                hero: 'è‹±é›„',
                antagonist: 'åæ´¾',
                supporting: 'é…è§’',
                mentor: 'å¯¼å¸ˆ',
                love_interest: 'æ‹äºº'
            };
            return names[type] || type;
        }

        function updateQuickStats() {
            const statsDiv = document.getElementById('quickStats');
            statsDiv.innerHTML = `
                <div style="margin-bottom: 15px;">
                    <strong>å¤§çº²æ•°é‡ï¼š</strong> ${outlines.length}
                </div>
                <div style="margin-bottom: 15px;">
                    <strong>è§’è‰²æ•°é‡ï¼š</strong> ${characters.length}
                </div>
                <div>
                    <strong>æ€»å­—æ•°ï¼š</strong> ${calculateTotalWords()}
                </div>
            `;
        }

        function calculateTotalWords() {
            return outlines.reduce((total, outline) => {
                return total + (outline.mainContent ? outline.mainContent.length : 0);
            }, 0);
        }

        function showSuccessMessage(message) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'success-message';
            messageDiv.textContent = message;
            document.querySelector('.main-content').insertBefore(messageDiv, document.querySelector('.content-section'));
            
            setTimeout(() => messageDiv.remove(), 3000);
        }

        function showErrorMessage(message) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'error-message';
            messageDiv.textContent = message;
            document.querySelector('.main-content').insertBefore(messageDiv, document.querySelector('.content-section'));
            
            setTimeout(() => messageDiv.remove(), 5000);
        }

        function openOutline(id) {
            const outline = outlines.find(o => o.id === id);
            if (outline) {
                window.open(`plot-outline-tool.html?id=${id}`, '_blank');
            }
        }

        function viewCharacter(id) {
            const character = characters.find(c => c.id === id);
            if (character) {
                alert(`è§’è‰²ä¿¡æ¯ï¼š\nå§“åï¼š${character.name}\nç±»å‹ï¼š${getCharacterTypeName(character.type)}\nç‰¹è´¨ï¼š${character.traits.join('ã€')}`);
            }
        }

        function useTemplate(templateId) {
            showSuccessMessage(`æ¨¡æ¿ "${templateId}" å·²åº”ç”¨åˆ°æ–°å¤§çº²`);
            createNewOutline();
        }

        function quickCreate() {
            if (currentSection === 'outline') {
                createNewOutline();
            } else if (currentSection === 'characters') {
                createNewCharacter();
            } else {
                createNewOutline();
            }
        }

        function exportAllData() {
            const data = {
                outlines: outlines,
                characters: characters,
                exportTime: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `novel-creation-data-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function showSystemInfo() {
            const info = `
                AIå°è¯´åˆ›ä½œç³»ç»Ÿ v1.0.0
                
                æœåŠ¡å™¨ï¼š${API_BASE}
                å¤§çº²æ•°é‡ï¼š${outlines.length}
                è§’è‰²æ•°é‡ï¼š${characters.length}
                
                åŠŸèƒ½ç‰¹æ€§ï¼š
                â€¢ æƒ…èŠ‚å¤§çº²è®¾è®¡
                â€¢ è§’è‰²ç®¡ç†ç³»ç»Ÿ  
                â€¢ AIæ™ºèƒ½å»ºè®®
                â€¢ ç´ ææ¨¡æ¿åº“
                â€¢ æ•°æ®æŒä¹…åŒ–å­˜å‚¨
            `;
            alert(info);
        }
    </script>
</body>
</html>