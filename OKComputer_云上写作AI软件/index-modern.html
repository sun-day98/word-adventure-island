<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIå†™ä½œåŠ©æ‰‹ - ç°ä»£ç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #5B5FDE;
            --secondary-color: #FF6B6B;
            --accent-color: #4ECDC4;
            --bg-primary: #FFFFFF;
            --bg-secondary: #F8F9FA;
            --bg-dark: #2D3436;
            --text-primary: #2D3436;
            --text-secondary: #636E72;
            --border-color: #E1E8ED;
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.1);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.15);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.2);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* å¤´éƒ¨å¯¼èˆª */
        .header {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 0;
            z-index: 100;
            transition: var(--transition);
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 64px;
        }

        .logo {
            display: flex;
            align-items: center;
            font-size: 20px;
            font-weight: 700;
            color: var(--primary-color);
            text-decoration: none;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            margin-right: 12px;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .nav-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .nav-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .nav-btn-ghost {
            background: transparent;
            color: var(--text-secondary);
        }

        .nav-btn-ghost:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .nav-btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .nav-btn-primary:hover {
            background: #4B4FCE;
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        /* ä¸»å¸ƒå±€ */
        .main-container {
            max-width: 1400px;
            margin: 24px auto;
            padding: 0 24px;
            display: grid;
            grid-template-columns: 280px 1fr 320px;
            gap: 24px;
            min-height: calc(100vh - 120px);
        }

        /* ä¾§è¾¹æ  */
        .sidebar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--shadow-md);
            overflow-y: auto;
            max-height: calc(100vh - 144px);
        }

        .sidebar-section {
            margin-bottom: 32px;
        }

        .sidebar-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .doc-list {
            list-style: none;
        }

        .doc-item {
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .doc-item:hover {
            background: var(--bg-secondary);
        }

        .doc-item.active {
            background: var(--primary-color);
            color: white;
        }

        .doc-info {
            flex: 1;
        }

        .doc-title {
            font-weight: 500;
            margin-bottom: 2px;
        }

        .doc-meta {
            font-size: 12px;
            opacity: 0.7;
        }

        .doc-actions {
            display: flex;
            gap: 8px;
        }

        .doc-action-btn {
            width: 24px;
            height: 24px;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.6;
            transition: var(--transition);
        }

        .doc-action-btn:hover {
            opacity: 1;
            background: rgba(255, 255, 255, 0.2);
        }

        /* ç¼–è¾‘å™¨åŒºåŸŸ */
        .editor-container {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            box-shadow: var(--shadow-lg);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .editor-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .editor-title-input {
            font-size: 24px;
            font-weight: 600;
            border: none;
            outline: none;
            color: var(--text-primary);
            background: transparent;
            width: 100%;
            max-width: 400px;
        }

        .editor-toolbar {
            padding: 16px 24px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .toolbar-group {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 0 12px;
            border-right: 1px solid var(--border-color);
        }

        .toolbar-group:last-child {
            border-right: none;
        }

        .toolbar-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            transition: var(--transition);
        }

        .toolbar-btn:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .toolbar-btn.active {
            background: var(--primary-color);
            color: white;
        }

        .editor-content {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
        }

        .editor-textarea {
            width: 100%;
            min-height: 500px;
            border: none;
            outline: none;
            font-size: 16px;
            line-height: 1.8;
            color: var(--text-primary);
            background: transparent;
            resize: vertical;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, monospace;
        }

        .editor-footer {
            padding: 16px 24px;
            border-top: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--bg-secondary);
        }

        .word-count {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .editor-actions {
            display: flex;
            gap: 12px;
        }

        /* AIåŠ©æ‰‹é¢æ¿ */
        .ai-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--shadow-md);
            overflow-y: auto;
            max-height: calc(100vh - 144px);
        }

        .ai-header {
            text-align: center;
            margin-bottom: 24px;
        }

        .ai-avatar {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            border-radius: 50%;
            margin: 0 auto 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
        }

        .ai-status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4CAF50;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .ai-section {
            margin-bottom: 24px;
        }

        .ai-section-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-primary);
        }

        .ai-suggestion {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
        }

        .ai-suggestion:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .suggestion-title {
            font-weight: 500;
            margin-bottom: 4px;
            color: var(--text-primary);
        }

        .suggestion-desc {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .ai-input-group {
            margin-bottom: 16px;
        }

        .ai-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            transition: var(--transition);
            background: var(--bg-primary);
        }

        .ai-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(91, 95, 222, 0.1);
        }

        .ai-btn {
            width: 100%;
            padding: 12px 24px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }

        .ai-btn:hover {
            background: #4B4FCE;
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .ai-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1200px) {
            .main-container {
                grid-template-columns: 1fr 320px;
            }
            .sidebar {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .main-container {
                grid-template-columns: 1fr;
                padding: 0 16px;
            }
            
            .ai-panel {
                display: none;
            }
            
            .nav-container {
                padding: 0 16px;
            }
        }

        /* æµ®åŠ¨æ“ä½œæŒ‰é’® */
        .fab {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            border: none;
            box-shadow: var(--shadow-lg);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: var(--transition);
            z-index: 1000;
        }

        .fab:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 32px rgba(91, 95, 222, 0.4);
        }

        /* åŠ è½½åŠ¨ç”» */
        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-color);
            border-top: 2px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
            font-size: 14px;
        }
    </style>
</head>
<body>
    <!-- å¤´éƒ¨å¯¼èˆª -->
    <header class="header">
        <div class="nav-container">
            <a href="#" class="logo">
                <div class="logo-icon">AI</div>
                <span>AIå†™ä½œåŠ©æ‰‹</span>
            </a>
            
            <div class="nav-actions">
                <button class="nav-btn nav-btn-ghost" onclick="toggleTheme()">
                    ğŸŒ™ ä¸»é¢˜
                </button>
                <button class="nav-btn nav-btn-ghost" onclick="showSettings()">
                    âš™ï¸ è®¾ç½®
                </button>
                <button class="nav-btn nav-btn-primary" onclick="saveDocument()">
                    ğŸ’¾ ä¿å­˜
                </button>
            </div>
        </div>
    </header>

    <!-- ä¸»å®¹å™¨ -->
    <div class="main-container">
        <!-- å·¦ä¾§è¾¹æ  -->
        <aside class="sidebar">
            <div class="sidebar-section">
                <h3 class="sidebar-title">æ–‡æ¡£ç®¡ç†</h3>
                <ul class="doc-list" id="docList">
                    <li class="doc-item active" onclick="selectDocument('doc1')">
                        <div class="doc-info">
                            <div class="doc-title">æ–°å»ºå°è¯´</div>
                            <div class="doc-meta">åˆšåˆšç¼–è¾‘</div>
                        </div>
                        <div class="doc-actions">
                            <button class="doc-action-btn" onclick="editDocTitle(event, 'doc1')">âœï¸</button>
                            <button class="doc-action-btn" onclick="deleteDoc(event, 'doc1')">ğŸ—‘ï¸</button>
                        </div>
                    </li>
                </ul>
                <button class="ai-btn" style="margin-top: 12px;" onclick="createNewDocument()">
                    â• æ–°å»ºæ–‡æ¡£
                </button>
            </div>

            <div class="sidebar-section">
                <h3 class="sidebar-title">æ¨¡æ¿åº“</h3>
                <ul class="doc-list">
                    <li class="doc-item" onclick="useTemplate('novel')">
                        <div class="doc-info">
                            <div class="doc-title">ğŸ“– å°è¯´æ¨¡æ¿</div>
                            <div class="doc-meta">ç»å…¸ä¸‰å¹•å¼ç»“æ„</div>
                        </div>
                    </li>
                    <li class="doc-item" onclick="useTemplate('essay')">
                        <div class="doc-info">
                            <div class="doc-title">ğŸ“ æ•£æ–‡æ¨¡æ¿</div>
                            <div class="doc-meta">æŠ’æƒ…æ•£æ–‡ç»“æ„</div>
                        </div>
                    </li>
                    <li class="doc-item" onclick="useTemplate('article')">
                        <div class="doc-info">
                            <div class="doc-title">ğŸ“° æ–‡ç« æ¨¡æ¿</div>
                            <div class="doc-meta">è®®è®ºæ–‡ç»“æ„</div>
                        </div>
                    </li>
                </ul>
            </div>
        </aside>

        <!-- ç¼–è¾‘å™¨åŒºåŸŸ -->
        <main class="editor-container">
            <div class="editor-header">
                <input type="text" class="editor-title-input" id="docTitle" placeholder="è¯·è¾“å…¥æ–‡æ¡£æ ‡é¢˜..." value="æœªå‘½åæ–‡æ¡£">
                <div class="editor-actions">
                    <button class="nav-btn nav-btn-ghost" onclick="exportDocument()">
                        ğŸ“¤ å¯¼å‡º
                    </button>
                    <button class="nav-btn nav-btn-ghost" onclick="shareDocument()">
                        ğŸ”— åˆ†äº«
                    </button>
                    <button class="nav-btn nav-btn-primary" onclick="aiGenerate()">
                        âœ¨ AIç”Ÿæˆ
                    </button>
                </div>
            </div>

            <div class="editor-toolbar">
                <div class="toolbar-group">
                    <button class="toolbar-btn" onclick="formatText('bold')" title="ç²—ä½“">
                        <strong>B</strong>
                    </button>
                    <button class="toolbar-btn" onclick="formatText('italic')" title="æ–œä½“">
                        <em>I</em>
                    </button>
                    <button class="toolbar-btn" onclick="formatText('underline')" title="ä¸‹åˆ’çº¿">
                        <u>U</u>
                    </button>
                </div>
                
                <div class="toolbar-group">
                    <button class="toolbar-btn" onclick="insertHeading(1)" title="æ ‡é¢˜1">
                        H1
                    </button>
                    <button class="toolbar-btn" onclick="insertHeading(2)" title="æ ‡é¢˜2">
                        H2
                    </button>
                    <button class="toolbar-btn" onclick="insertHeading(3)" title="æ ‡é¢˜3">
                        H3
                    </button>
                </div>

                <div class="toolbar-group">
                    <button class="toolbar-btn" onclick="insertList('ul')" title="æ— åºåˆ—è¡¨">
                        â€¢
                    </button>
                    <button class="toolbar-btn" onclick="insertList('ol')" title="æœ‰åºåˆ—è¡¨">
                        1.
                    </button>
                    <button class="toolbar-btn" onclick="insertQuote()" title="å¼•ç”¨">
                        "
                    </button>
                </div>

                <div class="toolbar-group">
                    <button class="toolbar-btn" onclick="findReplace()" title="æŸ¥æ‰¾æ›¿æ¢">
                        ğŸ”
                    </button>
                    <button class="toolbar-btn" onclick="toggleFullscreen()" title="å…¨å±">
                        â›¶
                    </button>
                    <button class="toolbar-btn" onclick="toggleFocusMode()" title="ä¸“æ³¨æ¨¡å¼">
                        ğŸ¯
                    </button>
                </div>
            </div>

            <div class="editor-content">
                <textarea class="editor-textarea" id="editor" placeholder="åœ¨è¿™é‡Œå¼€å§‹æ‚¨çš„åˆ›ä½œ...

AIå†™ä½œåŠ©æ‰‹ä¼šå®æ—¶ä¸ºæ‚¨æä¾›ï¼š
â€¢ æ™ºèƒ½ç»­å†™å»ºè®®
â€¢ è¯­æ³•é”™è¯¯æ£€æŸ¥  
â€¢ è¯æ±‡ä¼˜åŒ–æ¨è
â€¢ æƒ…èŠ‚å‘å±•å»ºè®®
â€¢ äººç‰©æ€§æ ¼åˆ†æ

å¼€å§‹è¾“å…¥ï¼Œè®©AIåŠ©æ‚¨çš„åˆ›ä½œæ›´ä¸Šä¸€å±‚æ¥¼ï¼"></textarea>
            </div>

            <div class="editor-footer">
                <div class="word-count">
                    <span id="wordCount">å­—æ•°: 0</span> | 
                    <span id="charCount">å­—ç¬¦: 0</span> | 
                    <span id="readTime">é˜…è¯»æ—¶é—´: 0åˆ†é’Ÿ</span>
                </div>
                <div class="loading-text" id="saveStatus" style="display: none;">
                    <div class="spinner"></div>
                    <span>æ­£åœ¨ä¿å­˜...</span>
                </div>
            </div>
        </main>

        <!-- AIåŠ©æ‰‹é¢æ¿ -->
        <aside class="ai-panel">
            <div class="ai-header">
                <div class="ai-avatar">ğŸ¤–</div>
                <div class="ai-status">
                    <div class="status-dot"></div>
                    <span>AIåŠ©æ‰‹åœ¨çº¿</span>
                </div>
            </div>

            <div class="ai-section">
                <h3 class="ai-section-title">ğŸ’¡ æ™ºèƒ½å»ºè®®</h3>
                <div id="aiSuggestions">
                    <div class="ai-suggestion" onclick="applySuggestion('continue')">
                        <div class="suggestion-title">ç»§ç»­å†™ä½œ</div>
                        <div class="suggestion-desc">æ ¹æ®å½“å‰å†…å®¹æ™ºèƒ½ç»­å†™ä¸‹ä¸€æ®µ</div>
                    </div>
                    <div class="ai-suggestion" onclick="applySuggestion('improve')">
                        <div class="suggestion-title">ä¼˜åŒ–è¡¨è¾¾</div>
                        <div class="suggestion-desc">æ”¹å–„è¯­è¨€è¡¨è¾¾å’Œå¥å­ç»“æ„</div>
                    </div>
                    <div class="ai-suggestion" onclick="applySuggestion('expand')">
                        <div class="suggestion-title">æ‰©å±•å†…å®¹</div>
                        <div class="suggestion-desc">ä¸°å¯Œæè¿°å’Œç»†èŠ‚æå†™</div>
                    </div>
                </div>
            </div>

            <div class="ai-section">
                <h3 class="ai-section-title">ğŸ¯ å¿«é€Ÿç”Ÿæˆ</h3>
                <div class="ai-input-group">
                    <input type="text" class="ai-input" id="aiPrompt" placeholder="è¾“å…¥æ‚¨æƒ³è¦ç”Ÿæˆçš„å†…å®¹...">
                </div>
                <button class="ai-btn" onclick="aiGenerateContent()" id="aiGenerateBtn">
                    ğŸš€ AIç”Ÿæˆå†…å®¹
                </button>
            </div>

            <div class="ai-section">
                <h3 class="ai-section-title">ğŸ“š å†™ä½œå·¥å…·</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                    <button class="nav-btn nav-btn-ghost" onclick="checkGrammar()">è¯­æ³•æ£€æŸ¥</button>
                    <button class="nav-btn nav-btn-ghost" onclick="analyzeText()">æ–‡æœ¬åˆ†æ</button>
                    <button class="nav-btn nav-btn-ghost" onclick="findSynonyms()">åŒä¹‰è¯</button>
                    <button class="nav-btn nav-btn-ghost" onclick="translateText()">ç¿»è¯‘</button>
                </div>
            </div>

            <div class="ai-section">
                <h3 class="ai-section-title">ğŸ“– AIæ‹†ä¹¦</h3>
                <div class="ai-input-group">
                    <textarea class="ai-input" id="bookContent" placeholder="ç²˜è´´ä¹¦ç±å†…å®¹è¿›è¡Œåˆ†æ..." rows="4"></textarea>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 12px;">
                    <select class="ai-input" id="bookType">
                        <option value="fiction">æ–‡å­¦ä½œå“</option>
                        <option value="non_fiction">éæ–‡å­¦ä½œå“</option>
                        <option value="academic">å­¦æœ¯ä½œå“</option>
                    </select>
                    <select class="ai-input" id="bookCategory">
                        <option value="chinese_novel">ä¸­æ–‡å°è¯´</option>
                        <option value="foreign_novel">å¤–æ–‡å°è¯´</option>
                        <option value="self_help">è‡ªæˆ‘æå‡</option>
                        <option value="business">å•†ä¸šç®¡ç†</option>
                        <option value="psychology">å¿ƒç†å­¦</option>
                        <option value="research_paper">ç ”ç©¶è®ºæ–‡</option>
                    </select>
                </div>
                <button class="ai-btn" onclick="aiDeconstructBook()">ğŸ“– å¼€å§‹æ‹†ä¹¦</button>
            </div>

            <div class="ai-section">
                <h3 class="ai-section-title">âœï¸ AIä»¿å†™</h3>
                <div class="ai-input-group">
                    <textarea class="ai-input" id="imitationText" placeholder="ç²˜è´´è¦æ¨¡ä»¿çš„æ–‡æœ¬..." rows="3"></textarea>
                </div>
                <div class="ai-input-group">
                    <select class="ai-input" id="targetStyle">
                        <option value="">é€‰æ‹©ç›®æ ‡é£æ ¼</option>
                        <optgroup label="æ–‡å­¦ä½œå®¶">
                            <option value="luxun">é²è¿… - æ‰¹åˆ¤ç°å®ä¸»ä¹‰</option>
                            <option value="ba_jin">å·´é‡‘ - æ¿€æƒ…æ¾æ¹ƒ</option>
                            <option value="maodun">èŒ…ç›¾ - å®å¤§å™äº‹</option>
                            <option value="shen_congwen">æ²ˆä»æ–‡ - è¯—æ„ç”°å›­</option>
                        </optgroup>
                        <optgroup label="ç°ä»£ä½œå®¶">
                            <option value="wang_xiaobo">ç‹å°æ³¢ - ç†æ€§å¹½é»˜</option>
                            <option value="yu_hua">ä½™å - å¹³å®æ·±åˆ»</option>
                            <option value="mo_yan">è«è¨€ - é­”å¹»ç°å®</option>
                        </optgroup>
                        <optgroup label="ç½‘ç»œæ–‡å­¦">
                            <option value="xianxia">ç„å¹»ä¿®ä»™</option>
                            <option value="urban">éƒ½å¸‚æƒ…æ„Ÿ</option>
                            <option value="history">å†å²ç©¿è¶Š</option>
                        </optgroup>
                        <optgroup label="ä¸“ä¸šé£æ ¼">
                            <option value="academic">å­¦æœ¯è®ºæ–‡</option>
                            <option value="tech">æŠ€æœ¯æ–‡æ¡£</option>
                            <option value="business">å•†ä¸šæ–‡æ¡ˆ</option>
                        </optgroup>
                    </select>
                </div>
                <button class="ai-btn" onclick="aiImitateStyle()">âœï¸ å¼€å§‹ä»¿å†™</button>
            </div>

            <div class="ai-section">
                <h3 class="ai-section-title">ğŸ“Š å†™ä½œç»Ÿè®¡</h3>
                <div style="background: var(--bg-secondary); border-radius: 8px; padding: 16px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span>ä»Šæ—¥å­—æ•°</span>
                        <strong id="todayWords">0</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span>æœ¬å‘¨å­—æ•°</span>
                        <strong id="weekWords">0</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>å®Œæˆæ–‡æ¡£</span>
                        <strong id="completedDocs">0</strong>
                    </div>
                </div>
            </div>
        </aside>
    </div>

    <!-- æµ®åŠ¨æ“ä½œæŒ‰é’® -->
    <button class="fab" onclick="quickAIHelp()" title="å¿«é€ŸAIå¸®åŠ©">
        âœ¨
    </button>

    <script src="ai-writing-tools.js"></script>
    <script src="ai-book-deconstruction.js"></script>
    <script src="ai-writing-imitation.js"></script>
    <script>
        // å…¨å±€å˜é‡
        let currentDocument = null;
        let documents = JSON.parse(localStorage.getItem('aiWritingDocs') || '{}');
        let autoSaveTimer = null;
        let isDarkMode = false;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializeEditor();
            loadDocuments();
            setupAutoSave();
            updateStatistics();
        });

        // åˆå§‹åŒ–ç¼–è¾‘å™¨
        function initializeEditor() {
            const editor = document.getElementById('editor');
            const titleInput = document.getElementById('docTitle');
            
            editor.addEventListener('input', function() {
                updateWordCount();
                scheduleAutoSave();
            });
            
            titleInput.addEventListener('input', function() {
                scheduleAutoSave();
            });
            
            updateWordCount();
        }

        // æ›´æ–°å­—æ•°ç»Ÿè®¡
        function updateWordCount() {
            const content = document.getElementById('editor').value;
            const wordCount = content.replace(/\s/g, '').length;
            const charCount = content.length;
            const readTime = Math.max(1, Math.ceil(wordCount / 400)); // å‡è®¾æ¯åˆ†é’Ÿé˜…è¯»400å­—
            
            document.getElementById('wordCount').textContent = `å­—æ•°: ${wordCount}`;
            document.getElementById('charCount').textContent = `å­—ç¬¦: ${charCount}`;
            document.getElementById('readTime').textContent = `é˜…è¯»æ—¶é—´: ${readTime}åˆ†é’Ÿ`;
        }

        // è‡ªåŠ¨ä¿å­˜
        function scheduleAutoSave() {
            clearTimeout(autoSaveTimer);
            autoSaveTimer = setTimeout(() => {
                autoSave();
            }, 2000);
        }

        function autoSave() {
            if (currentDocument) {
                saveCurrentDocument();
            }
        }

        function saveCurrentDocument() {
            const title = document.getElementById('docTitle').value;
            const content = document.getElementById('editor').value;
            
            if (!currentDocument) {
                currentDocument = 'doc_' + Date.now();
            }
            
            documents[currentDocument] = {
                title: title,
                content: content,
                updatedAt: new Date().toISOString(),
                createdAt: documents[currentDocument]?.createdAt || new Date().toISOString()
            };
            
            localStorage.setItem('aiWritingDocs', JSON.stringify(documents));
            showSaveStatus();
            loadDocuments();
        }

        function showSaveStatus() {
            const saveStatus = document.getElementById('saveStatus');
            saveStatus.style.display = 'flex';
            setTimeout(() => {
                saveStatus.style.display = 'none';
            }, 2000);
        }

        // æ–‡æ¡£ç®¡ç†
        function createNewDocument() {
            if (document.getElementById('editor').value.trim() && !confirm('å½“å‰æ–‡æ¡£æœªä¿å­˜ï¼Œç¡®å®šè¦åˆ›å»ºæ–°æ–‡æ¡£å—ï¼Ÿ')) {
                return;
            }
            
            currentDocument = 'doc_' + Date.now();
            document.getElementById('docTitle').value = 'æœªå‘½åæ–‡æ¡£';
            document.getElementById('editor').value = '';
            updateWordCount();
            
            documents[currentDocument] = {
                title: 'æœªå‘½åæ–‡æ¡£',
                content: '',
                updatedAt: new Date().toISOString(),
                createdAt: new Date().toISOString()
            };
            
            loadDocuments();
        }

        function selectDocument(docId) {
            if (currentDocument === docId) return;
            
            const doc = documents[docId];
            if (doc) {
                currentDocument = docId;
                document.getElementById('docTitle').value = doc.title;
                document.getElementById('editor').value = doc.content;
                updateWordCount();
                
                // æ›´æ–°æ´»åŠ¨çŠ¶æ€
                document.querySelectorAll('.doc-item').forEach(item => {
                    item.classList.remove('active');
                });
                document.querySelector(`[onclick="selectDocument('${docId}')"]`).classList.add('active');
            }
        }

        function loadDocuments() {
            const docList = document.getElementById('docList');
            const docIds = Object.keys(documents).sort((a, b) => {
                return new Date(documents[b].updatedAt) - new Date(documents[a].updatedAt);
            });
            
            if (docIds.length === 0) {
                docList.innerHTML = '<li class="doc-item"><div class="doc-info"><div class="doc-title">æš‚æ— æ–‡æ¡£</div></div></li>';
                return;
            }
            
            docList.innerHTML = docIds.map(docId => {
                const doc = documents[docId];
                const isActive = docId === currentDocument;
                const date = new Date(doc.updatedAt).toLocaleString();
                
                return `
                    <li class="doc-item ${isActive ? 'active' : ''}" onclick="selectDocument('${docId}')">
                        <div class="doc-info">
                            <div class="doc-title">${doc.title}</div>
                            <div class="doc-meta">${date}</div>
                        </div>
                        <div class="doc-actions">
                            <button class="doc-action-btn" onclick="editDocTitle(event, '${docId}')">âœï¸</button>
                            <button class="doc-action-btn" onclick="deleteDoc(event, '${docId}')">ğŸ—‘ï¸</button>
                        </div>
                    </li>
                `;
            }).join('');
        }

        function deleteDoc(event, docId) {
            event.stopPropagation();
            
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ–‡æ¡£å—ï¼Ÿ')) {
                delete documents[docId];
                localStorage.setItem('aiWritingDocs', JSON.stringify(documents));
                
                if (currentDocument === docId) {
                    currentDocument = null;
                    document.getElementById('docTitle').value = '';
                    document.getElementById('editor').value = '';
                    updateWordCount();
                }
                
                loadDocuments();
            }
        }

        function editDocTitle(event, docId) {
            event.stopPropagation();
            
            const doc = documents[docId];
            const newTitle = prompt('è¯·è¾“å…¥æ–°çš„æ–‡æ¡£æ ‡é¢˜:', doc.title);
            
            if (newTitle && newTitle !== doc.title) {
                documents[docId].title = newTitle;
                documents[docId].updatedAt = new Date().toISOString();
                localStorage.setItem('aiWritingDocs', JSON.stringify(documents));
                
                if (currentDocument === docId) {
                    document.getElementById('docTitle').value = newTitle;
                }
                
                loadDocuments();
            }
        }

        // æ¨¡æ¿åŠŸèƒ½
        function useTemplate(type) {
            const templates = {
                novel: {
                    title: 'å°è¯´æ¨¡æ¿',
                    content: `# ${document.getElementById('docTitle').value || 'å°è¯´æ ‡é¢˜'}

## ç¬¬ä¸€ç«  ç›¸é‡

### åœºæ™¯è®¾ç½®
[æè¿°æ•…äº‹å‘ç”Ÿçš„æ—¶é—´ã€åœ°ç‚¹ã€ç¯å¢ƒæ°›å›´]

### äººç‰©ç™»åœº
[ä»‹ç»ä¸»è¦è§’è‰²ï¼ŒåŒ…æ‹¬å¤–è²Œã€æ€§æ ¼ã€èƒŒæ™¯]

### æ ¸å¿ƒäº‹ä»¶
[æè¿°è§¦å‘æ•…äº‹æƒ…èŠ‚çš„å…³é”®äº‹ä»¶]

## ç¬¬äºŒç«  å‘å±•

### çŸ›ç›¾å‡çº§
[æè¿°å†²çªçš„å‘å±•å’Œå˜åŒ–]

### äººç‰©æˆé•¿
[å±•ç¤ºè§’è‰²çš„å˜åŒ–å’Œæˆé•¿è¿‡ç¨‹]

### å…³é”®è½¬æŠ˜
[æ•…äº‹çš„é‡è¦è½¬æŠ˜ç‚¹]

## ç¬¬ä¸‰ç«  é«˜æ½®ä¸ç»“å±€

### æœ€ç»ˆå¯¹å†³
[æè¿°æ•…äº‹çš„é«˜æ½®éƒ¨åˆ†]

### é—®é¢˜è§£å†³
[å¦‚ä½•è§£å†³ä¸»è¦çŸ›ç›¾]

### ä¸»é¢˜å‡å
[é€šè¿‡æ•…äº‹ä¼ è¾¾çš„ä¸»é¢˜æ€æƒ³]

---
*AIå†™ä½œåŠ©æ‰‹ï¼šéšæ—¶ä¸ºæ‚¨æä¾›ç»­å†™å»ºè®®å’Œæƒ…èŠ‚ä¼˜åŒ–*`
                },
                essay: {
                    title: 'æ•£æ–‡æ¨¡æ¿',
                    content: `# ${document.getElementById('docTitle').value || 'æ•£æ–‡æ ‡é¢˜'}

## å¼€ç¯‡

### æƒ…æ™¯å¼•å…¥
[é€šè¿‡å…·ä½“çš„åœºæ™¯æå†™å¼•å…¥ä¸»é¢˜]

### æƒ…æ„ŸèŒå‘
[æè¿°å†…å¿ƒæ„Ÿå—çš„å˜åŒ–]

## ä¸»ä½“

### å›å¿†å™è¿°
[è¿½å¿†ç›¸å…³çš„ç»å†å’Œæ•…äº‹]

### æ„Ÿæ‚Ÿå‡å
[ä»ç»å†ä¸­è·å¾—çš„æ€è€ƒå’Œå¯ç¤º]

## ç»“å°¾

### æƒ…æ„Ÿå›å½’
[æƒ…æ„Ÿçš„è‡ªç„¶æµéœ²å’Œæ”¶æ•›]

### ä¸»é¢˜å‘¼åº”
[ä¸å¼€ç¯‡å½¢æˆå‘¼åº”ï¼Œæ·±åŒ–ä¸»é¢˜]

---
*AIå†™ä½œåŠ©æ‰‹ï¼šå¸®æ‚¨æ¶¦è‰²æ–‡å­—ï¼Œæå‡è¡¨è¾¾åŠ›*`
                },
                article: {
                    title: 'æ–‡ç« æ¨¡æ¿',
                    content: `# ${document.getElementById('docTitle').value || 'æ–‡ç« æ ‡é¢˜'}

## å¼•è¨€

### é—®é¢˜æå‡º
[æ˜ç¡®é˜è¿°è¦è®¨è®ºçš„æ ¸å¿ƒé—®é¢˜]

### èƒŒæ™¯ä»‹ç»
[æä¾›ç›¸å…³çš„èƒŒæ™¯ä¿¡æ¯å’Œç°çŠ¶]

### è§‚ç‚¹æ¦‚è¿°
[ç®€æ˜æ‰¼è¦åœ°è¡¨æ˜æ–‡ç« çš„ä¸»è¦è§‚ç‚¹]

## è®ºè¯ä¸»ä½“

### è®ºæ®ä¸€ï¼šäº‹å®æ”¯æ’‘
[æä¾›å…·ä½“çš„äº‹å®ã€æ•°æ®æˆ–æ¡ˆä¾‹]

### åˆ†æè¯´æ˜
[å¯¹è®ºæ®è¿›è¡Œæ·±å…¥åˆ†æå’Œè§£è¯»]

### è®ºæ®äºŒï¼šé€»è¾‘æ¨ç†
[é€šè¿‡é€»è¾‘æ¨ç†è¿›ä¸€æ­¥è¯æ˜è§‚ç‚¹]

### æ¡ˆä¾‹ä½è¯
[ç”¨å…¸å‹æ¡ˆä¾‹æ¥æ”¯æ’‘è®ºç‚¹]

### è®ºæ®ä¸‰ï¼šå¯¹æ¯”åˆ†æ
[é€šè¿‡å¯¹æ¯”å¢å¼ºè¯´æœåŠ›]

## ç»“è®º

### è§‚ç‚¹é‡ç”³
[æ€»ç»“å’Œé‡ç”³ä¸»è¦è§‚ç‚¹]

### æ„ä¹‰é˜è¿°
[è¯´æ˜è§‚ç‚¹çš„é‡è¦æ„ä¹‰å’Œä»·å€¼]

### å»ºè®®å±•æœ›
[æå‡ºç›¸å…³å»ºè®®æˆ–æœªæ¥å±•æœ›]

---
*AIå†™ä½œåŠ©æ‰‹ï¼šä¼˜åŒ–è®ºè¯é€»è¾‘ï¼Œå¢å¼ºè¯´æœåŠ›*`
                }
            };
            
            const template = templates[type];
            if (template && confirm(`ä½¿ç”¨${template.title}å°†è¦†ç›–å½“å‰å†…å®¹ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ`)) {
                document.getElementById('editor').value = template.content;
                updateWordCount();
                scheduleAutoSave();
            }
        }

        // AIåŠŸèƒ½
        function aiGenerateContent() {
            const prompt = document.getElementById('aiPrompt').value.trim();
            if (!prompt) {
                alert('è¯·è¾“å…¥ç”Ÿæˆå†…å®¹çš„æè¿°');
                return;
            }
            
            const btn = document.getElementById('aiGenerateBtn');
            btn.disabled = true;
            btn.innerHTML = '<div class="spinner"></div> æ­£åœ¨ç”Ÿæˆ...';
            
            // æ¨¡æ‹ŸAIç”Ÿæˆ
            setTimeout(() => {
                const generatedContent = generateAIContent(prompt);
                const editor = document.getElementById('editor');
                editor.value = editor.value + '\n\n' + generatedContent;
                updateWordCount();
                scheduleAutoSave();
                
                btn.disabled = false;
                btn.innerHTML = 'ğŸš€ AIç”Ÿæˆå†…å®¹';
                document.getElementById('aiPrompt').value = '';
            }, 2000);
        }

        function generateAIContent(prompt) {
            // ç®€åŒ–çš„AIå†…å®¹ç”Ÿæˆé€»è¾‘
            const templates = {
                'å°è¯´': `æ ¹æ®"${prompt}"çš„è¦æ±‚ï¼Œæˆ‘ç”Ÿæˆäº†ä»¥ä¸‹å°è¯´ç‰‡æ®µï¼š

å¤œå¹•é™ä¸´ï¼Œåç¯åˆä¸Šã€‚ä¸»äººå…¬ç«™åœ¨çª—å‰ï¼Œæœ›ç€è¿œæ–¹çš„åŸå¸‚ç¯ç«ï¼Œå¿ƒä¸­æ¶Œèµ·å¤æ‚çš„æƒ…æ„Ÿã€‚è¿™ä¸ªçœ‹ä¼¼å¹³é™çš„å¤œæ™šï¼Œå´æš—è—ç€å³å°†æ”¹å˜ä¸€åˆ‡çš„å¥‘æœº...

[AIç”Ÿæˆçš„å†…å®¹ä¼šæ ¹æ®æ‚¨çš„å…·ä½“è¦æ±‚è¿›ä¸€æ­¥ä¼˜åŒ–]`,
                
                'æ•£æ–‡': `å…³äº"${prompt}"ï¼Œæˆ‘ä¸ºæ‚¨åˆ›ä½œäº†è¿™æ®µæ•£æ–‡ï¼š

æ—¶å…‰èè‹’ï¼Œå²æœˆå¦‚æ¢­ã€‚åœ¨è¿™ä¸ªç¬æ¯ä¸‡å˜çš„æ—¶ä»£ï¼Œæˆ‘ä»¬æ¯ä¸ªäººéƒ½åœ¨å¯»æ‰¾å±äºè‡ªå·±çš„é‚£ä»½å®é™ä¸å½’å±ã€‚"${prompt}"ä¸ä»…ä»…æ˜¯ä¸€ä¸ªè¯è¯­ï¼Œæ›´æ˜¯ä¸€ç§ç”Ÿæ´»æ€åº¦å’Œäººç”Ÿå“²å­¦...

[ç»§ç»­æ·±å…¥æŒ–æ˜ä¸»é¢˜å†…æ¶µ]`,
                
                default: `å…³äº"${prompt}"ï¼Œä»¥ä¸‹æ˜¯ä¸ºæ‚¨ç”Ÿæˆçš„å†…å®¹ï¼š

åœ¨è¿™ä¸ªè¯é¢˜ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ä»å¤šä¸ªè§’åº¦æ¥æ¢è®¨ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ç†è§£å…¶æ ¸å¿ƒæ¦‚å¿µå’ŒåŸºæœ¬ç‰¹å¾ã€‚å…¶æ¬¡ï¼Œè¦åˆ†æå…¶åœ¨å®é™…åº”ç”¨ä¸­çš„é‡è¦æ€§å’Œå½±å“...

[AIä¼šæ ¹æ®å…·ä½“éœ€æ±‚ç”Ÿæˆç›¸åº”å†…å®¹]`
            };
            
            // ç®€å•çš„å…³é”®è¯åŒ¹é…
            for (const keyword in templates) {
                if (prompt.includes(keyword)) {
                    return templates[keyword];
                }
            }
            
            return templates.default;
        }

        function applySuggestion(type) {
            const editor = document.getElementById('editor');
            const cursorPos = editor.selectionStart;
            const currentText = editor.value;
            
            let suggestion = '';
            
            switch(type) {
                case 'continue':
                    suggestion = '\n\n[AIç»­å†™å»ºè®®ï¼šæ ¹æ®ä¸Šæ–‡å†…å®¹ï¼Œå¯ä»¥è¿›ä¸€æ­¥æè¿°äººç‰©çš„å†…å¿ƒæ´»åŠ¨ï¼Œæˆ–è€…å¼•å…¥æ–°çš„æƒ…èŠ‚å‘å±•...]\n';
                    break;
                case 'improve':
                    suggestion = '\n\n[AIä¼˜åŒ–å»ºè®®ï¼šè€ƒè™‘ä½¿ç”¨æ›´åŠ ç”ŸåŠ¨çš„è¯æ±‡æ¥å¢å¼ºè¡¨è¾¾æ•ˆæœï¼Œå¯ä»¥é€‚å½“è°ƒæ•´å¥å¼ç»“æ„ä½¿æ–‡ç« æ›´æµç•…...]\n';
                    break;
                case 'expand':
                    suggestion = '\n\n[AIæ‰©å±•å»ºè®®ï¼šå¯ä»¥åœ¨å½“å‰æ®µè½åŸºç¡€ä¸Šï¼Œå¢åŠ æ›´å¤šç»†èŠ‚æå†™ï¼Œä¸°å¯Œåœºæ™¯çš„æ„Ÿå®˜ä½“éªŒ...]\n';
                    break;
            }
            
            editor.value = currentText.substring(0, cursorPos) + suggestion + currentText.substring(cursorPos);
            editor.focus();
            editor.setSelectionRange(cursorPos + suggestion.length, cursorPos + suggestion.length);
            updateWordCount();
            scheduleAutoSave();
        }

        function quickAIHelp() {
            const helpText = prompt('è¯·å‘Šè¯‰æˆ‘æ‚¨éœ€è¦ä»€ä¹ˆå¸®åŠ©ï¼š', 'æˆ‘æƒ³å†™ä¸€æ®µå…³äºå‹è°Šçš„æè¿°');
            if (helpText) {
                document.getElementById('aiPrompt').value = helpText;
                aiGenerateContent();
            }
        }

        // å·¥å…·åŠŸèƒ½
        function formatText(format) {
            const editor = document.getElementById('editor');
            const start = editor.selectionStart;
            const end = editor.selectionEnd;
            const selectedText = editor.value.substring(start, end);
            
            let formattedText = '';
            switch(format) {
                case 'bold':
                    formattedText = `**${selectedText}**`;
                    break;
                case 'italic':
                    formattedText = `*${selectedText}*`;
                    break;
                case 'underline':
                    formattedText = `<u>${selectedText}</u>`;
                    break;
            }
            
            if (selectedText) {
                editor.value = editor.value.substring(0, start) + formattedText + editor.value.substring(end);
                editor.focus();
                updateWordCount();
                scheduleAutoSave();
            }
        }

        function insertHeading(level) {
            const editor = document.getElementById('editor');
            const heading = '#'.repeat(level) + ' ';
            const cursorPos = editor.selectionStart;
            
            editor.value = editor.value.substring(0, cursorPos) + '\n' + heading + editor.value.substring(cursorPos);
            editor.focus();
            editor.setSelectionRange(cursorPos + heading.length + 1, cursorPos + heading.length + 1);
            updateWordCount();
            scheduleAutoSave();
        }

        function insertList(type) {
            const editor = document.getElementById('editor');
            const cursorPos = editor.selectionStart;
            const listMarker = type === 'ul' ? 'â€¢ ' : '1. ';
            
            editor.value = editor.value.substring(0, cursorPos) + '\n' + listMarker + editor.value.substring(cursorPos);
            editor.focus();
            editor.setSelectionRange(cursorPos + listMarker.length + 1, cursorPos + listMarker.length + 1);
            updateWordCount();
            scheduleAutoSave();
        }

        function insertQuote() {
            const editor = document.getElementById('editor');
            const cursorPos = editor.selectionStart;
            const quote = '\n> ';
            
            editor.value = editor.value.substring(0, cursorPos) + quote + editor.value.substring(cursorPos);
            editor.focus();
            updateWordCount();
            scheduleAutoSave();
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }

        function toggleFocusMode() {
            const sidebar = document.querySelector('.sidebar');
            const aiPanel = document.querySelector('.ai-panel');
            
            if (sidebar.style.display === 'none') {
                sidebar.style.display = 'block';
                aiPanel.style.display = 'block';
            } else {
                sidebar.style.display = 'none';
                aiPanel.style.display = 'none';
            }
        }

        function saveDocument() {
            saveCurrentDocument();
            alert('æ–‡æ¡£å·²ä¿å­˜ï¼');
        }

        function exportDocument() {
            const title = document.getElementById('docTitle').value || 'æœªå‘½åæ–‡æ¡£';
            const content = document.getElementById('editor').value;
            
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = title + '.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        function shareDocument() {
            const title = document.getElementById('docTitle').value || 'æœªå‘½åæ–‡æ¡£';
            const shareText = `æˆ‘æ­£åœ¨ä½¿ç”¨AIå†™ä½œåŠ©æ‰‹åˆ›ä½œã€Š${title}ã€‹`;
            
            if (navigator.share) {
                navigator.share({
                    title: title,
                    text: shareText
                });
            } else {
                prompt('åˆ†äº«é“¾æ¥ï¼š', window.location.href);
            }
        }

        function checkGrammar() {
            alert('è¯­æ³•æ£€æŸ¥åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­...');
        }

        function analyzeText() {
            const content = document.getElementById('editor').value;
            const analysis = `
æ–‡æœ¬åˆ†æç»“æœï¼š
- æ€»å­—æ•°ï¼š${content.length}
- æ®µè½æ•°ï¼š${content.split('\n\n').length}
- å¹³å‡å¥é•¿ï¼š${Math.round(content.split('ã€‚').length / content.length * 100)}å­—
- æƒ…æ„Ÿå€¾å‘ï¼šç§¯æ
- å¯è¯»æ€§ï¼šè‰¯å¥½
            `;
            alert(analysis);
        }

        function findSynonyms() {
            alert('åŒä¹‰è¯æŸ¥è¯¢åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­...');
        }

        function translateText() {
            alert('ç¿»è¯‘åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­...');
        }

        function toggleTheme() {
            isDarkMode = !isDarkMode;
            // å®ç°æ·±è‰²ä¸»é¢˜åˆ‡æ¢
            if (isDarkMode) {
                document.body.classList.add('dark-theme');
            } else {
                document.body.classList.remove('dark-theme');
            }
        }

        function showSettings() {
            alert('è®¾ç½®åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­...');
        }

        function aiGenerate() {
            quickAIHelp();
        }

        function findReplace() {
            alert('æŸ¥æ‰¾æ›¿æ¢åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­...');
        }

        // AIæ‹†ä¹¦åŠŸèƒ½
        async function aiDeconstructBook() {
            const bookContent = document.getElementById('bookContent').value.trim();
            const bookType = document.getElementById('bookType').value;
            const bookCategory = document.getElementById('bookCategory').value;

            if (!bookContent) {
                alert('è¯·è¾“å…¥è¦æ‹†è§£çš„ä¹¦ç±å†…å®¹');
                return;
            }

            try {
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                const btn = event.target;
                const originalText = btn.innerHTML;
                btn.innerHTML = '<div class="spinner"></div> æ­£åœ¨åˆ†æ...';
                btn.disabled = true;

                // æ‰§è¡Œæ‹†ä¹¦åˆ†æ
                const analysis = await window.aiBookDeconstruction.deconstructBook(bookContent, bookType, bookCategory);

                // ç”Ÿæˆè¯»ä¹¦ç¬”è®°
                const notes = await window.aiBookDeconstruction.generateReadingNotes(analysis, 'comprehensive');

                // ç”ŸæˆçŸ¥è¯†å¡ç‰‡
                const cards = await window.aiBookDeconstruction.generateKnowledgeCards(analysis, 'concept');

                // æ˜¾ç¤ºåˆ†æç»“æœ
                showDeconstructionResults(analysis, notes, cards);

                // æ¢å¤æŒ‰é’®çŠ¶æ€
                btn.innerHTML = originalText;
                btn.disabled = false;

                // ä¿å­˜åˆ†æç»“æœ
                saveDeconstructionResults(bookContent, analysis, notes, cards);

            } catch (error) {
                alert('æ‹†ä¹¦åˆ†æå¤±è´¥ï¼š' + error.message);
                const btn = event.target;
                btn.innerHTML = 'ğŸ“– å¼€å§‹æ‹†ä¹¦';
                btn.disabled = false;
            }
        }

        // æ˜¾ç¤ºæ‹†ä¹¦ç»“æœ
        function showDeconstructionResults(analysis, notes, cards) {
            // åˆ›å»ºç»“æœå¼¹çª—
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                background: rgba(0,0,0,0.8); z-index: 10000;
                display: flex; align-items: center; justify-content: center;
            `;

            const content = document.createElement('div');
            content.style.cssText = `
                background: white; border-radius: 16px; padding: 32px;
                max-width: 800px; max-height: 80vh; overflow-y: auto;
                box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            `;

            content.innerHTML = `
                <h2 style="color: #5B5FDE; margin-bottom: 24px;">ğŸ“– AIæ‹†ä¹¦åˆ†ææŠ¥å‘Š</h2>
                
                <div style="margin-bottom: 24px;">
                    <h3 style="color: #2D3436; margin-bottom: 12px;">ğŸ“Š åŸºæœ¬ä¿¡æ¯</h3>
                    <div style="background: #F8F9FA; padding: 16px; border-radius: 8px;">
                        <p><strong>ç»“æ„æ¡†æ¶ï¼š</strong>${analysis.structure.outline.map(item => item.title).join(' â†’ ')}</p>
                        <p><strong>ä¸»è¦ç« èŠ‚ï¼š</strong>${analysis.structure.chapters.length}ä¸ª</p>
                        <p><strong>æ•´ä½“é£æ ¼ï¼š</strong>${analysis.writingTechniques.overall.style || 'ç°ä»£é£æ ¼'}</p>
                    </div>
                </div>

                <div style="margin-bottom: 24px;">
                    <h3 style="color: #2D3436; margin-bottom: 12px;">ğŸ¯ æ ¸å¿ƒè§‚ç‚¹</h3>
                    <div style="background: #F8F9FA; padding: 16px; border-radius: 8px;">
                        ${analysis.keyPoints.central.slice(0, 3).map(point => 
                            `<p><strong>${point.title || 'æ ¸å¿ƒè§‚ç‚¹'}ï¼š</strong>${point.description || 'è¯¦ç»†æè¿°'}</p>`
                        ).join('')}
                    </div>
                </div>

                <div style="margin-bottom: 24px;">
                    <h3 style="color: #2D3436; margin-bottom: 12px;">ğŸ’¡ å®ç”¨å»ºè®®</h3>
                    <div style="background: #F8F9FA; padding: 16px; border-radius: 8px;">
                        ${analysis.keyPoints.practical.slice(0, 3).map(point => 
                            `<p><strong>${point.title || 'å»ºè®®'}ï¼š</strong>${point.application || 'åº”ç”¨æ–¹æ³•'}</p>`
                        ).join('')}
                    </div>
                </div>

                <div style="margin-bottom: 24px;">
                    <h3 style="color: #2D3436; margin-bottom: 12px;">ğŸ“ˆ ä»·å€¼è¯„ä¼°</h3>
                    <div style="background: #F8F9FA; padding: 16px; border-radius: 8px;">
                        <p><strong>æ™ºåŠ›ä»·å€¼ï¼š</strong>${analysis.valueAssessment.intellectual}/10</p>
                        <p><strong>å®ç”¨ä»·å€¼ï¼š</strong>${analysis.valueAssessment.practical}/10</p>
                        <p><strong>æ€»ä½“è¯„ä»·ï¼š</strong>${analysis.valueAssessment.overall}</p>
                    </div>
                </div>

                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button onclick="this.closest('.modal-backdrop').remove()" style="padding: 12px 24px; background: #636E72; color: white; border: none; border-radius: 8px; cursor: pointer;">å…³é—­</button>
                    <button onclick="exportDeconstructionResults()" style="padding: 12px 24px; background: #5B5FDE; color: white; border: none; border-radius: 8px; cursor: pointer;">å¯¼å‡ºæŠ¥å‘Š</button>
                </div>
            `;

            modal.className = 'modal-backdrop';
            modal.appendChild(content);
            document.body.appendChild(modal);

            modal.onclick = (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            };
        }

        // AIä»¿å†™åŠŸèƒ½
        async function aiImitateStyle() {
            const originalText = document.getElementById('imitationText').value.trim();
            const targetStyle = document.getElementById('targetStyle').value;

            if (!originalText) {
                alert('è¯·è¾“å…¥è¦ä»¿å†™çš„æ–‡æœ¬');
                return;
            }

            if (!targetStyle) {
                alert('è¯·é€‰æ‹©ç›®æ ‡é£æ ¼');
                return;
            }

            try {
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                const btn = event.target;
                const originalText = btn.innerHTML;
                btn.innerHTML = '<div class="spinner"></div> æ­£åœ¨åˆ†æé£æ ¼...';
                btn.disabled = true;

                // å…ˆåˆ†æåŸæ–‡é£æ ¼
                const analysis = await window.aiWritingImitation.analyzeWritingStyle(originalText);

                // ç”Ÿæˆä»¿å†™å†…å®¹
                const result = await window.aiWritingImitation.generateImitation(originalText, targetStyle);

                // æ˜¾ç¤ºä»¿å†™ç»“æœ
                showImitationResults(originalText, result, analysis);

                // æ¢å¤æŒ‰é’®çŠ¶æ€
                btn.innerHTML = originalText;
                btn.disabled = false;

                // ä¿å­˜ä»¿å†™ç»“æœ
                saveImitationResults(originalText, result, analysis);

            } catch (error) {
                alert('ä»¿å†™å¤±è´¥ï¼š' + error.message);
                const btn = event.target;
                btn.innerHTML = 'âœï¸ å¼€å§‹ä»¿å†™';
                btn.disabled = false;
            }
        }

        // æ˜¾ç¤ºä»¿å†™ç»“æœ
        function showImitationResults(originalText, result, analysis) {
            // åˆ›å»ºç»“æœå¼¹çª—
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                background: rgba(0,0,0,0.8); z-index: 10000;
                display: flex; align-items: center; justify-content: center;
            `;

            const content = document.createElement('div');
            content.style.cssText = `
                background: white; border-radius: 16px; padding: 32px;
                max-width: 900px; max-height: 80vh; overflow-y: auto;
                box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            `;

            const styleTemplate = window.aiWritingImitation.getStyleTemplate(result.targetStyle);

            content.innerHTML = `
                <h2 style="color: #5B5FDE; margin-bottom: 24px;">âœï¸ AIä»¿å†™åˆ†ææŠ¥å‘Š</h2>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px;">
                    <div>
                        <h3 style="color: #2D3436; margin-bottom: 12px;">ğŸ“ åŸæ–‡</h3>
                        <div style="background: #F8F9FA; padding: 16px; border-radius: 8px; max-height: 200px; overflow-y: auto;">
                            <pre style="white-space: pre-wrap; font-family: inherit; margin: 0;">${originalText}</pre>
                        </div>
                    </div>
                    
                    <div>
                        <h3 style="color: #2D3436; margin-bottom: 12px;">ğŸ¯ ä»¿å†™ç»“æœ</h3>
                        <div style="background: #E8F5E8; padding: 16px; border-radius: 8px; max-height: 200px; overflow-y: auto;">
                            <pre style="white-space: pre-wrap; font-family: inherit; margin: 0;">${result.imitated}</pre>
                        </div>
                    </div>
                </div>

                <div style="margin-bottom: 24px;">
                    <h3 style="color: #2D3436; margin-bottom: 12px;">ğŸ¨ ç›®æ ‡é£æ ¼ç‰¹ç‚¹</h3>
                    <div style="background: #F8F9FA; padding: 16px; border-radius: 8px;">
                        <p><strong>é£æ ¼ç‰¹å¾ï¼š</strong>${styleTemplate.characteristics ? styleTemplate.characteristics.join('ã€') : 'ç‰¹è‰²æ˜æ˜¾'}</p>
                        <p><strong>æƒ…æ„ŸåŸºè°ƒï¼š</strong>${styleTemplate.tone || 'ç‹¬ç‰¹'}</p>
                        <p><strong>ç»“æ„ç‰¹ç‚¹ï¼š</strong>${styleTemplate.structure || 'æ¸…æ™°'}</p>
                    </div>
                </div>

                <div style="margin-bottom: 24px;">
                    <h3 style="color: #2D3436; margin-bottom: 12px;">ğŸ“Š è´¨é‡è¯„ä¼°</h3>
                    <div style="background: #F8F9FA; padding: 16px; border-radius: 8px;">
                        <p><strong>é£æ ¼ç›¸ä¼¼åº¦ï¼š</strong>${result.quality ? Math.round(result.quality.overall * 100) + '%' : '85%'}</p>
                        <p><strong>æ„ä¹‰ä¿æŒåº¦ï¼š</strong>${result.quality ? 'é«˜' : 'è‰¯å¥½'}</p>
                        <p><strong>è¯­è¨€æµç•…åº¦ï¼š</strong>${result.quality ? 'è‰¯å¥½' : 'ä¼˜ç§€'}</p>
                    </div>
                </div>

                <div style="margin-bottom: 24px;">
                    <h3 style="color: #2D3436; margin-bottom: 12px;">ğŸ’¡ æ”¹è¿›å»ºè®®</h3>
                    <div style="background: #F8F9FA; padding: 16px; border-radius: 8px;">
                        ${(result.suggestions || [
                            'å¯ä»¥é€‚å½“å¢åŠ ä¸€äº›ä¿®è¾æ‰‹æ³•æ¥å¢å¼ºè¡¨ç°åŠ›',
                            'æ³¨æ„ä¿æŒæƒ…æ„ŸåŸºè°ƒçš„ä¸€è‡´æ€§',
                            'å¯ä»¥é€‚å½“è°ƒæ•´å¥å¼ç»“æ„æ¥ä¸°å¯Œè¡¨è¾¾'
                        ]).join('<br>')}
                    </div>
                </div>

                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button onclick="this.closest('.modal-backdrop').remove()" style="padding: 12px 24px; background: #636E72; color: white; border: none; border-radius: 8px; cursor: pointer;">å…³é—­</button>
                    <button onclick="copyImitationResult('${result.imitated.replace(/'/g, "\\'")}')" style="padding: 12px 24px; background: #5B5FDE; color: white; border: none; border-radius: 8px; cursor: pointer;">å¤åˆ¶ç»“æœ</button>
                    <button onclick="applyImitationToEditor('${result.imitated.replace(/'/g, "\\'")}')" style="padding: 12px 24px; background: #4ECDC4; color: white; border: none; border-radius: 8px; cursor: pointer;">åº”ç”¨åˆ°ç¼–è¾‘å™¨</button>
                </div>
            `;

            modal.className = 'modal-backdrop';
            modal.appendChild(content);
            document.body.appendChild(modal);

            modal.onclick = (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            };
        }

        // ä¿å­˜æ‹†ä¹¦ç»“æœ
        function saveDeconstructionResults(bookContent, analysis, notes, cards) {
            const result = {
                bookContent: bookContent,
                analysis: analysis,
                notes: notes,
                cards: cards,
                createdAt: new Date().toISOString()
            };

            const savedResults = JSON.parse(localStorage.getItem('aiDeconstructionResults') || '[]');
            savedResults.unshift(result);
            
            // åªä¿ç•™æœ€è¿‘10ä¸ªç»“æœ
            if (savedResults.length > 10) {
                savedResults.splice(10);
            }

            localStorage.setItem('aiDeconstructionResults', JSON.stringify(savedResults));
        }

        // ä¿å­˜ä»¿å†™ç»“æœ
        function saveImitationResults(originalText, result, analysis) {
            const savedResult = {
                originalText: originalText,
                result: result,
                analysis: analysis,
                createdAt: new Date().toISOString()
            };

            const savedResults = JSON.parse(localStorage.getItem('aiImitationResults') || '[]');
            savedResults.unshift(savedResult);
            
            // åªä¿ç•™æœ€è¿‘10ä¸ªç»“æœ
            if (savedResults.length > 10) {
                savedResults.splice(10);
            }

            localStorage.setItem('aiImitationResults', JSON.stringify(savedResults));
        }

        // å¤åˆ¶ä»¿å†™ç»“æœ
        function copyImitationResult(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('ä»¿å†™ç»“æœå·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            }).catch(() => {
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å¤åˆ¶');
            });
        }

        // å°†ä»¿å†™ç»“æœåº”ç”¨åˆ°ç¼–è¾‘å™¨
        function applyImitationToEditor(text) {
            const editor = document.getElementById('editor');
            const cursorPos = editor.selectionStart;
            
            editor.value = editor.value.substring(0, cursorPos) + text + editor.value.substring(cursorPos);
            updateWordCount();
            scheduleAutoSave();
            
            // å…³é—­å¼¹çª—
            document.querySelector('.modal-backdrop').remove();
        }

        // å¯¼å‡ºæ‹†ä¹¦æŠ¥å‘Š
        function exportDeconstructionResults() {
            // ä»localStorageè·å–æœ€æ–°çš„æ‹†ä¹¦ç»“æœ
            const savedResults = JSON.parse(localStorage.getItem('aiDeconstructionResults') || '[]');
            if (savedResults.length === 0) {
                alert('æ²¡æœ‰å¯å¯¼å‡ºçš„æ‹†ä¹¦ç»“æœ');
                return;
            }

            const latestResult = savedResults[0];
            const reportContent = generateDeconstructionReport(latestResult);
            
            // åˆ›å»ºå¹¶ä¸‹è½½æ–‡ä»¶
            const blob = new Blob([reportContent], { type: 'text/plain;charset=utf-8' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'AIæ‹†ä¹¦åˆ†ææŠ¥å‘Š_' + new Date().toISOString().slice(0, 10) + '.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        // ç”Ÿæˆæ‹†ä¹¦æŠ¥å‘Šå†…å®¹
        function generateDeconstructionReport(result) {
            let report = 'ğŸ“– AIæ‹†ä¹¦åˆ†ææŠ¥å‘Š\n';
            report += 'ç”Ÿæˆæ—¶é—´ï¼š' + new Date(result.createdAt).toLocaleString() + '\n\n';

            report += 'ğŸ“Š åŸºæœ¬ä¿¡æ¯\n';
            report += 'ç»“æ„æ¡†æ¶ï¼š' + result.analysis.structure.outline.map(item => item.title).join(' â†’ ') + '\n';
            report += 'ä¸»è¦ç« èŠ‚ï¼š' + result.analysis.structure.chapters.length + 'ä¸ª\n';
            report += 'æ•´ä½“é£æ ¼ï¼š' + (result.analysis.writingTechniques.overall.style || 'ç°ä»£é£æ ¼') + '\n\n';

            report += 'ğŸ¯ æ ¸å¿ƒè§‚ç‚¹\n';
            result.analysis.keyPoints.central.slice(0, 5).forEach((point, index) => {
                report += `${index + 1}. ${point.title || 'æ ¸å¿ƒè§‚ç‚¹'}ï¼š${point.description || 'è¯¦ç»†æè¿°'}\n`;
            });
            report += '\n';

            report += 'ğŸ’¡ å®ç”¨å»ºè®®\n';
            result.analysis.keyPoints.practical.slice(0, 5).forEach((point, index) => {
                report += `${index + 1}. ${point.title || 'å»ºè®®'}ï¼š${point.application || 'åº”ç”¨æ–¹æ³•'}\n`;
            });
            report += '\n';

            report += 'ğŸ“ˆ ä»·å€¼è¯„ä¼°\n';
            report += 'æ™ºåŠ›ä»·å€¼ï¼š' + result.analysis.valueAssessment.intellectual + '/10\n';
            report += 'å®ç”¨ä»·å€¼ï¼š' + result.analysis.valueAssessment.practical + '/10\n';
            report += 'æ€»ä½“è¯„ä»·ï¼š' + result.analysis.valueAssessment.overall + '\n\n';

            report += 'ğŸ“ åŸæ–‡å†…å®¹\n';
            report += result.bookContent.substring(0, 1000) + (result.bookContent.length > 1000 ? '...' : '') + '\n\n';

            report += '---\n';
            report += 'æœ¬æŠ¥å‘Šç”±AIå†™ä½œåŠ©æ‰‹è‡ªåŠ¨ç”Ÿæˆ\n';

            return report;
        }

        // ç»Ÿè®¡åŠŸèƒ½
        function updateStatistics() {
            // ä»Šæ—¥å­—æ•°
            const today = new Date().toDateString();
            let todayWords = 0;
            
            for (const docId in documents) {
                const doc = documents[docId];
                if (new Date(doc.updatedAt).toDateString() === today) {
                    todayWords += doc.content.length;
                }
            }
            
            document.getElementById('todayWords').textContent = todayWords;
            document.getElementById('weekWords').textContent = Math.round(todayWords * 7); // ç®€åŒ–è®¡ç®—
            document.getElementById('completedDocs').textContent = Object.keys(documents).filter(id => 
                documents[id].content.length > 100
            ).length;
        }
    </script>
</body>
</html>