<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FitLife - é£Ÿç‰©æŸ¥è¯¢</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="page-container">
        <!-- é¡µé¢å¤´éƒ¨ -->
        <header class="page-header">
            <button class="back-btn" onclick="parent.navigateToPage('diet.html')">â† è¿”å›</button>
            <h1>é£Ÿç‰©æŸ¥è¯¢</h1>
        </header>

        <!-- æœç´¢åŒºåŸŸ -->
        <section class="search-section">
            <div class="search-container">
                <div class="search-input-wrapper">
                    <input type="text" id="food-search-input" placeholder="æœç´¢é£Ÿç‰©åç§°æˆ–æ‰«ææ¡å½¢ç " class="search-input-large">
                    <button class="search-btn-large" onclick="performSearch()">ğŸ”</button>
                </div>
                <div class="search-actions">
                    <button class="action-btn" onclick="scanBarcode()">
                        <span class="action-icon">ğŸ“·</span>
                        <span>æ‰«ç </span>
                    </button>
                    <button class="action-btn" onclick="voiceSearch()">
                        <span class="action-icon">ğŸ¤</span>
                        <span>è¯­éŸ³</span>
                    </button>
                    <button class="action-btn" onclick="cameraSearch()">
                        <span class="action-icon">ğŸ½ï¸</span>
                        <span>æ‹ç…§è¯†åˆ«</span>
                    </button>
                </div>
            </div>
        </section>

        <!-- å¿«æ·åˆ†ç±» -->
        <section class="food-categories">
            <h2>é£Ÿç‰©åˆ†ç±»</h2>
            <div class="category-grid">
                <button class="category-item" onclick="browseCategory('grains')">
                    <div class="category-icon">ğŸŒ¾</div>
                    <span>ä¸»é£Ÿ</span>
                </button>
                <button class="category-item" onclick="browseCategory('meat')">
                    <div class="category-icon">ğŸ¥©</div>
                    <span>è‚‰ç±»</span>
                </button>
                <button class="category-item" onclick="browseCategory('vegetables')">
                    <div class="category-icon">ğŸ¥¬</div>
                    <span>è”¬èœ</span>
                </button>
                <button class="category-item" onclick="browseCategory('fruits')">
                    <div class="category-icon">ğŸ</div>
                    <span>æ°´æœ</span>
                </button>
                <button class="category-item" onclick="browseCategory('dairy')">
                    <div class="category-icon">ğŸ¥›</div>
                    <span>ä¹³åˆ¶å“</span>
                </button>
                <button class="category-item" onclick="browseCategory('nuts')">
                    <div class="category-icon">ğŸŒ°</div>
                    <span>åšæœ</span>
                </button>
                <button class="category-item" onclick="browseCategory('beverages')">
                    <div class="category-icon">â˜•</div>
                    <span>é¥®å“</span>
                </button>
                <button class="category-item" onclick="browseCategory('snacks')">
                    <div class="category-icon">ğŸ¿</div>
                    <span>é›¶é£Ÿ</span>
                </button>
            </div>
        </section>

        <!-- çƒ­é—¨é£Ÿç‰© -->
        <section class="popular-foods">
            <div class="section-header">
                <h2>çƒ­é—¨é£Ÿç‰©</h2>
                <button class="view-more-btn" onclick="viewMorePopular()">æ›´å¤š â†’</button>
            </div>
            <div class="popular-list">
                <div class="popular-item" onclick="selectFood('ç±³é¥­', 116, 100)">
                    <img src="assets/images/food/rice.jpg" alt="ç±³é¥­" class="food-thumb">
                    <div class="food-info">
                        <div class="food-name">ç±³é¥­</div>
                        <div class="food-calories">116åƒå¡/100g</div>
                    </div>
                    <button class="quick-add-btn">+</button>
                </div>
                <div class="popular-item" onclick="selectFood('é¸¡è›‹', 155, 100)">
                    <img src="assets/images/food/egg.jpg" alt="é¸¡è›‹" class="food-thumb">
                    <div class="food-info">
                        <div class="food-name">é¸¡è›‹</div>
                        <div class="food-calories">155åƒå¡/100g</div>
                    </div>
                    <button class="quick-add-btn">+</button>
                </div>
                <div class="popular-item" onclick="selectFood('è‹¹æœ', 52, 100)">
                    <img src="assets/images/food/apple.jpg" alt="è‹¹æœ" class="food-thumb">
                    <div class="food-info">
                        <div class="food-name">è‹¹æœ</div>
                        <div class="food-calories">52åƒå¡/100g</div>
                    </div>
                    <button class="quick-add-btn">+</button>
                </div>
                <div class="popular-item" onclick="selectFood('é¸¡èƒ¸è‚‰', 165, 100)">
                    <img src="assets/images/food/chicken-breast.jpg" alt="é¸¡èƒ¸è‚‰" class="food-thumb">
                    <div class="food-info">
                        <div class="food-name">é¸¡èƒ¸è‚‰</div>
                        <div class="food-calories">165åƒå¡/100g</div>
                    </div>
                    <button class="quick-add-btn">+</button>
                </div>
                <div class="popular-item" onclick="selectFood('ç‰›å¥¶', 54, 100)">
                    <img src="assets/images/food/milk.jpg" alt="ç‰›å¥¶" class="food-thumb">
                    <div class="food-info">
                        <div class="food-name">ç‰›å¥¶</div>
                        <div class="food-calories">54åƒå¡/100ml</div>
                    </div>
                    <button class="quick-add-btn">+</button>
                </div>
                <div class="popular-item" onclick="selectFood('é¦™è•‰', 89, 100)">
                    <img src="assets/images/food/banana.jpg" alt="é¦™è•‰" class="food-thumb">
                    <div class="food-info">
                        <div class="food-name">é¦™è•‰</div>
                        <div class="food-calories">89åƒå¡/100g</div>
                    </div>
                    <button class="quick-add-btn">+</button>
                </div>
            </div>
        </section>

        <!-- æœç´¢å†å² -->
        <section class="search-history">
            <div class="section-header">
                <h2>æœç´¢å†å²</h2>
                <button class="clear-history-btn" onclick="clearHistory()">æ¸…é™¤</button>
            </div>
            <div class="history-list">
                <div class="history-item" onclick="searchFromHistory('è¥¿å…°èŠ±')">
                    <span class="history-icon">ğŸ•</span>
                    <span class="history-text">è¥¿å…°èŠ±</span>
                    <button class="history-remove" onclick="removeHistoryItem(this, event)">Ã—</button>
                </div>
                <div class="history-item" onclick="searchFromHistory('é…¸å¥¶')">
                    <span class="history-icon">ğŸ•</span>
                    <span class="history-text">é…¸å¥¶</span>
                    <button class="history-remove" onclick="removeHistoryItem(this, event)">Ã—</button>
                </div>
                <div class="history-item" onclick="searchFromHistory('å…¨éº¦é¢åŒ…')">
                    <span class="history-icon">ğŸ•</span>
                    <span class="history-text">å…¨éº¦é¢åŒ…</span>
                    <button class="history-remove" onclick="removeHistoryItem(this, event)">Ã—</button>
                </div>
                <div class="history-item" onclick="searchFromHistory('ä¸‰æ–‡é±¼')">
                    <span class="history-icon">ğŸ•</span>
                    <span class="history-text">ä¸‰æ–‡é±¼</span>
                    <button class="history-remove" onclick="removeHistoryItem(this, event)">Ã—</button>
                </div>
            </div>
        </section>

        <!-- æœç´¢ç»“æœåŒºåŸŸ -->
        <section class="search-results-section" id="search-results-section" style="display: none;">
            <div class="results-header">
                <h2>æœç´¢ç»“æœ</h2>
                <span class="results-count">æ‰¾åˆ° <span id="results-count">0</span> ä¸ªç»“æœ</span>
            </div>
            <div class="results-list" id="results-list">
                <!-- åŠ¨æ€åŠ è½½æœç´¢ç»“æœ -->
            </div>
        </section>

        <!-- å¸¸ç”¨å“ç‰Œ -->
        <section class="popular-brands">
            <div class="section-header">
                <h2>å¸¸ç”¨å“ç‰Œ</h2>
                <button class="view-all-brands" onclick="viewAllBrands()">å…¨éƒ¨ â†’</button>
            </div>
            <div class="brands-grid">
                <div class="brand-item" onclick="searchByBrand('åº·å¸ˆå‚…')">
                    <img src="assets/images/brands/kangshifu.jpg" alt="åº·å¸ˆå‚…" class="brand-logo">
                    <span>åº·å¸ˆå‚…</span>
                </div>
                <div class="brand-item" onclick="searchByBrand('ä¼Šåˆ©')">
                    <img src="assets/images/brands/yili.jpg" alt="ä¼Šåˆ©" class="brand-logo">
                    <span>ä¼Šåˆ©</span>
                </div>
                <div class="brand-item" onclick="searchByBrand('è’™ç‰›')">
                    <img src="assets/images/brands/mengniu.jpg" alt="è’™ç‰›" class="brand-logo">
                    <span>è’™ç‰›</span>
                </div>
                <div class="brand-item" onclick="searchByBrand('å†œå¤«å±±æ³‰')">
                    <img src="assets/images/brands/nongfu.jpg" alt="å†œå¤«å±±æ³‰" class="brand-logo">
                    <span>å†œå¤«å±±æ³‰</span>
                </div>
            </div>
        </section>
    </div>

    <!-- é£Ÿç‰©è¯¦æƒ…å¼¹çª— -->
    <div class="modal-overlay" id="food-detail-modal" style="display: none;">
        <div class="modal-content food-detail-modal">
            <div class="modal-header">
                <h3 id="food-detail-title">é£Ÿç‰©è¯¦æƒ…</h3>
                <button class="close-btn" onclick="closeFoodDetail()">Ã—</button>
            </div>
            <div class="modal-body">
                <img id="food-detail-image" src="" alt="" class="food-detail-image">
                <div class="nutrition-info">
                    <div class="nutrition-row">
                        <span class="nutrition-label">çƒ­é‡</span>
                        <span class="nutrition-value" id="food-detail-calories">0åƒå¡/100g</span>
                    </div>
                    <div class="nutrition-row">
                        <span class="nutrition-label">è›‹ç™½è´¨</span>
                        <span class="nutrition-value" id="food-detail-protein">0g/100g</span>
                    </div>
                    <div class="nutrition-row">
                        <span class="nutrition-label">ç¢³æ°´åŒ–åˆç‰©</span>
                        <span class="nutrition-value" id="food-detail-carbs">0g/100g</span>
                    </div>
                    <div class="nutrition-row">
                        <span class="nutrition-label">è„‚è‚ª</span>
                        <span class="nutrition-value" id="food-detail-fat">0g/100g</span>
                    </div>
                </div>
                
                <div class="add-food-form">
                    <div class="form-row">
                        <label>åˆ†é‡</label>
                        <input type="number" id="food-amount" value="100" min="0" step="1">
                        <select id="food-unit">
                            <option value="g">å…‹</option>
                            <option value="ä»½">ä»½</option>
                            <option value="ä¸ª">ä¸ª</option>
                            <option value="ml">æ¯«å‡</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <label>ç”¨é¤æ—¶é—´</label>
                        <select id="meal-time-type">
                            <option value="breakfast">æ—©é¤</option>
                            <option value="lunch">åˆé¤</option>
                            <option value="dinner">æ™šé¤</option>
                            <option value="snack">åŠ é¤</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="secondary-btn" onclick="closeFoodDetail()">å–æ¶ˆ</button>
                <button class="primary-btn" onclick="confirmAddFood()">æ·»åŠ åˆ°é¥®é£Ÿè®°å½•</button>
            </div>
        </div>
    </div>

    <script>
        let currentFoodData = null;

        function performSearch() {
            const searchTerm = document.getElementById('food-search-input').value;
            if (!searchTerm.trim()) return;

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            showLoading();
            
            // æ¨¡æ‹Ÿæœç´¢APIè°ƒç”¨
            setTimeout(() => {
                const results = mockSearchResults(searchTerm);
                displaySearchResults(results);
                hideLoading();
            }, 500);
        }

        function mockSearchResults(searchTerm) {
            // æ¨¡æ‹Ÿæœç´¢ç»“æœ
            return [
                {
                    name: `${searchTerm} ç›¸å…³é£Ÿç‰©1`,
                    calories: 120,
                    protein: 8,
                    carbs: 15,
                    fat: 4,
                    unit: 'g',
                    image: 'assets/images/food/default.jpg'
                },
                {
                    name: `${searchTerm} ç›¸å…³é£Ÿç‰©2`,
                    calories: 85,
                    protein: 6,
                    carbs: 12,
                    fat: 2,
                    unit: 'g',
                    image: 'assets/images/food/default.jpg'
                }
            ];
        }

        function displaySearchResults(results) {
            const resultsSection = document.getElementById('search-results-section');
            const resultsList = document.getElementById('results-list');
            const resultsCount = document.getElementById('results-count');
            
            resultsSection.style.display = 'block';
            resultsCount.textContent = results.length;
            
            resultsList.innerHTML = results.map(food => `
                <div class="result-item" onclick="showFoodDetail('${food.name}', ${food.calories}, ${food.protein}, ${food.carbs}, ${food.fat}, '${food.unit}', '${food.image}')">
                    <img src="${food.image}" alt="${food.name}" class="result-image">
                    <div class="result-info">
                        <div class="result-name">${food.name}</div>
                        <div class="result-calories">${food.calories}åƒå¡/100${food.unit}</div>
                        <div class="result-nutrition">
                            è›‹ç™½è´¨: ${food.protein}g | ç¢³æ°´: ${food.carbs}g | è„‚è‚ª: ${food.fat}g
                        </div>
                    </div>
                    <button class="quick-add-result" onclick="quickAddResult(event, '${food.name}', ${food.calories})">+</button>
                </div>
            `).join('');
        }

        function scanBarcode() {
            alert('æ‰«ç åŠŸèƒ½ï¼šè¯·ä½¿ç”¨ç›¸æœºæ‰«æé£Ÿå“æ¡å½¢ç ');
        }

        function voiceSearch() {
            alert('è¯­éŸ³æœç´¢ï¼šè¯·è¯´å‡ºé£Ÿç‰©åç§°');
        }

        function cameraSearch() {
            alert('æ‹ç…§è¯†åˆ«ï¼šè¯·æ‹æ‘„é£Ÿç‰©ç…§ç‰‡');
        }

        function browseCategory(category) {
            alert(`æµè§ˆåˆ†ç±»ï¼š${getCategoryName(category)}`);
        }

        function getCategoryName(category) {
            const names = {
                'grains': 'ä¸»é£Ÿ',
                'meat': 'è‚‰ç±»',
                'vegetables': 'è”¬èœ',
                'fruits': 'æ°´æœ',
                'dairy': 'ä¹³åˆ¶å“',
                'nuts': 'åšæœ',
                'beverages': 'é¥®å“',
                'snacks': 'é›¶é£Ÿ'
            };
            return names[category] || category;
        }

        function selectFood(name, calories, amount) {
            // ç›´æ¥é€‰æ‹©çƒ­é—¨é£Ÿç‰©
            addToMealRecord(name, calories, amount);
        }

        function showFoodDetail(name, calories, protein, carbs, fat, unit, image) {
            currentFoodData = { name, calories, protein, carbs, fat, unit, image };
            
            document.getElementById('food-detail-title').textContent = name;
            document.getElementById('food-detail-image').src = image;
            document.getElementById('food-detail-calories').textContent = `${calories}åƒå¡/100${unit}`;
            document.getElementById('food-detail-protein').textContent = `${protein}g/100${unit}`;
            document.getElementById('food-detail-carbs').textContent = `${carbs}g/100${unit}`;
            document.getElementById('food-detail-fat').textContent = `${fat}g/100${unit}`;
            
            document.getElementById('food-detail-modal').style.display = 'block';
        }

        function closeFoodDetail() {
            document.getElementById('food-detail-modal').style.display = 'none';
            currentFoodData = null;
        }

        function confirmAddFood() {
            if (!currentFoodData) return;
            
            const amount = document.getElementById('food-amount').value;
            const unit = document.getElementById('food-unit').value;
            const mealType = document.getElementById('meal-time-type').value;
            
            addToMealRecord(currentFoodData.name, currentFoodData.calories, amount, unit, mealType);
            closeFoodDetail();
        }

        function addToMealRecord(name, caloriesPer100g, amount, unit = 'g', mealType = 'lunch') {
            const totalCalories = Math.round((caloriesPer100g / 100) * amount);
            
            alert(`å·²æ·»åŠ åˆ°${getMealTypeName(mealType)}ï¼š\n${name} ${amount}${unit}\nçº¦${totalCalories}åƒå¡`);
            
            // è¿”å›é¥®é£Ÿé¡µé¢
            setTimeout(() => {
                parent.navigateToPage('diet.html');
            }, 1000);
        }

        function getMealTypeName(mealType) {
            const names = {
                'breakfast': 'æ—©é¤',
                'lunch': 'åˆé¤',
                'dinner': 'æ™šé¤',
                'snack': 'åŠ é¤'
            };
            return names[mealType] || 'é¤é£Ÿ';
        }

        function quickAddResult(event, name, calories) {
            event.stopPropagation();
            addToMealRecord(name, calories, 100);
        }

        function searchFromHistory(term) {
            document.getElementById('food-search-input').value = term;
            performSearch();
        }

        function removeHistoryItem(btn, event) {
            event.stopPropagation();
            btn.parentElement.remove();
        }

        function clearHistory() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æœç´¢å†å²å—ï¼Ÿ')) {
                document.querySelector('.history-list').innerHTML = '';
            }
        }

        function viewMorePopular() {
            alert('æ˜¾ç¤ºæ›´å¤šçƒ­é—¨é£Ÿç‰©');
        }

        function viewAllBrands() {
            alert('æ˜¾ç¤ºæ‰€æœ‰å“ç‰Œåˆ—è¡¨');
        }

        function searchByBrand(brand) {
            document.getElementById('food-search-input').value = brand;
            performSearch();
        }

        function showLoading() {
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            console.log('Loading...');
        }

        function hideLoading() {
            // éšè—åŠ è½½çŠ¶æ€
            console.log('Load complete');
        }

        // ç›‘å¬å›è½¦é”®æœç´¢
        document.getElementById('food-search-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performSearch();
            }
        });
    </script>
</body>
</html>