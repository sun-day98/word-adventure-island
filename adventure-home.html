<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å†’é™©åœ°å›¾ - å•è¯å†’é™©å²›</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/word-adventure.css">
</head>
<body>
    <div class="page-container adventure-home">
        <!-- é¡µé¢å¤´éƒ¨ -->
        <header class="page-header adventure-header">
            <div class="header-content">
                <h1>ğŸï¸ å•è¯å†’é™©å²›</h1>
                <div class="header-actions">
                    <button class="info-btn" onclick="showGameGuide()">ğŸ“– æ¸¸æˆæŒ‡å—</button>
                </div>
            </div>
        </header>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <main class="main-content adventure-content">
            <!-- å‰§æƒ…ç« èŠ‚ -->
            <section class="story-chapter" id="current-chapter" style="display: none;">
                <div class="chapter-header">
                    <h2 id="chapter-title">å¥‡å¦™çš„ç›¸é‡</h2>
                    <span class="chapter-progress" id="chapter-progress">ç¬¬1ç« </span>
                </div>
                <div class="chapter-content">
                    <div class="story-scene" id="story-scene">
                        <!-- å‰§æƒ…åœºæ™¯å°†åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                    <div class="story-dialogue" id="story-dialogue">
                        <!-- å¯¹è¯å†…å®¹å°†åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                    <div class="story-actions">
                        <button class="primary-btn" id="continue-story" onclick="continueStory()">ç»§ç»­å†’é™©</button>
                        <button class="secondary-btn" onclick="skipStory()">è·³è¿‡å‰§æƒ…</button>
                    </div>
                </div>
            </section>

            <!-- å²›å±¿åœ°å›¾ -->
            <section class="island-map" id="island-map">
                <div class="map-header">
                    <h2>ğŸ—ºï¸ å†’é™©åœ°å›¾</h2>
                    <div class="map-filters">
                        <button class="filter-btn active" data-filter="all">å…¨éƒ¨</button>
                        <button class="filter-btn" data-filter="unlocked">å·²è§£é”</button>
                        <button class="filter-btn" data-filter="locked">æœªè§£é”</button>
                    </div>
                </div>

                <div class="islands-container" id="islands-container">
                    <!-- å²›å±¿å°†åŠ¨æ€ç”Ÿæˆ -->
                </div>

                <!-- åœ°å›¾å›¾ä¾‹ -->
                <div class="map-legend">
                    <div class="legend-item">
                        <span class="legend-icon unlocked">ğŸï¸</span>
                        <span class="legend-text">å·²è§£é”</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-icon locked">ğŸ”’</span>
                        <span class="legend-text">æœªè§£é”</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-icon current">â­</span>
                        <span class="legend-text">å½“å‰ä½ç½®</span>
                    </div>
                </div>
            </section>

            <!-- å¿«é€Ÿå¼€å§‹ -->
            <section class="quick-start">
                <h3>ğŸš€ å¿«é€Ÿå¼€å§‹</h3>
                <div class="quick-actions-grid">
                    <button class="quick-action-btn" onclick="startDailyChallenge()">
                        <span class="action-icon">ğŸ“…</span>
                        <span class="action-title">æ¯æ—¥æŒ‘æˆ˜</span>
                        <span class="action-desc">å®Œæˆä»Šæ—¥ä»»åŠ¡</span>
                    </button>
                    <button class="quick-action-btn" onclick="startReview()">
                        <span class="action-icon">ğŸ”„</span>
                        <span class="action-title">å•è¯å¤ä¹ </span>
                        <span class="action-desc">å¤ä¹ å·²å­¦å•è¯</span>
                    </button>
                    <button class="quick-action-btn" onclick="startStoryMode()">
                        <span class="action-icon">ğŸ“–</span>
                        <span class="action-title">å‰§æƒ…æ¨¡å¼</span>
                        <span class="action-desc">ç»§ç»­å†’é™©æ•…äº‹</span>
                    </button>
                    <button class="quick-action-btn" onclick="startChallenge()">
                        <span class="action-icon">ğŸ®</span>
                        <span class="action-title">è‡ªç”±æŒ‘æˆ˜</span>
                        <span class="action-desc">é€‰æ‹©å…³å¡æŒ‘æˆ˜</span>
                    </button>
                </div>
            </section>

            <!-- ä»Šæ—¥ç›®æ ‡ -->
            <section class="daily-goals">
                <h3>ğŸ¯ ä»Šæ—¥ç›®æ ‡</h3>
                <div class="goals-list" id="daily-goals-list">
                    <!-- ç›®æ ‡åˆ—è¡¨å°†åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </section>
        </main>
    </div>

    <!-- æ¸¸æˆæŒ‡å—å¼¹çª— -->
    <div id="game-guide-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content guide-modal">
            <div class="guide-header">
                <h3>ğŸ® æ¸¸æˆæŒ‡å—</h3>
                <button class="close-btn" onclick="closeGameGuide()">Ã—</button>
            </div>
            <div class="guide-content">
                <div class="guide-section">
                    <h4>ğŸ¯ æ¸¸æˆç›®æ ‡</h4>
                    <p>å¸®åŠ©éœéœå’Œå¥¹çš„ä¼™ä¼´ä»¬ï¼Œé€šè¿‡å­¦ä¹ å•è¯æ¥æ‹¯æ•‘è¢«"é—å¿˜è¿·é›¾"ç¬¼ç½©çš„ç«¥è¯ä¸–ç•Œï¼</p>
                </div>
                
                <div class="guide-section">
                    <h4>ğŸ—ºï¸ æ¢ç´¢å²›å±¿</h4>
                    <p>å®Œæˆå²›å±¿å…³å¡ï¼Œè§£é”æ–°çš„å•è¯å’Œæ•…äº‹ã€‚æ¯ä¸ªå²›å±¿éƒ½æœ‰ç‹¬ç‰¹çš„ä¸»é¢˜å’ŒæŒ‘æˆ˜ã€‚</p>
                </div>
                
                <div class="guide-section">
                    <h4>ğŸ“š å­¦ä¹ å•è¯</h4>
                    <p>é€šè¿‡å‘éŸ³æŒ‘æˆ˜ã€æ‹¼å†™é˜²å¾¡ã€æ„ä¹‰åŒ¹é…ç­‰å¤šç§æ–¹å¼å­¦ä¹ å’Œå·©å›ºå•è¯ã€‚</p>
                </div>
                
                <div class="guide-section">
                    <h4>âš”ï¸ æŒ‘æˆ˜æ¨¡å¼</h4>
                    <p>åŒ…å«å‘éŸ³ã€æ‹¼å†™ã€åŒ¹é…ã€å¥å­æ„å»ºç­‰å¤šç§æŒ‘æˆ˜ç±»å‹ï¼Œå…¨é¢æå‡è‹±è¯­èƒ½åŠ›ã€‚</p>
                </div>
                
                <div class="guide-section">
                    <h4>ğŸ† æˆé•¿ç³»ç»Ÿ</h4>
                    <p>è·å¾—ç»éªŒå€¼å‡çº§ï¼Œæ”¶é›†é‡‘å¸è´­ä¹°é“å…·ï¼Œè§£é”æˆå°±è·å¾—å¥–åŠ±ã€‚</p>
                </div>
                
                <div class="guide-section">
                    <h4>ğŸ‘¥ è§’è‰²æˆé•¿</h4>
                    <p>è§è¯è§’è‰²ä»¬ä»æœ‰ç¼ºé™·åˆ°æˆé•¿çš„æ•…äº‹ï¼Œè·å¾—æ·±åº¦çš„æƒ…æ„Ÿä½“éªŒã€‚</p>
                </div>
            </div>
        </div>
    </div>

    <!-- å²›å±¿è¯¦æƒ…å¼¹çª— -->
    <div id="island-detail-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content island-detail-modal">
            <div class="island-detail-header">
                <div class="island-preview" id="island-preview">
                    <!-- å²›å±¿é¢„è§ˆå›¾ -->
                </div>
                <div class="island-info">
                    <h3 id="island-detail-name">å²›å±¿åç§°</h3>
                    <p id="island-detail-desc">å²›å±¿æè¿°</p>
                    <div class="island-stats">
                        <span class="stat-item" id="island-levels">0/0 å…³å¡</span>
                        <span class="stat-item" id="island-words">0 å•è¯</span>
                    </div>
                </div>
            </div>
            
            <div class="island-levels" id="island-levels-list">
                <!-- å…³å¡åˆ—è¡¨å°†åŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <div class="modal-actions">
                <button class="secondary-btn" onclick="closeIslandDetail()">å…³é—­</button>
                <button class="primary-btn" id="start-island-btn" onclick="startIslandAdventure()">å¼€å§‹å†’é™©</button>
            </div>
        </div>
    </div>

    <script>
        // å½“å‰çŠ¶æ€
        let currentIsland = null;
        let currentChapter = null;
        let storyProgress = 0;

        // ===== é¡µé¢åˆå§‹åŒ– =====
        document.addEventListener('DOMContentLoaded', function() {
            initializeAdventureHome();
            setupEventListeners();
        });

        function initializeAdventureHome() {
            console.log('åˆå§‹åŒ–å†’é™©ä¸»é¡µ...');
            
            try {
                // ç›´æ¥åŠ è½½å²›å±¿åœ°å›¾ï¼Œä¸ä¾èµ–å¤æ‚çš„æ¸¸æˆå¼•æ“
                renderIslandMap();
                
                // åŠ è½½æ¯æ—¥ç›®æ ‡
                renderDailyGoalsSimple();
                
                // åˆå§‹åŒ–åœ°å›¾æ»¤é•œ
                initializeMapFilters();
                
                console.log('å†’é™©ä¸»é¡µåˆå§‹åŒ–å®Œæˆ');
            } catch (error) {
                console.error('å†’é™©ä¸»é¡µåˆå§‹åŒ–å¤±è´¥:', error);
                
                // å¦‚æœåˆå§‹åŒ–å¤±è´¥ï¼Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                const container = document.getElementById('islands-container');
                if (container) {
                    container.innerHTML = '<p style="text-align: center; color: #ff6b6b;">å†…å®¹åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•</p>';
                }
            }
        }

        // ===== å²›å±¿åœ°å›¾æ¸²æŸ“ =====
        function renderIslandMap() {
            console.log('å¼€å§‹æ¸²æŸ“å²›å±¿åœ°å›¾...');
            const container = document.getElementById('islands-container');
            
            if (!container) {
                console.error('æ‰¾ä¸åˆ°islands-containerå…ƒç´ ');
                return;
            }
            
            console.log('æ‰¾åˆ°islands-containerï¼Œå¼€å§‹ç”Ÿæˆå†…å®¹...');
            
            // ç®€åŒ–çš„å²›å±¿æ•°æ®
            const islands = [
                {
                    id: 'creature_island',
                    name: 'å¥‡å¦™ç”Ÿç‰©å²›',
                    description: 'å­¦ä¹ åŸºç¡€åŠ¨ç‰©ã€é¢œè‰²ã€æ°´æœå•è¯',
                    grade: [1, 2],
                    difficulty: 'beginner',
                    unlocked: true,
                    progress: 30,
                    icon: 'ğŸï¸'
                },
                {
                    id: 'volcano_island', 
                    name: 'èƒ½é‡ç«å±±å²›',
                    description: 'æŒæ¡åŠ¨ä½œå’Œæƒ…æ„Ÿè¡¨è¾¾ç±»å•è¯',
                    grade: [3, 4],
                    difficulty: 'intermediate',
                    unlocked: true,
                    progress: 15,
                    icon: 'ğŸŒ‹'
                },
                {
                    id: 'pyramid_island',
                    name: 'æ™ºæ…§é‡‘å­—å¡”',
                    description: 'å­¦ä¹ æŠ½è±¡æ¦‚å¿µå’Œå¤æ‚è¯æ±‡',
                    grade: [5, 6],
                    difficulty: 'advanced',
                    unlocked: false,
                    progress: 0,
                    icon: 'ğŸ”’'
                }
            ];
            
            let html = '';
            
            islands.forEach(island => {
                const isCurrent = island.id === 'creature_island'; // é»˜è®¤ç¬¬ä¸€ä¸ªä¸ºå½“å‰ä½ç½®
                
                html += `
                    <div class="island-card ${island.unlocked ? 'unlocked' : 'locked'} ${isCurrent ? 'current' : ''}" 
                         data-island-id="${island.id}"
                         onclick="showIslandDetail('${island.id}')">
                        <div class="island-visual">
                            <div class="island-icon">${island.icon}</div>
                            ${isCurrent ? '<div class="current-marker">â­</div>' : ''}
                        </div>
                        <div class="island-info">
                            <h4 class="island-name">${island.name}</h4>
                            <p class="island-desc">${island.description}</p>
                            <div class="island-meta">
                                <span class="grade-range">${island.grade[0]}-${island.grade[1]}å¹´çº§</span>
                                <span class="difficulty-badge ${island.difficulty}">${getDifficultyText(island.difficulty)}</span>
                            </div>
                        </div>
                        <div class="island-progress">
                            ${getIslandProgress(island)}
                        </div>
                    </div>
                `;
            });
            
            console.log('ç”Ÿæˆçš„HTML:', html);
            container.innerHTML = html;
            console.log('å²›å±¿åœ°å›¾æ¸²æŸ“å®Œæˆï¼Œå†…å®¹å·²æ’å…¥');
        }

        function getIslandProgress(island) {
            const percentage = island.progress || 0;
            const totalWords = 10; // æ¯ä¸ªå²›å±¿10ä¸ªå…³å¡
            const completedWords = Math.round(totalWords * percentage / 100);
            
            return `
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${percentage}%"></div>
                </div>
                <span class="progress-text">${completedWords}/${totalWords}</span>
            `;
        }

        function getDifficultyText(difficulty) {
            const difficultyMap = {
                'beginner': 'åˆçº§',
                'intermediate': 'ä¸­çº§',
                'advanced': 'é«˜çº§'
            };
            return difficultyMap[difficulty] || 'æœªçŸ¥';
        }

        // ===== ç®€åŒ–çš„æ¯æ—¥ç›®æ ‡æ¸²æŸ“ =====
        function renderDailyGoalsSimple() {
            const container = document.getElementById('daily-goals-list');
            
            // ç®€åŒ–çš„æ¯æ—¥ä»»åŠ¡æ•°æ®
            const dailyTasks = {
                wordsLearned: 3,
                challengesCompleted: 2,
                reviewCompleted: 1,
                timeSpent: 15
            };
            
            const goals = [
                {
                    icon: 'ğŸ“š',
                    text: 'å­¦ä¹ 10ä¸ªæ–°å•è¯',
                    current: dailyTasks.wordsLearned,
                    target: 10
                },
                {
                    icon: 'ğŸ®',
                    text: 'å®Œæˆ5ä¸ªæŒ‘æˆ˜',
                    current: dailyTasks.challengesCompleted,
                    target: 5
                },
                {
                    icon: 'â±ï¸',
                    text: 'å­¦ä¹ 20åˆ†é’Ÿ',
                    current: Math.floor(dailyTasks.timeSpent / 60),
                    target: 20
                }
            ];
            
            let html = '';
            goals.forEach(goal => {
                const progress = Math.min(goal.current, goal.target);
                const percentage = (progress / goal.target) * 100;
                const isCompleted = progress >= goal.target;
                
                html += `
                    <div class="goal-item ${isCompleted ? 'completed' : ''}">
                        <div class="goal-info">
                            <span class="goal-icon">${goal.icon}</span>
                            <span class="goal-text">${goal.text}</span>
                        </div>
                        <div class="goal-progress">
                            <span class="goal-count">${progress}/${goal.target}</span>
                            <div class="goal-bar">
                                <div class="goal-fill" style="width: ${percentage}%"></div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            console.log('ç”Ÿæˆçš„HTML:', html);
            container.innerHTML = html;
            console.log('å²›å±¿åœ°å›¾æ¸²æŸ“å®Œæˆï¼Œå†…å®¹å·²æ’å…¥');
        }

        // ===== å‰§æƒ…æ£€æŸ¥ =====
        function checkStoryProgress() {
            // æ£€æŸ¥æ˜¯å¦éœ€è¦æ˜¾ç¤ºå‰§æƒ…
            const playerLevel = WordAdventure.gameState.player.stats.level;
            const isFirstTime = !WordAdventure.gameState.progress.storyStarted;
            
            if (isFirstTime || playerLevel === 1) {
                showStoryChapter('chapter1');
                WordAdventure.gameState.progress.storyStarted = true;
            }
        }

        function showStoryChapter(chapterId) {
            const chapter = WordAdventureData.StoryChapters[chapterId];
            if (!chapter) return;
            
            currentChapter = chapter;
            storyProgress = 0;
            
            const chapterSection = document.getElementById('current-chapter');
            const islandMap = document.getElementById('island-map');
            
            chapterSection.style.display = 'block';
            islandMap.style.display = 'none';
            
            // æ›´æ–°ç« èŠ‚ä¿¡æ¯
            document.getElementById('chapter-title').textContent = chapter.title;
            document.getElementById('chapter-progress').textContent = `ç¬¬${chapterId.replace('chapter', '')}ç« `;
            
            // æ¸²æŸ“å‰§æƒ…å†…å®¹
            renderStoryContent();
        }

        function renderStoryContent() {
            if (!currentChapter) return;
            
            const sceneDiv = document.getElementById('story-scene');
            const dialogueDiv = document.getElementById('story-dialogue');
            
            // æ¸²æŸ“åœºæ™¯
            sceneDiv.innerHTML = `
                <div class="scene-setting">
                    <h4>ğŸ“ ${currentChapter.setting}</h4>
                    <p>${currentChapter.synopsis}</p>
                </div>
            `;
            
            // æ¸²æŸ“å¯¹è¯
            if (storyProgress < currentChapter.dialogue.length) {
                const dialogue = currentChapter.dialogue[storyProgress];
                dialogueDiv.innerHTML = `
                    <div class="dialogue-item ${dialogue.emotion}">
                        <div class="dialogue-speaker">${dialogue.speaker}:</div>
                        <div class="dialogue-text">${dialogue.text}</div>
                    </div>
                `;
            } else {
                // å‰§æƒ…ç»“æŸ
                dialogueDiv.innerHTML = `
                    <div class="story-summary">
                        <h4>ğŸ“– ç« èŠ‚æ€»ç»“</h4>
                        <p>${currentChapter.transition}</p>
                    </div>
                `;
                document.getElementById('continue-story').textContent = 'å¼€å§‹å†’é™©';
            }
        }

        function continueStory() {
            if (!currentChapter) return;
            
            storyProgress++;
            
            if (storyProgress > currentChapter.dialogue.length) {
                // å‰§æƒ…ç»“æŸï¼Œå›åˆ°åœ°å›¾
                closeStoryChapter();
            } else {
                renderStoryContent();
            }
        }

        function skipStory() {
            closeStoryChapter();
        }

        function closeStoryChapter() {
            const chapterSection = document.getElementById('current-chapter');
            const islandMap = document.getElementById('island-map');
            
            chapterSection.style.display = 'none';
            islandMap.style.display = 'block';
        }

        // ===== å²›å±¿è¯¦æƒ… =====
        function showIslandDetail(islandId) {
            const island = WordAdventureData.LevelConfig[islandId];
            if (!island) return;
            
            currentIsland = islandId;
            
            // æ›´æ–°è¯¦æƒ…ä¿¡æ¯
            document.getElementById('island-detail-name').textContent = island.name;
            document.getElementById('island-detail-desc').textContent = island.description;
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            const completedCount = island.levels.filter(level => 
                WordAdventure.gameState.player.progress.completedLevels.includes(level.id)
            ).length;
            
            document.getElementById('island-levels').textContent = `${completedCount}/${island.levels.length} å…³å¡`;
            document.getElementById('island-words').textContent = `${island.levels.reduce((sum, level) => sum + level.words.length, 0)} å•è¯`;
            
            // æ¸²æŸ“å…³å¡åˆ—è¡¨
            renderIslandLevels(island);
            
            // æ˜¾ç¤ºå¼¹çª—
            document.getElementById('island-detail-modal').style.display = 'flex';
        }

        function renderIslandLevels(island) {
            const container = document.getElementById('island-levels-list');
            const completedLevels = WordAdventure.gameState.player.progress.completedLevels;
            const unlockedLevels = WordAdventure.gameState.player.unlocked.levels;
            
            let html = '';
            island.levels.forEach((level, index) => {
                const isCompleted = completedLevels.includes(level.id);
                const isUnlocked = unlockedLevels.includes(level.id);
                const stars = calculateStars(level.id, isCompleted);
                
                html += `
                    <div class="level-item ${isCompleted ? 'completed' : ''} ${!isUnlocked ? 'locked' : ''}">
                        <div class="level-icon">
                            ${isCompleted ? 'âœ…' : (isUnlocked ? 'ğŸ¯' : 'ğŸ”’')}
                        </div>
                        <div class="level-info">
                            <h5 class="level-name">${level.name}</h5>
                            <p class="level-desc">${level.challenges.join(' Â· ')}</p>
                        </div>
                        <div class="level-rewards">
                            <div class="stars">${stars}</div>
                            <div class="rewards">
                                <span class="reward-exp">+${level.rewards.exp} EXP</span>
                                <span class="reward-coins">+${level.rewards.coins} ğŸ’°</span>
                            </div>
                        </div>
                        ${isUnlocked ? `<button class="play-btn" onclick="startLevel('${level.id}')">å¼€å§‹</button>` : ''}
                    </div>
                `;
            });
            
            console.log('ç”Ÿæˆçš„HTML:', html);
            container.innerHTML = html;
            console.log('å²›å±¿åœ°å›¾æ¸²æŸ“å®Œæˆï¼Œå†…å®¹å·²æ’å…¥');
        }

        function calculateStars(levelId, isCompleted) {
            if (!isCompleted) return 'â­â­â­';
            
            // è¿™é‡Œåº”è¯¥æ ¹æ®å®é™…å¾—åˆ†è®¡ç®—æ˜Ÿçº§
            // ç®€åŒ–å®ç°ï¼Œå‡è®¾éƒ½æ˜¯3æ˜Ÿ
            return 'â­â­â­';
        }

        function closeIslandDetail() {
            document.getElementById('island-detail-modal').style.display = 'none';
            currentIsland = null;
        }

        // ===== æ¸¸æˆåŠŸèƒ½å¯åŠ¨ =====
        function startIslandAdventure() {
            if (!currentIsland) return;
            
            // è®¾ç½®å½“å‰å²›å±¿
            WordAdventure.gameState.player.progress.currentIsland = currentIsland;
            
            // æ‰¾åˆ°ç¬¬ä¸€ä¸ªæœªå®Œæˆçš„å…³å¡
            const island = WordAdventureData.LevelConfig[currentIsland];
            const completedLevels = WordAdventure.gameState.player.progress.completedLevels;
            const nextLevel = island.levels.find(level => !completedLevels.includes(level.id));
            
            if (nextLevel) {
                startLevel(nextLevel.id);
            } else {
                // æ‰€æœ‰å…³å¡å·²å®Œæˆ
                showFloatingText('æ­å–œå®Œæˆè¯¥å²›å±¿çš„æ‰€æœ‰å…³å¡ï¼', 'success');
            }
        }

        function startLevel(levelId) {
            closeIslandDetail();
            
            // å¯¼èˆªåˆ°æŒ‘æˆ˜é¡µé¢
            if (window.parent && window.parent.NavigationManager) {
                window.parent.NavigationManager.navigateToPage(`challenge.html?level=${levelId}`);
            }
        }

        function startDailyChallenge() {
            console.log('å¼€å§‹æ¯æ—¥æŒ‘æˆ˜');
            showFloatingText('æ¯æ—¥æŒ‘æˆ˜åŠŸèƒ½å¼€å‘ä¸­...', 'info');
            
            // è·³è½¬åˆ°æŒ‘æˆ˜é¡µé¢
            window.location.href = 'challenges.html';
        }

        function startReview() {
            console.log('å¼€å§‹å•è¯å¤ä¹ ');
            showFloatingText('å•è¯å¤ä¹ åŠŸèƒ½å¼€å‘ä¸­...', 'info');
            
            // è·³è½¬åˆ°å•è¯ä¹¦é¡µé¢
            window.location.href = 'word-book.html';
        }

        function startStoryMode() {
            console.log('å¼€å§‹å‰§æƒ…æ¨¡å¼');
            showFloatingText('å‰§æƒ…æ¨¡å¼åŠŸèƒ½å¼€å‘ä¸­...', 'info');
            
            // æ˜¾ç¤ºå‰§æƒ…ç« èŠ‚
            showStoryChapter('chapter1');
        }

        function startChallenge() {
            console.log('å¼€å§‹è‡ªç”±æŒ‘æˆ˜');
            showFloatingText('è‡ªç”±æŒ‘æˆ˜åŠŸèƒ½å¼€å‘ä¸­...', 'info');
            
            // è·³è½¬åˆ°æŒ‘æˆ˜é¡µé¢
            window.location.href = 'challenges.html';
        }

        // ===== æ¸¸æˆæŒ‡å— =====
        function showGameGuide() {
            document.getElementById('game-guide-modal').style.display = 'flex';
        }

        function closeGameGuide() {
            document.getElementById('game-guide-modal').style.display = 'none';
        }

        // ===== åœ°å›¾æ»¤é•œ =====
        function initializeMapFilters() {
            const filterBtns = document.querySelectorAll('.filter-btn');
            
            filterBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    // æ›´æ–°æŒ‰é’®çŠ¶æ€
                    filterBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // åº”ç”¨æ»¤é•œ
                    const filter = this.dataset.filter;
                    applyMapFilter(filter);
                });
            });
        }

        function applyMapFilter(filter) {
            const islands = document.querySelectorAll('.island-card');
            
            islands.forEach(island => {
                const isLocked = island.classList.contains('locked');
                
                switch (filter) {
                    case 'unlocked':
                        island.style.display = isLocked ? 'none' : 'block';
                        break;
                    case 'locked':
                        island.style.display = isLocked ? 'block' : 'none';
                        break;
                    default:
                        island.style.display = 'block';
                }
            });
        }

        // ===== äº‹ä»¶ç›‘å¬å™¨ =====
        function setupEventListeners() {
            // ç›‘å¬æ¸¸æˆçŠ¶æ€å˜åŒ–
            if (typeof WordAdventure !== 'undefined') {
                WordAdventure.on('islandUnlocked', function(data) {
                    renderIslandMap();
                    showFloatingText(`è§£é”äº†æ–°å²›å±¿ï¼š${data.island.name}ï¼`, 'success');
                });
                
                WordAdventure.on('levelCompleted', function(data) {
                    renderIslandMap();
                    renderDailyGoals();
                });
                
                WordAdventure.on('experienceGained', function() {
                    renderDailyGoals();
                });
            }
        }

        // ===== å·¥å…·å‡½æ•° =====
        function showFloatingText(text, type) {
            const floatingText = document.createElement('div');
            floatingText.className = `floating-text floating-${type}`;
            floatingText.textContent = text;
            
            floatingText.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(0, 0, 0, 0.8);
                color: white;
                padding: 10px 20px;
                border-radius: 20px;
                z-index: 1000;
                font-size: 16px;
                animation: fadeInOut 2s ease-in-out;
            `;
            
            document.body.appendChild(floatingText);
            
            setTimeout(() => {
                if (floatingText.parentNode) {
                    floatingText.parentNode.removeChild(floatingText);
                }
            }, 2000);
        }
        
        function showStoryChapter(chapterId) {
            const chapterSection = document.getElementById('current-chapter');
            const mapSection = document.getElementById('island-map');
            const quickStartSection = document.querySelector('.quick-start');
            const goalsSection = document.querySelector('.daily-goals');
            
            if (chapterSection && mapSection) {
                // æ˜¾ç¤ºå‰§æƒ…ç« èŠ‚ï¼Œéšè—å…¶ä»–å†…å®¹
                chapterSection.style.display = 'block';
                mapSection.style.display = 'none';
                
                if (quickStartSection) quickStartSection.style.display = 'none';
                if (goalsSection) goalsSection.style.display = 'none';
                
                // è®¾ç½®ç« èŠ‚æ ‡é¢˜
                const chapterTitle = document.getElementById('chapter-title');
                if (chapterTitle) {
                    const chapters = {
                        'chapter1': 'å¥‡å¦™çš„ç›¸é‡',
                        'chapter2': 'ç«å±±è¯•ç‚¼',
                        'chapter3': 'æ™ºæ…§å®ˆæŠ¤'
                    };
                    chapterTitle.textContent = chapters[chapterId] || 'å†’é™©å¼€å§‹';
                }
            }
        }

        // ç›‘å¬é¡µé¢å¯è§æ€§å˜åŒ–ï¼Œæ›´æ–°å†…å®¹
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                renderIslandMap();
                renderDailyGoalsSimple();
            }
        });
    </script>
    
    <style>
        /* åŸºç¡€é¡µé¢æ ·å¼ */
        .page-container {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            box-sizing: border-box;
        }
        
        .page-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .page-header h1 {
            font-size: 28px;
            margin: 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .main-content {
            max-width: 600px;
            margin: 0 auto;
        }
        
        .info-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .info-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
        }
        
        .scene-illustration {
            text-align: center;
            font-size: 40px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .character-quest {
            display: inline-block;
            margin: 0 15px;
            animation: bounce 2s infinite;
        }
        
        .character-guide {
            display: inline-block;
            margin: 0 15px;
            animation: bounce 2s infinite 0.5s;
        }
        
        .scene-background {
            display: inline-block;
            margin: 0 15px;
            font-size: 60px;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-20px); }
            60% { transform: translateY(-10px); }
        }
        
        .dialogue-bubble {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            color: #333;
            line-height: 1.6;
        }
        
        .dialogue-bubble p {
            margin: 10px 0;
        }
    </style>

    <style>
        /* å†’é™©ä¸»é¡µä¸“å±æ ·å¼ */
        .adventure-header {
            background: linear-gradient(135deg, rgba(106, 17, 203, 0.9), rgba(37, 117, 252, 0.9));
            color: white;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .adventure-header h1 {
            font-size: 20px;
            margin: 0;
        }

        .info-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
        }

        .story-chapter {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .chapter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .chapter-progress {
            background: #6A11CB;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
        }

        .story-scene {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .scene-setting h4 {
            margin: 0 0 8px 0;
            color: #6A11CB;
            font-size: 14px;
        }

        .dialogue-item {
            background: white;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid #6A11CB;
            margin-bottom: 10px;
        }

        .dialogue-speaker {
            font-weight: bold;
            color: #6A11CB;
            margin-bottom: 4px;
        }

        .dialogue-text {
            font-style: italic;
            color: #666;
        }

        .story-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .island-map {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .map-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .map-filters {
            display: flex;
            gap: 8px;
        }

        .filter-btn {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .filter-btn.active {
            background: #6A11CB;
            color: white;
            border-color: #6A11CB;
        }

        .islands-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .island-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .island-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        }

        .island-card.unlocked {
            border-color: #6A11CB;
        }

        .island-card.current {
            border-color: #FFD700;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 165, 0, 0.1));
        }

        .island-visual {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .island-icon {
            font-size: 24px;
        }

        .current-marker {
            background: #FFD700;
            color: white;
            padding: 2px 6px;
            border-radius: 12px;
            font-size: 10px;
            margin-left: auto;
        }

        .island-name {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        .island-desc {
            font-size: 12px;
            color: #666;
            margin-bottom: 10px;
        }

        .island-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .grade-range {
            font-size: 12px;
            color: #666;
        }

        .difficulty-badge {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 4px;
            color: white;
        }

        .difficulty-badge.beginner {
            background: #4CAF50;
        }

        .difficulty-badge.intermediate {
            background: #FF9800;
        }

        .difficulty-badge.advanced {
            background: #FF3B30;
        }

        .island-progress {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .island-progress .progress-bar {
            flex: 1;
            height: 4px;
            background: #e9ecef;
            border-radius: 2px;
            overflow: hidden;
        }

        .island-progress .progress-fill {
            height: 100%;
            background: #6A11CB;
            transition: width 0.3s ease;
        }

        .island-progress .progress-text {
            font-size: 12px;
            color: #666;
            min-width: 30px;
        }

        .map-legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            color: #666;
        }

        .quick-start {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .quick-start h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .quick-actions-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .quick-action-btn {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }

        .quick-action-btn:hover {
            background: #6A11CB;
            color: white;
            transform: translateY(-2px);
        }

        .action-icon {
            font-size: 24px;
            display: block;
            margin-bottom: 5px;
        }

        .action-title {
            font-size: 12px;
            font-weight: bold;
            display: block;
            margin-bottom: 3px;
        }

        .action-desc {
            font-size: 10px;
            opacity: 0.8;
        }

        .daily-goals {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .daily-goals h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .goals-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .goal-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #6A11CB;
        }

        .goal-item.completed {
            background: linear-gradient(135deg, #e8f5e8, #f0fff0);
            border-left-color: #4CAF50;
        }

        .goal-info {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
        }

        .goal-icon {
            font-size: 16px;
        }

        .goal-text {
            font-size: 12px;
            color: #333;
        }

        .goal-progress {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .goal-count {
            font-size: 12px;
            color: #666;
            min-width: 35px;
        }

        .goal-bar {
            width: 60px;
            height: 4px;
            background: #e9ecef;
            border-radius: 2px;
            overflow: hidden;
        }

        .goal-fill {
            height: 100%;
            background: #4CAF50;
            transition: width 0.3s ease;
        }

        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .guide-modal {
            padding: 0;
        }

        .guide-header {
            background: linear-gradient(135deg, #6A11CB, #2575FC);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .guide-content {
            padding: 20px;
        }

        .guide-section {
            margin-bottom: 20px;
        }

        .guide-section h4 {
            margin-bottom: 8px;
            color: #333;
            font-size: 14px;
        }

        .guide-section p {
            color: #666;
            font-size: 13px;
            line-height: 1.5;
        }

        .island-detail-modal {
            padding: 0;
        }

        .island-detail-header {
            background: linear-gradient(135deg, #6A11CB, #2575FC);
            color: white;
            padding: 20px;
        }

        .island-preview {
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            margin: 0 auto 15px auto;
        }

        .island-detail-modal .island-info {
            text-align: center;
        }

        .island-detail-modal h3 {
            margin: 0 0 10px 0;
            font-size: 20px;
        }

        .island-detail-modal p {
            margin: 0 0 15px 0;
            opacity: 0.9;
        }

        .island-stats {
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
        }

        .island-levels {
            padding: 20px;
        }

        .level-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #6A11CB;
        }

        .level-item.completed {
            background: linear-gradient(135deg, #e8f5e8, #f0fff0);
            border-left-color: #4CAF50;
        }

        .level-item.locked {
            opacity: 0.6;
            border-left-color: #dee2e6;
        }

        .level-icon {
            font-size: 20px;
            min-width: 25px;
            text-align: center;
        }

        .level-info {
            flex: 1;
        }

        .level-name {
            margin: 0 0 3px 0;
            font-size: 14px;
            font-weight: bold;
            color: #333;
        }

        .level-desc {
            margin: 0;
            font-size: 12px;
            color: #666;
        }

        .level-rewards {
            text-align: right;
        }

        .stars {
            font-size: 12px;
            margin-bottom: 3px;
        }

        .rewards {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .reward-exp, .reward-coins {
            font-size: 10px;
            color: #666;
        }

        .play-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            padding: 20px;
            border-top: 1px solid #e9ecef;
        }

        .modal-actions button {
            flex: 1;
        }

        @media (max-width: 375px) {
            .quick-actions-grid {
                grid-template-columns: 1fr;
            }
            
            .map-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .map-filters {
                width: 100%;
                justify-content: space-between;
            }
        }
    </style>
</body>
</html>