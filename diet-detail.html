<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FitLife - é¥®é£Ÿè¯¦æƒ…</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="page-container">
        <!-- é¡µé¢å¤´éƒ¨ -->
        <header class="page-header">
            <button class="back-btn" onclick="parent.navigateToPage('diet.html')">â† è¿”å›</button>
            <h1>ç¼–è¾‘é¤é£Ÿ</h1>
            <button class="save-btn" onclick="saveMeal()">ä¿å­˜</button>
        </header>

        <!-- é¤é£Ÿç±»å‹é€‰æ‹© -->
        <section class="meal-type-selector">
            <h2>é€‰æ‹©é¤é£Ÿç±»å‹</h2>
            <div class="meal-types">
                <button class="meal-type-btn active" data-type="breakfast" onclick="selectMealType('breakfast')">
                    <span class="meal-icon">ğŸŒ…</span>
                    <span>æ—©é¤</span>
                </button>
                <button class="meal-type-btn" data-type="lunch" onclick="selectMealType('lunch')">
                    <span class="meal-icon">â˜€ï¸</span>
                    <span>åˆé¤</span>
                </button>
                <button class="meal-type-btn" data-type="dinner" onclick="selectMealType('dinner')">
                    <span class="meal-icon">ğŸŒ™</span>
                    <span>æ™šé¤</span>
                </button>
                <button class="meal-type-btn" data-type="snack" onclick="selectMealType('snack')">
                    <span class="meal-icon">ğŸ</span>
                    <span>åŠ é¤</span>
                </button>
            </div>
        </section>

        <!-- æ—¶é—´é€‰æ‹© -->
        <section class="time-selector">
            <h2>ç”¨é¤æ—¶é—´</h2>
            <div class="time-input-group">
                <input type="time" id="meal-time" value="12:30" class="time-input">
                <button class="current-time-btn" onclick="setCurrentTime()">å½“å‰æ—¶é—´</button>
            </div>
        </section>

        <!-- é£Ÿç‰©æœç´¢å’Œæ·»åŠ  -->
        <section class="food-search-section">
            <div class="search-header">
                <h2>æ·»åŠ é£Ÿç‰©</h2>
                <div class="search-input-container">
                    <input type="text" id="food-search" placeholder="æœç´¢é£Ÿç‰©åç§°" class="search-input">
                    <button class="search-btn" onclick="searchFood()">ğŸ”</button>
                </div>
                <div class="search-options">
                    <button class="option-btn" onclick="showBarcodeScan()">
                        <span class="option-icon">ğŸ“·</span>
                        <span>æ‰«ç è¯†åˆ«</span>
                    </button>
                    <button class="option-btn" onclick="showVoiceInput()">
                        <span class="option-icon">ğŸ¤</span>
                        <span>è¯­éŸ³è¾“å…¥</span>
                    </button>
                    <button class="option-btn" onclick="showRecentFoods()">
                        <span class="option-icon">ğŸ•</span>
                        <span>æœ€è¿‘è®°å½•</span>
                    </button>
                </div>
            </div>

            <!-- æœç´¢ç»“æœ -->
            <div class="search-results" id="search-results" style="display: none;">
                <div class="result-item" onclick="addFoodToMeal('ç±³é¥­', 150, 165)">
                    <img src="assets/images/food/rice.jpg" alt="ç±³é¥­" class="food-thumb">
                    <div class="food-details">
                        <div class="food-name">ç±³é¥­ï¼ˆç†Ÿï¼‰</div>
                        <div class="food-unit-info">æ¯100g: 116åƒå¡</div>
                    </div>
                    <button class="add-btn">+</button>
                </div>
                <div class="result-item" onclick="addFoodToMeal('é¸¡èƒ¸è‚‰', 100, 165)">
                    <img src="assets/images/food/chicken-breast.jpg" alt="é¸¡èƒ¸è‚‰" class="food-thumb">
                    <div class="food-details">
                        <div class="food-name">é¸¡èƒ¸è‚‰ï¼ˆç…®ï¼‰</div>
                        <div class="food-unit-info">æ¯100g: 165åƒå¡</div>
                    </div>
                    <button class="add-btn">+</button>
                </div>
                <div class="result-item" onclick="addFoodToMeal('è¥¿å…°èŠ±', 100, 35)">
                    <img src="assets/images/food/broccoli.jpg" alt="è¥¿å…°èŠ±" class="food-thumb">
                    <div class="food-details">
                        <div class="food-name">è¥¿å…°èŠ±ï¼ˆç…®ï¼‰</div>
                        <div class="food-unit-info">æ¯100g: 35åƒå¡</div>
                    </div>
                    <button class="add-btn">+</button>
                </div>
            </div>
        </section>

        <!-- å·²é€‰æ‹©çš„é£Ÿç‰©åˆ—è¡¨ -->
        <section class="selected-foods">
            <div class="section-header">
                <h2>å·²æ·»åŠ é£Ÿç‰©</h2>
                <span class="total-calories">æ€»è®¡: <span id="total-calories">0</span>åƒå¡</span>
            </div>
            
            <div class="food-list" id="food-list">
                <!-- ç¤ºä¾‹é£Ÿç‰©é¡¹ -->
                <div class="food-list-item">
                    <img src="assets/images/food/rice.jpg" alt="ç±³é¥­" class="food-image">
                    <div class="food-info">
                        <h3 class="food-name">ç±³é¥­</h3>
                        <div class="food-input-group">
                            <input type="number" value="150" min="0" step="1" class="portion-input" onchange="updateCalories(this)">
                            <select class="unit-select" onchange="updateCalories(this)">
                                <option value="g">å…‹(g)</option>
                                <option value="ä»½">ä»½</option>
                                <option value="ä¸ª">ä¸ª</option>
                            </select>
                            <div class="calorie-display">165åƒå¡</div>
                        </div>
                    </div>
                    <button class="remove-btn" onclick="removeFood(this)">Ã—</button>
                </div>

                <div class="food-list-item">
                    <img src="assets/images/food/chicken-breast.jpg" alt="é¸¡èƒ¸è‚‰" class="food-image">
                    <div class="food-info">
                        <h3 class="food-name">é¦™ç…é¸¡èƒ¸è‚‰</h3>
                        <div class="food-input-group">
                            <input type="number" value="120" min="0" step="1" class="portion-input" onchange="updateCalories(this)">
                            <select class="unit-select" onchange="updateCalories(this)">
                                <option value="g">å…‹(g)</option>
                                <option value="ä»½">ä»½</option>
                            </select>
                            <div class="calorie-display">198åƒå¡</div>
                        </div>
                    </div>
                    <button class="remove-btn" onclick="removeFood(this)">Ã—</button>
                </div>
            </div>

            <button class="add-more-foods-btn" onclick="showMoreFoods()">
                + æ·»åŠ æ›´å¤šé£Ÿç‰©
            </button>
        </section>

        <!-- è¥å…»æˆåˆ†åˆ†æ -->
        <section class="nutrition-analysis">
            <h2>è¥å…»æˆåˆ†</h2>
            <div class="nutrition-grid">
                <div class="nutrition-stat">
                    <div class="nutrition-label">è›‹ç™½è´¨</div>
                    <div class="nutrition-value"><span id="protein-amount">28</span>g</div>
                    <div class="nutrition-bar">
                        <div class="nutrition-fill protein" style="width: 35%"></div>
                    </div>
                </div>
                <div class="nutrition-stat">
                    <div class="nutrition-label">ç¢³æ°´åŒ–åˆç‰©</div>
                    <div class="nutrition-value"><span id="carbs-amount">45</span>g</div>
                    <div class="nutrition-bar">
                        <div class="nutrition-fill carbs" style="width: 30%"></div>
                    </div>
                </div>
                <div class="nutrition-stat">
                    <div class="nutrition-label">è„‚è‚ª</div>
                    <div class="nutrition-value"><span id="fat-amount">8</span>g</div>
                    <div class="nutrition-bar">
                        <div class="nutrition-fill fat" style="width: 20%"></div>
                    </div>
                </div>
                <div class="nutrition-stat">
                    <div class="nutrition-label">è†³é£Ÿçº¤ç»´</div>
                    <div class="nutrition-value"><span id="fiber-amount">3</span>g</div>
                    <div class="nutrition-bar">
                        <div class="nutrition-fill fiber" style="width: 25%"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- å¤‡æ³¨ -->
        <section class="meal-notes">
            <h2>å¤‡æ³¨</h2>
            <textarea id="meal-notes" placeholder="æ·»åŠ å¤‡æ³¨ä¿¡æ¯ï¼Œå¦‚çƒ¹é¥ªæ–¹æ³•ã€ç”¨é¤æ„Ÿå—ç­‰..." class="notes-textarea"></textarea>
        </section>
    </div>

    <!-- è‡ªå®šä¹‰é£Ÿç‰©å¼¹çª— -->
    <div class="modal-overlay" id="custom-food-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>è‡ªå®šä¹‰é£Ÿç‰©</h3>
                <button class="close-btn" onclick="closeCustomFood()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>é£Ÿç‰©åç§°</label>
                    <input type="text" id="custom-food-name" placeholder="è¯·è¾“å…¥é£Ÿç‰©åç§°">
                </div>
                <div class="form-group">
                    <label>åˆ†é‡</label>
                    <input type="number" id="custom-food-amount" placeholder="è¯·è¾“å…¥åˆ†é‡">
                    <select id="custom-food-unit">
                        <option value="g">å…‹(g)</option>
                        <option value="ml">æ¯«å‡(ml)</option>
                        <option value="ä»½">ä»½</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>çƒ­é‡ï¼ˆåƒå¡ï¼‰</label>
                    <input type="number" id="custom-food-calories" placeholder="è¯·è¾“å…¥çƒ­é‡">
                </div>
            </div>
            <div class="modal-footer">
                <button class="secondary-btn" onclick="closeCustomFood()">å–æ¶ˆ</button>
                <button class="primary-btn" onclick="addCustomFood()">æ·»åŠ </button>
            </div>
        </div>
    </div>

    <script>
        let currentMealType = 'breakfast';

        function selectMealType(type) {
            currentMealType = type;
            document.querySelectorAll('.meal-type-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-type="${type}"]`).classList.add('active');
        }

        function setCurrentTime() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            document.getElementById('meal-time').value = `${hours}:${minutes}`;
        }

        function searchFood() {
            const searchTerm = document.getElementById('food-search').value;
            if (searchTerm.trim()) {
                document.getElementById('search-results').style.display = 'block';
            }
        }

        function showBarcodeScan() {
            alert('æ‰«ç è¯†åˆ«åŠŸèƒ½ï¼šè¯·ä½¿ç”¨ç›¸æœºæ‰«æé£Ÿå“æ¡å½¢ç ');
        }

        function showVoiceInput() {
            alert('è¯­éŸ³è¾“å…¥åŠŸèƒ½ï¼šè¯·è¯´å‡ºé£Ÿç‰©åç§°');
        }

        function showRecentFoods() {
            alert('æ˜¾ç¤ºæœ€è¿‘è®°å½•çš„é£Ÿç‰©åˆ—è¡¨');
        }

        function addFoodToMeal(name, amount, calories) {
            const foodList = document.getElementById('food-list');
            const newFoodItem = document.createElement('div');
            newFoodItem.className = 'food-list-item';
            newFoodItem.innerHTML = `
                <img src="assets/images/food/default.jpg" alt="${name}" class="food-image">
                <div class="food-info">
                    <h3 class="food-name">${name}</h3>
                    <div class="food-input-group">
                        <input type="number" value="${amount}" min="0" step="1" class="portion-input" onchange="updateCalories(this)">
                        <select class="unit-select" onchange="updateCalories(this)">
                            <option value="g">å…‹(g)</option>
                            <option value="ä»½">ä»½</option>
                        </select>
                        <div class="calorie-display">${calories}åƒå¡</div>
                    </div>
                </div>
                <button class="remove-btn" onclick="removeFood(this)">Ã—</button>
            `;
            foodList.appendChild(newFoodItem);
            
            document.getElementById('search-results').style.display = 'none';
            document.getElementById('food-search').value = '';
            updateTotalCalories();
        }

        function removeFood(btn) {
            btn.closest('.food-list-item').remove();
            updateTotalCalories();
        }

        function updateCalories(input) {
            // æ›´æ–°å•ä¸ªé£Ÿç‰©çš„å¡è·¯é‡Œè®¡ç®—
            const foodItem = input.closest('.food-list-item');
            const amount = input.value;
            const unit = foodItem.querySelector('.unit-select').value;
            // è¿™é‡Œåº”è¯¥æ ¹æ®å®é™…é£Ÿç‰©æ•°æ®åº“è®¡ç®—
            updateTotalCalories();
        }

        function updateTotalCalories() {
            const calorieDisplays = document.querySelectorAll('.calorie-display');
            let total = 0;
            calorieDisplays.forEach(display => {
                const calories = parseInt(display.textContent);
                total += calories;
            });
            document.getElementById('total-calories').textContent = total;
        }

        function showMoreFoods() {
            document.querySelector('.food-search-section').scrollIntoView({ behavior: 'smooth' });
        }

        function saveMeal() {
            const mealData = {
                type: currentMealType,
                time: document.getElementById('meal-time').value,
                foods: [],
                notes: document.getElementById('meal-notes').value,
                totalCalories: document.getElementById('total-calories').textContent
            };

            // æ”¶é›†é£Ÿç‰©æ•°æ®
            document.querySelectorAll('.food-list-item').forEach(item => {
                const foodName = item.querySelector('.food-name').textContent;
                const amount = item.querySelector('.portion-input').value;
                const unit = item.querySelector('.unit-select').value;
                const calories = item.querySelector('.calorie-display').textContent;
                
                mealData.foods.push({
                    name: foodName,
                    amount: amount,
                    unit: unit,
                    calories: calories
                });
            });

            console.log('ä¿å­˜é¤é£Ÿæ•°æ®:', mealData);
            alert('é¤é£Ÿä¿å­˜æˆåŠŸï¼');
            parent.navigateToPage('diet.html');
        }

        function closeCustomFood() {
            document.getElementById('custom-food-modal').style.display = 'none';
        }

        function addCustomFood() {
            const name = document.getElementById('custom-food-name').value;
            const amount = document.getElementById('custom-food-amount').value;
            const unit = document.getElementById('custom-food-unit').value;
            const calories = document.getElementById('custom-food-calories').value;

            if (name && amount && calories) {
                addFoodToMeal(name, amount, calories);
                closeCustomFood();
            }
        }

        // åˆå§‹åŒ–
        setCurrentTime();
        updateTotalCalories();
    </script>
</body>
</html>