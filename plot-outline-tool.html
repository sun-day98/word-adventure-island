<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°è¯´åˆ†é›†æƒ…èŠ‚å¤§çº²è¾…åŠ©è®¾å®š</title>
    <link rel="stylesheet" href="css/styles.css">
    <style>
        .plot-outline-tool {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .tool-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
        }

        .tool-header h1 {
            margin: 0 0 15px;
            font-size: 2.5em;
            font-weight: 300;
        }

        .tool-header p {
            margin: 0;
            opacity: 0.9;
            font-size: 1.1em;
            line-height: 1.6;
        }

        .plot-workspace {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .section-panel {
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .section-header {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 20px;
            font-size: 1.2em;
            font-weight: 500;
        }

        .section-content {
            padding: 25px;
        }

        .form-section {
            margin-bottom: 25px;
        }

        .form-section h3 {
            margin: 0 0 15px;
            color: #333;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-section h3 .icon {
            font-size: 1.2em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
            font-size: 14px;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
            box-sizing: border-box;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .character-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .character-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            border: 2px solid transparent;
            transition: all 0.3s;
            cursor: pointer;
        }

        .character-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .character-card h4 {
            margin: 0 0 10px;
            color: #333;
        }

        .character-card .role {
            color: #666;
            font-size: 12px;
            margin-bottom: 8px;
        }

        .character-traits {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }

        .trait-tag {
            background: #667eea;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
        }

        .plot-structure {
            background: #f0f7ff;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .plot-phase {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }

        .plot-phase h4 {
            margin: 0 0 10px;
            color: #667eea;
        }

        .plot-phase .questions {
            margin-top: 10px;
        }

        .plot-phase .question {
            background: #fff3cd;
            border-left: 3px solid #ffc107;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 0 5px 5px 0;
            font-size: 13px;
        }

        .action-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 40px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 2px solid #e0e0e0;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-secondary:hover {
            background: #e9ecef;
            border-color: #667eea;
        }

        .ai-suggestions {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .ai-suggestions h4 {
            margin: 0 0 15px;
            color: #333;
        }

        .suggestion-item {
            background: white;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 3px solid #ff6b6b;
        }

        .suggestion-item:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .progress-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .progress-step {
            flex: 1;
            text-align: center;
            position: relative;
        }

        .progress-step::after {
            content: '';
            position: absolute;
            top: 20px;
            left: 50%;
            right: -50%;
            height: 2px;
            background: #e0e0e0;
            z-index: 1;
        }

        .progress-step:last-child::after {
            display: none;
        }

        .progress-step.active {
            color: #667eea;
        }

        .progress-step.active .step-number {
            background: #667eea;
            color: white;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e0e0e0;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-weight: bold;
            position: relative;
            z-index: 2;
        }

        .floating-tools {
            position: fixed;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            padding: 20px;
            z-index: 100;
        }

        .tool-btn {
            display: block;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #667eea;
            color: white;
            border: none;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 18px;
        }

        .tool-btn:hover {
            transform: scale(1.1);
            background: #5a67d8;
        }

        .character-generator {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 200;
        }

        .character-generator-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .export-preview {
            background: white;
            border-radius: 10px;
            padding: 30px;
            margin-top: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .export-preview h3 {
            margin: 0 0 20px;
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        @media (max-width: 768px) {
            .plot-workspace {
                grid-template-columns: 1fr;
            }

            .floating-tools {
                bottom: 20px;
                right: 50%;
                transform: translateX(50%);
                top: auto;
                display: flex;
                gap: 10px;
            }

            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="plot-outline-tool">
        <header class="tool-header">
            <h1>ğŸ“ å°è¯´åˆ†é›†æƒ…èŠ‚å¤§çº²è¾…åŠ©è®¾å®š</h1>
            <p>ä¸“ä¸šçš„æƒ…èŠ‚è®¾è®¡å·¥å…·ï¼Œå¸®åŠ©æ‚¨æ„å»ºå®Œæ•´çš„æ•…äº‹ç»“æ„ï¼ŒåŒ…æ‹¬å¼€å§‹ã€å‘å±•ã€é«˜æ½®å’Œç»“å°¾</p>
        </header>

        <div class="progress-indicator">
            <div class="progress-step active" data-step="1">
                <div class="step-number">1</div>
                <div>æ ¸å¿ƒè®¾å®š</div>
            </div>
            <div class="progress-step" data-step="2">
                <div class="step-number">2</div>
                <div>äººç‰©å…³ç³»</div>
            </div>
            <div class="progress-step" data-step="3">
                <div class="step-number">3</div>
                <div>æƒ…èŠ‚å‘å±•</div>
            </div>
            <div class="progress-step" data-step="4">
                <div class="step-number">4</div>
                <div>é«˜æ½®ç»“å±€</div>
            </div>
        </div>

        <div class="plot-workspace">
            <!-- å·¦ä¾§é¢æ¿ï¼šæ ¸å¿ƒè®¾å®š -->
            <div class="section-panel">
                <div class="section-header">ğŸ“‹ æ ¸å¿ƒè®¾å®š</div>
                <div class="section-content">
                    <div class="form-section">
                        <h3><span class="icon">ğŸ¯</span> ä¸»è¦å†…å®¹</h3>
                        <div class="form-group">
                            <label>è¯·ç”¨ä¸€å¥è¯æè¿°ä¸»è¦å†…å®¹</label>
                            <textarea id="mainContent" placeholder="æ‰€æœ‰çš„ä¸»è¦æƒ…èŠ‚éƒ½èƒ½ç”¨ä¸€å¥è¯æ¦‚æ‹¬ï¼ä¾‹å¦‚ï¼šä¸€ä¸ªæ™®é€šäººæ„å¤–è·å¾—è¶…èƒ½åŠ›åï¼Œå¿…é¡»åœ¨ä½¿ç”¨åŠ›é‡å’Œä¿æŠ¤éšç§ä¹‹é—´åšå‡ºé€‰æ‹©ã€‚"></textarea>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3><span class="icon">ğŸŒ</span> ç¯å¢ƒåœ°ç‚¹</h3>
                        <div class="form-group">
                            <label>ä¸»è¦ç¯å¢ƒæè¿°</label>
                            <textarea id="environmentDescription" placeholder="è¿™äº›æƒ…èŠ‚ä¸»è¦å‘ç”Ÿçš„ç¯å¢ƒæ˜¯å¦‚ä½•çš„ï¼Ÿåœ¨ä»€ä¹ˆåœ°æ–¹ï¼Ÿæœ‰åœºæ™¯åˆ‡æ¢å—ï¼Ÿ"></textarea>
                        </div>
                        <div class="form-group">
                            <label>åœºæ™¯å…³é”®è¯</label>
                            <input type="text" id="sceneKeywords" placeholder="ç”¨ç®€å•è¯å¥æè¿°åœºæ™¯ï¼Œå¦‚ï¼šç°ä»£éƒ½å¸‚ã€é›¨å¤œã€å’–å•¡å…ã€åºŸå¼ƒå·¥å‚">
                        </div>
                    </div>

                    <div class="form-section">
                        <h3><span class="icon">ğŸ‘¥</span> æ¶‰åŠäººç‰©</h3>
                        <div class="form-group">
                            <label>ä¸»è¦å‚ä¸è€…</label>
                            <textarea id="mainCharacters" placeholder="è¿™ä¸ªæ•…äº‹çš„ä¸»è¦å‚ä¸è€…æœ‰å“ªäº›ï¼Ÿ"></textarea>
                        </div>
                        <button class="btn-primary" onclick="openCharacterGenerator()" style="width: 100%;">+ ä½¿ç”¨äººç‰©è®¾å®šè¾…åŠ©å·¥å…·</button>
                        <div class="character-grid" id="characterGrid"></div>
                    </div>

                    <div class="ai-suggestions">
                        <h4>ğŸ’¡ AIå»ºè®®</h4>
                        <div id="aiSuggestions"></div>
                    </div>
                </div>
            </div>

            <!-- å³ä¾§é¢æ¿ï¼šæƒ…èŠ‚ç»“æ„ -->
            <div class="section-panel">
                <div class="section-header">ğŸ“ˆ æƒ…èŠ‚ç»“æ„</div>
                <div class="section-content">
                    <div class="plot-structure">
                        <div class="plot-phase">
                            <h4>ğŸš€ æ•…äº‹å¼€ç«¯</h4>
                            <div class="form-group">
                                <label>äº‹ä»¶å¼•å‘</label>
                                <textarea id="storyBeginning" placeholder="äº‹ä»¶æ˜¯å¦‚ä½•å¼•å‘çš„ï¼Ÿå‘ç°äº†é—®é¢˜ï¼Ÿé‡åˆ°äº†å›°éš¾ï¼Ÿä»å“ªä¸ªäººå¼€å§‹ï¼Ÿæ³¨æ„å¯¹ä¼ç¬”å’Œæ‚¬å¿µçš„æå†™ï¼"></textarea>
                            </div>
                            <div class="questions">
                                <div class="question">ğŸ’¡ æ­¤å¤„å‡ºç°ä¸€ä¸ªéœ€æ±‚æˆ–åŠ¨åŠ›ï¼Œå¦‚ï¼šå¼•èµ·ä¸»è§’å¥½å¥‡å¿ƒä¸»åŠ¨æ¢ç´¢ï¼Œæˆ–è¢«åŠ¨å·å…¥äº‹ä»¶ä¸å¾—ä¸é¡ºç€çº¿ç´¢èµ°ä¸‹å»</div>
                            </div>
                        </div>

                        <div class="plot-phase">
                            <h4>âš¡ æ•…äº‹å‘å±•ä¸é˜»åŠ›</h4>
                            <div class="form-group">
                                <label>è§£å†³è¿‡ç¨‹</label>
                                <textarea id="storyDevelopment" placeholder="ä¸ºäº†è§£å†³é—®é¢˜æˆ–å®ç°ç›®æ ‡ï¼Œéœ€è¦å¦‚ä½•åšï¼Ÿéœ€è¦è¾¾åˆ°é‚£äº›æ¡ä»¶ï¼Ÿåœ¨æ»¡è¶³è¿™äº›æ¡ä»¶æ—¶é‡åˆ°äº†ä»€ä¹ˆé˜»åŠ›ï¼Ÿ"></textarea>
                            </div>
                            <div class="form-group">
                                <label>å†²çªè®¾è®¡</label>
                                <textarea id="conflictDesign" placeholder="ä¸ºäº†è§£å†³é˜»åŠ›ï¼Œä¸»è§’åšäº†ä»€ä¹ˆï¼Ÿå’Œå“ªäº›äººäº§ç”Ÿè”ç³»ï¼Ÿåæ´¾å‡ºç°äº†å—ï¼Ÿ"></textarea>
                            </div>
                        </div>

                        <div class="plot-phase">
                            <h4>ğŸ­ è§£å†³é—®é¢˜ä¸é«˜æ½®</h4>
                            <div class="form-group">
                                <label>å…³é”®æ—¶åˆ»</label>
                                <textarea id="storyClimax" placeholder="æœ€å¤§çš„é˜»åŠ›æ˜¯ä»€ä¹ˆï¼Ÿåæ´¾æ˜¯è°ï¼Ÿæœ‰å¤šå‰å®³ï¼Ÿè¦å¦‚ä½•è§£å†³ï¼Ÿç”¨ä»€ä¹ˆæ–¹å¼è§£å†³æ‰æœ€çˆ½å¿«ï¼Ÿ"></textarea>
                            </div>
                            <div class="form-group">
                                <label>äººç‰©å†²å‡»</label>
                                <textarea id="characterImpact" placeholder="å„ä¸ªäººç‰©é­å—äº†ä»€ä¹ˆå†²å‡»ï¼Ÿä¸»è§’ç»™åˆ«äººäº§ç”Ÿäº†ä»€ä¹ˆéœ‡æ’¼ï¼Ÿ"></textarea>
                            </div>
                        </div>

                        <div class="plot-phase">
                            <h4>ğŸŒ… æ•…äº‹ç»“å°¾ä¸æ–°å¼€ç«¯</h4>
                            <div class="form-group">
                                <label>æƒ…èŠ‚ç»“æŸ</label>
                                <textarea id="storyEnding" placeholder="è¿™ä¸ªæƒ…èŠ‚ç»“æŸåï¼Œä¸»è§’å‘ç”Ÿäº†ä»€ä¹ˆå˜åŒ–ï¼Ÿæœ‰ä»€ä¹ˆæ”¶è·ï¼Ÿå…¶ä»–äººç‰©å¦‚ä½•äº†ï¼Ÿ"></textarea>
                            </div>
                            <div class="form-group">
                                <label>æ–°çš„æ‚¬å¿µ</label>
                                <textarea id="newSuspense" placeholder="è¿™ä¸ªæƒ…èŠ‚ç»“æŸä¹‹åï¼Œæ˜¯å¦åˆæ˜¯å¦å¤–ä¸€ä¸ªæƒ…èŠ‚çš„å¼€ç«¯ï¼Ÿå¼•èµ·äº†å¦å¤–ä¸€ä¸ªæ‚¬å¿µå—ï¼Ÿ"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="export-preview" id="exportPreview" style="display: none;">
            <h3>ğŸ“‹ å®Œæ•´æƒ…èŠ‚å¤§çº²é¢„è§ˆ</h3>
            <div id="outlineContent"></div>
        </div>

        <div class="action-buttons">
            <button class="btn-primary" onclick="generateOutline()">ç”Ÿæˆå®Œæ•´å¤§çº²</button>
            <button class="btn-secondary" onclick="saveOutline()">ä¿å­˜å¤§çº²</button>
            <button class="btn-secondary" onclick="exportOutline()">å¯¼å‡ºæ–‡æ¡£</button>
        </div>
    </div>

    <!-- æµ®åŠ¨å·¥å…·æ  -->
    <div class="floating-tools">
        <button class="tool-btn" onclick="getAISuggestions()" title="AIå»ºè®®">ğŸ¤–</button>
        <button class="tool-btn" onclick="randomInspiration()" title="éšæœºçµæ„Ÿ">ğŸ’¡</button>
        <button class="tool-btn" onclick="checkCompleteness()" title="å®Œæ•´æ€§æ£€æŸ¥">âœ…</button>
        <button class="tool-btn" onclick="resetForm()" title="é‡ç½®">ğŸ”„</button>
    </div>

    <!-- äººç‰©ç”Ÿæˆå™¨ -->
    <div class="character-generator" id="characterGenerator">
        <div class="character-generator-content">
            <h3>ğŸ‘¥ äººç‰©è®¾å®šè¾…åŠ©å·¥å…·</h3>
            <div class="form-group">
                <label>è§’è‰²å§“å</label>
                <input type="text" id="characterName" placeholder="è¾“å…¥è§’è‰²å§“å">
            </div>
            <div class="form-group">
                <label>è§’è‰²ç±»å‹</label>
                <select id="characterType">
                    <option value="protagonist">ä¸»è§’</option>
                    <option value="antagonist">åæ´¾</option>
                    <option value="supporting">é…è§’</option>
                    <option value="mentor">å¯¼å¸ˆ</option>
                    <option value="love_interest">æ‹çˆ±å¯¹è±¡</option>
                </select>
            </div>
            <div class="form-group">
                <label>æ ¸å¿ƒç‰¹è´¨</label>
                <input type="text" id="characterTraits" placeholder="å¦‚ï¼šå‹‡æ•¢ã€æ™ºæ…§ã€å†²åŠ¨ã€å–„è‰¯">
            </div>
            <div class="form-group">
                <label>èƒŒæ™¯æ•…äº‹</label>
                <textarea id="characterBackground" placeholder="ç®€è¦æè¿°è§’è‰²èƒŒæ™¯"></textarea>
            </div>
            <div class="form-group">
                <label>ä¸å…¶ä»–è§’è‰²çš„å…³ç³»</label>
                <textarea id="characterRelations" placeholder="æè¿°æ­¤è§’è‰²ä¸å…¶ä»–è§’è‰²çš„å…³ç³»"></textarea>
            </div>
            <div class="action-buttons">
                <button class="btn-primary" onclick="addCharacter()">æ·»åŠ è§’è‰²</button>
                <button class="btn-secondary" onclick="closeCharacterGenerator()">å…³é—­</button>
            </div>
        </div>
    </div>

    <script>
        let currentOutline = {
            mainContent: '',
            environment: {
                description: '',
                keywords: ''
            },
            characters: [],
            plot: {
                beginning: '',
                development: '',
                climax: '',
                ending: '',
                newSuspense: ''
            }
        };

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadSavedOutline();
            updateCharacterGrid();
            generateInitialSuggestions();
        });

        function openCharacterGenerator() {
            document.getElementById('characterGenerator').style.display = 'block';
        }

        function closeCharacterGenerator() {
            document.getElementById('characterGenerator').style.display = 'none';
            clearCharacterForm();
        }

        function clearCharacterForm() {
            document.getElementById('characterName').value = '';
            document.getElementById('characterType').value = 'protagonist';
            document.getElementById('characterTraits').value = '';
            document.getElementById('characterBackground').value = '';
            document.getElementById('characterRelations').value = '';
        }

        function addCharacter() {
            const name = document.getElementById('characterName').value.trim();
            if (!name) {
                alert('è¯·è¾“å…¥è§’è‰²å§“å');
                return;
            }

            const character = {
                id: Date.now(),
                name: name,
                type: document.getElementById('characterType').value,
                traits: document.getElementById('characterTraits').value.split('ã€').filter(t => t.trim()),
                background: document.getElementById('characterBackground').value,
                relations: document.getElementById('characterRelations').value
            };

            currentOutline.characters.push(character);
            updateCharacterGrid();
            closeCharacterGenerator();
            saveToLocal();
        }

        function updateCharacterGrid() {
            const grid = document.getElementById('characterGrid');
            
            if (currentOutline.characters.length === 0) {
                grid.innerHTML = '<p style="text-align: center; color: #999; grid-column: 1 / -1;">æš‚æ— è§’è‰²ï¼Œç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æ·»åŠ </p>';
                return;
            }

            grid.innerHTML = currentOutline.characters.map(char => `
                <div class="character-card">
                    <h4>${char.name}</h4>
                    <div class="role">${getRoleName(char.type)}</div>
                    <div class="character-traits">
                        ${char.traits.map(trait => `<span class="trait-tag">${trait}</span>`).join('')}
                    </div>
                </div>
            `).join('');
        }

        function getRoleName(type) {
            const names = {
                protagonist: 'ä¸»è§’',
                antagonist: 'åæ´¾',
                supporting: 'é…è§’',
                mentor: 'å¯¼å¸ˆ',
                love_interest: 'æ‹çˆ±å¯¹è±¡'
            };
            return names[type] || type;
        }

        function generateOutline() {
            // æ”¶é›†æ‰€æœ‰æ•°æ®
            currentOutline.mainContent = document.getElementById('mainContent').value;
            currentOutline.environment.description = document.getElementById('environmentDescription').value;
            currentOutline.environment.keywords = document.getElementById('sceneKeywords').value;
            currentOutline.plot.beginning = document.getElementById('storyBeginning').value;
            currentOutline.plot.development = document.getElementById('storyDevelopment').value;
            currentOutline.plot.climax = document.getElementById('storyClimax').value;
            currentOutline.plot.ending = document.getElementById('storyEnding').value;
            currentOutline.plot.newSuspense = document.getElementById('newSuspense').value;

            // ç”Ÿæˆå®Œæ•´å¤§çº²
            const outlineHTML = generateOutlineHTML();
            document.getElementById('outlineContent').innerHTML = outlineHTML;
            document.getElementById('exportPreview').style.display = 'block';

            // æ›´æ–°è¿›åº¦
            updateProgress(4);
            
            // æ»šåŠ¨åˆ°é¢„è§ˆåŒºåŸŸ
            document.getElementById('exportPreview').scrollIntoView({ behavior: 'smooth' });
        }

        function generateOutlineHTML() {
            return `
                <div style="line-height: 1.8;">
                    <h2>ğŸ“‹ æƒ…èŠ‚å¤§çº²</h2>
                    
                    <h3>ğŸ¯ ä¸»è¦å†…å®¹</h3>
                    <p><strong>${currentOutline.mainContent || 'å¾…å®Œå–„'}</strong></p>
                    
                    <h3>ğŸŒ ç¯å¢ƒè®¾å®š</h3>
                    <p><strong>ç¯å¢ƒæè¿°ï¼š</strong>${currentOutline.environment.description || 'å¾…å®Œå–„'}</p>
                    <p><strong>åœºæ™¯å…³é”®è¯ï¼š</strong>${currentOutline.environment.keywords || 'å¾…å®Œå–„'}</p>
                    
                    <h3>ğŸ‘¥ äººç‰©å…³ç³»</h3>
                    ${currentOutline.characters.map(char => `
                        <div style="margin-bottom: 15px; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                            <strong>${char.name}</strong>ï¼ˆ${getRoleName(char.type)}ï¼‰<br>
                            <strong>ç‰¹è´¨ï¼š</strong>${char.traits.join('ã€')}<br>
                            <strong>èƒŒæ™¯ï¼š</strong>${char.background}<br>
                            <strong>å…³ç³»ï¼š</strong>${char.relations}
                        </div>
                    `).join('')}
                    
                    <h3>ğŸ“ˆ æƒ…èŠ‚å‘å±•</h3>
                    
                    <h4>ğŸš€ æ•…äº‹å¼€ç«¯</h4>
                    <p>${currentOutline.plot.beginning || 'å¾…å®Œå–„'}</p>
                    
                    <h4>âš¡ å‘å±•ä¸é˜»åŠ›</h4>
                    <p><strong>è§£å†³è¿‡ç¨‹ï¼š</strong>${currentOutline.plot.development || 'å¾…å®Œå–„'}</p>
                    
                    <h4>ğŸ­ é«˜æ½®å†²çª</h4>
                    <p><strong>å…³é”®æ—¶åˆ»ï¼š</strong>${currentOutline.plot.climax || 'å¾…å®Œå–„'}</p>
                    
                    <h4>ğŸŒ… ç»“å°¾ä¸æ–°å¼€ç«¯</h4>
                    <p><strong>æƒ…èŠ‚ç»“æŸï¼š</strong>${currentOutline.plot.ending || 'å¾…å®Œå–„'}</p>
                    <p><strong>æ–°çš„æ‚¬å¿µï¼š</strong>${currentOutline.plot.newSuspense || 'å¾…å®Œå–„'}</p>
                </div>
            `;
        }

        function saveOutline() {
            generateOutline();
            localStorage.setItem('plotOutline', JSON.stringify(currentOutline));
            alert('å¤§çº²å·²ä¿å­˜åˆ°æœ¬åœ°ï¼');
        }

        function exportOutline() {
            generateOutline();
            
            let content = `å°è¯´åˆ†é›†æƒ…èŠ‚å¤§çº²\n`;
            content += `ç”Ÿæˆæ—¶é—´ï¼š${new Date().toLocaleString()}\n\n`;
            content += `ğŸ¯ ä¸»è¦å†…å®¹ï¼š${currentOutline.mainContent}\n\n`;
            content += `ğŸŒ ç¯å¢ƒè®¾å®šï¼š\n`;
            content += `ç¯å¢ƒæè¿°ï¼š${currentOutline.environment.description}\n`;
            content += `åœºæ™¯å…³é”®è¯ï¼š${currentOutline.environment.keywords}\n\n`;
            
            content += `ğŸ‘¥ äººç‰©è®¾å®šï¼š\n`;
            currentOutline.characters.forEach(char => {
                content += `${char.name}ï¼ˆ${getRoleName(char.type)}ï¼‰ï¼š${char.traits.join('ã€')}\n`;
                content += `èƒŒæ™¯ï¼š${char.background}\n`;
                content += `å…³ç³»ï¼š${char.relations}\n\n`;
            });
            
            content += `ğŸ“ˆ æƒ…èŠ‚å‘å±•ï¼š\n`;
            content += `æ•…äº‹å¼€ç«¯ï¼š${currentOutline.plot.beginning}\n\n`;
            content += `å‘å±•ä¸é˜»åŠ›ï¼š${currentOutline.plot.development}\n\n`;
            content += `é«˜æ½®å†²çªï¼š${currentOutline.plot.climax}\n\n`;
            content += `ç»“å°¾ä¸æ–°å¼€ç«¯ï¼š${currentOutline.plot.ending}\n\n`;
            content += `æ–°çš„æ‚¬å¿µï¼š${currentOutline.plot.newSuspense}\n`;

            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `æƒ…èŠ‚å¤§çº²_${new Date().getTime()}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function getAISuggestions() {
            const suggestions = [
                {
                    title: 'ä¼ç¬”è®¾è®¡å»ºè®®',
                    content: 'åœ¨æ•…äº‹å¼€ç«¯åŸ‹ä¸‹3ä¸ªä¼ç¬”ï¼š1) ä¸€ä¸ªç¥ç§˜ç‰©å“ 2) ä¸€å¥æ— å¿ƒçš„è¯ 3) ä¸€ä¸ªåå¸¸çš„è¡Œä¸º'
                },
                {
                    title: 'å†²çªå‡çº§æŠ€å·§',
                    content: 'æ¯æ¬¡å†²çªéƒ½åº”è¯¥æ¯”å‰ä¸€æ¬¡æ›´ä¸¥é‡ï¼Œä»å°è¯¯ä¼šâ†’å¤§çŸ›ç›¾â†’ç”Ÿæ­»å±æœºï¼Œé€æ­¥æå‡ç´§å¼ æ„Ÿ'
                },
                {
                    title: 'è§’è‰²æˆé•¿å¼§çº¿',
                    content: 'ä¸»è§’åº”è¯¥ç»å†ï¼šæ— çŸ¥â†’è®¤çŸ¥â†’æŒ£æ‰â†’æˆé•¿â†’èœ•å˜çš„å®Œæ•´è¿‡ç¨‹ï¼Œæ¯ä¸ªé˜¶æ®µéƒ½è¦æœ‰å…·ä½“è¡¨ç°'
                },
                {
                    title: 'èŠ‚å¥æ§åˆ¶è¦ç‚¹',
                    content: 'å¼ å¼›æœ‰åº¦ï¼šç´§å¼ å†²çªåå®‰æ’å¹³é™åæ€ï¼Œé‡å¤§äº‹ä»¶å‰é“ºå«æƒ…ç»ªï¼Œä¿æŒè¯»è€…æ³¨æ„åŠ›'
                }
            ];

            const container = document.getElementById('aiSuggestions');
            container.innerHTML = suggestions.map(s => `
                <div class="suggestion-item">
                    <strong>${s.title}</strong><br>
                    ${s.content}
                </div>
            `).join('');
        }

        function randomInspiration() {
            const inspirations = [
                'ä¸»è§’çªç„¶å‘ç°è‡ªå·±æ‹¥æœ‰ç‰¹æ®Šèƒ½åŠ›',
                'ä¸€ä¸ªç¥ç§˜çš„é™Œç”Ÿäººå¸¦æ¥é‡è¦æ¶ˆæ¯',
                'é‡è¦ç‰©å“ä¸¢å¤±æˆ–è¢«ç›—',
                'é•¿æœŸéšè—çš„ç§˜å¯†è¢«æ­éœ²',
                'æ„å¤–äº‹ä»¶æ”¹å˜æ‰€æœ‰è®¡åˆ’',
                'èƒŒå›æ¥è‡ªæœ€ä¿¡ä»»çš„äºº',
                'æ—¶é—´æ—…è¡Œåˆ°å…³é”®æ—¶åˆ»',
                'æ¢¦å¢ƒé¢„è¨€æœªæ¥çš„å±æœº'
            ];

            const random = inspirations[Math.floor(Math.random() * inspirations.length)];
            const currentText = document.getElementById('mainContent').value;
            
            if (currentText.trim() === '') {
                document.getElementById('mainContent').value = random;
            } else {
                alert('çµæ„Ÿå»ºè®®ï¼š' + random);
            }
        }

        function checkCompleteness() {
            let issues = [];
            let score = 0;
            const total = 7;

            if (document.getElementById('mainContent').value.trim()) score++;
            else issues.push('ä¸»è¦å†…å®¹æœªå¡«å†™');

            if (document.getElementById('environmentDescription').value.trim()) score++;
            else issues.push('ç¯å¢ƒæè¿°æœªå¡«å†™');

            if (currentOutline.characters.length > 0) score++;
            else issues.push('æ²¡æœ‰æ·»åŠ è§’è‰²');

            if (document.getElementById('storyBeginning').value.trim()) score++;
            else issues.push('æ•…äº‹å¼€ç«¯æœªå¡«å†™');

            if (document.getElementById('storyDevelopment').value.trim()) score++;
            else issues.push('å‘å±•è¿‡ç¨‹æœªå¡«å†™');

            if (document.getElementById('storyClimax').value.trim()) score++;
            else issues.push('é«˜æ½®å†²çªæœªå¡«å†™');

            if (document.getElementById('storyEnding').value.trim()) score++;
            else issues.push('æ•…äº‹ç»“å±€æœªå¡«å†™');

            const percentage = Math.round((score / total) * 100);
            let message = `å®Œæˆåº¦ï¼š${percentage}%\n`;
            
            if (issues.length > 0) {
                message += '\néœ€è¦å®Œå–„ï¼š\n' + issues.map((issue, index) => `${index + 1}. ${issue}`).join('\n');
            } else {
                message += '\nğŸ‰ æ­å–œï¼å¤§çº²å·²å®Œæ•´ï¼Œå¯ä»¥å¼€å§‹åˆ›ä½œäº†ï¼';
            }

            alert(message);
        }

        function resetForm() {
            if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰å†…å®¹å—ï¼Ÿ')) {
                document.getElementById('mainContent').value = '';
                document.getElementById('environmentDescription').value = '';
                document.getElementById('sceneKeywords').value = '';
                document.getElementById('storyBeginning').value = '';
                document.getElementById('storyDevelopment').value = '';
                document.getElementById('storyClimax').value = '';
                document.getElementById('storyEnding').value = '';
                document.getElementById('newSuspense').value = '';
                currentOutline.characters = [];
                updateCharacterGrid();
                localStorage.removeItem('plotOutline');
                updateProgress(1);
            }
        }

        function updateProgress(step) {
            document.querySelectorAll('.progress-step').forEach(el => {
                el.classList.remove('active');
            });
            
            for (let i = 1; i <= step; i++) {
                document.querySelector(`[data-step="${i}"]`).classList.add('active');
            }
        }

        function loadSavedOutline() {
            const saved = localStorage.getItem('plotOutline');
            if (saved) {
                try {
                    currentOutline = JSON.parse(saved);
                    
                    // æ¢å¤è¡¨å•æ•°æ®
                    document.getElementById('mainContent').value = currentOutline.mainContent || '';
                    document.getElementById('environmentDescription').value = currentOutline.environment?.description || '';
                    document.getElementById('sceneKeywords').value = currentOutline.environment?.keywords || '';
                    document.getElementById('storyBeginning').value = currentOutline.plot?.beginning || '';
                    document.getElementById('storyDevelopment').value = currentOutline.plot?.development || '';
                    document.getElementById('storyClimax').value = currentOutline.plot?.climax || '';
                    document.getElementById('storyEnding').value = currentOutline.plot?.ending || '';
                    document.getElementById('newSuspense').value = currentOutline.plot?.newSuspense || '';
                } catch (error) {
                    console.error('åŠ è½½ä¿å­˜çš„å¤§çº²å¤±è´¥:', error);
                }
            }
        }

        function saveToLocal() {
            localStorage.setItem('plotOutline', JSON.stringify(currentOutline));
        }

        function generateInitialSuggestions() {
            getAISuggestions();
        }

        // è‡ªåŠ¨ä¿å­˜
        setInterval(() => {
            if (document.getElementById('mainContent').value.trim() !== '') {
                saveToLocal();
            }
        }, 30000); // æ¯30ç§’è‡ªåŠ¨ä¿å­˜

        // ç›‘å¬è¾“å…¥å˜åŒ–
        document.querySelectorAll('input, textarea').forEach(element => {
            element.addEventListener('input', function() {
                updateProgress(2); // è¾“å…¥æ—¶æ›´æ–°åˆ°ç¬¬äºŒæ­¥
            });
        });
    </script>
</body>
</html>